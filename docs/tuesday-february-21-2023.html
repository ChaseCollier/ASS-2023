<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tuesday February 21, 2023 | GIS5122: Applied Spatial Statistics</title>
  <meta name="description" content="Tuesday February 21, 2023 | GIS5122: Applied Spatial Statistics" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Tuesday February 21, 2023 | GIS5122: Applied Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jelsner/ASS-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tuesday February 21, 2023 | GIS5122: Applied Spatial Statistics" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="thursday-february-16-2023.html"/>
<link rel="next" href="thursday-february-23-2023.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Spatial Statistics</a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html"><i class="fa fa-check"></i>Syllabus and set up</a>
<ul>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#course-description-and-expected-learning-outcomes"><i class="fa fa-check"></i>Course description and expected learning outcomes</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#grades-and-ethics"><i class="fa fa-check"></i>Grades and ethics</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#outline-of-topics-and-schedule"><i class="fa fa-check"></i>Outline of topics and schedule</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#reference-materials"><i class="fa fa-check"></i>Reference materials</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#reproducible-research"><i class="fa fa-check"></i>Reproducible research</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#getting-you-set-up"><i class="fa fa-check"></i>Getting you set up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html"><i class="fa fa-check"></i>Thursday, January 12, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#important-points-from-the-syllabus"><i class="fa fa-check"></i>Important points from the syllabus</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#continue-with-setup"><i class="fa fa-check"></i>Continue with setup</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#about-rstudio"><i class="fa fa-check"></i>About RStudio</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#lab-assignments"><i class="fa fa-check"></i>Lab assignments</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#data-science-workflow-with-r-markdown"><i class="fa fa-check"></i>Data science workflow with R markdown</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#getting-started-with-r"><i class="fa fa-check"></i>Getting started with R</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#completely-new-to-r"><i class="fa fa-check"></i>Completely new to R?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html"><i class="fa fa-check"></i>Tuesday, January 17, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#class-notes"><i class="fa fa-check"></i>Class notes</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#using-r"><i class="fa fa-check"></i>Using R</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html"><i class="fa fa-check"></i>Thursday January 19, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#getting-data-into-r"><i class="fa fa-check"></i>Getting data into R</a></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#working-with-data-frames-using-functions-from-dplyr"><i class="fa fa-check"></i>Working with data frames using functions from {dplyr}</a></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#making-graphs"><i class="fa fa-check"></i>Making graphs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html"><i class="fa fa-check"></i>Tuesday January 24, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#making-graphs-1"><i class="fa fa-check"></i>Making graphs</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#introduction-to-simple-features"><i class="fa fa-check"></i>Introduction to simple features</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#geo-computation-on-simple-features"><i class="fa fa-check"></i>Geo-computation on simple features</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html"><i class="fa fa-check"></i>Tuesday January 31, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#filtering-selecting-and-conditioning-on-attributes"><i class="fa fa-check"></i>Filtering, selecting, and conditioning on attributes</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#filtering-on-geographic-boundaries"><i class="fa fa-check"></i>Filtering on geographic boundaries</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#joining-data-frames"><i class="fa fa-check"></i>Joining data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#interpolating-using-areal-weights"><i class="fa fa-check"></i>Interpolating using areal weights</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#s4-spatial-data-objects"><i class="fa fa-check"></i>S4 spatial data objects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html"><i class="fa fa-check"></i>Thursday February 2, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html#working-with-raster-data"><i class="fa fa-check"></i>Working with raster data</a></li>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html#working-with-space-time-data"><i class="fa fa-check"></i>Working with space-time data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html"><i class="fa fa-check"></i>Tuesday February 7, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#mapping-using-functions-from-the-ggplot2-package"><i class="fa fa-check"></i>Mapping using functions from the {ggplot2} package</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#mapping-using-functions-from-the-tmap-package"><i class="fa fa-check"></i>Mapping using functions from the {tmap} package</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#creating-an-interactive-map"><i class="fa fa-check"></i>Creating an interactive map</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#isolines-and-isobands"><i class="fa fa-check"></i>Isolines and isobands</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#hillshape-and-colors-with-tidyterra"><i class="fa fa-check"></i>Hillshape and colors with tidyterra</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#visualizing-spatial-data"><i class="fa fa-check"></i>Visualizing spatial data</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#adding-an-inset-map"><i class="fa fa-check"></i>Adding an inset map</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#making-maps-with-rdeck"><i class="fa fa-check"></i>Making maps with rdeck</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html"><i class="fa fa-check"></i>Tuesday February 14, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#defining-spatial-neighborhoods-and-spatial-weights"><i class="fa fa-check"></i>Defining spatial neighborhoods and spatial weights</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#computing-autocorrelation"><i class="fa fa-check"></i>Computing autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#relating-autocorrelation-to-the-spatial-lag-variable"><i class="fa fa-check"></i>Relating autocorrelation to the spatial lag variable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html"><i class="fa fa-check"></i>Thursday February 16, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html#defining-neighborhoods"><i class="fa fa-check"></i>Defining neighborhoods</a></li>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html#assessing-the-statistical-significance-of-autocorrelation"><i class="fa fa-check"></i>Assessing the statistical significance of autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html#computing-and-interpreting-bivariate-spatial-autocorrelation"><i class="fa fa-check"></i>Computing and interpreting bivariate spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html#assessing-local-indicators-of-spatial-autocorrelation"><i class="fa fa-check"></i>Assessing local indicators of spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html"><i class="fa fa-check"></i>Tuesday February 21, 2023</a>
<ul>
<li class="chapter" data-level="0.1" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#using-local-spatial-autocorrelation-to-understand-the-tornado-record"><i class="fa fa-check"></i><b>0.1</b> Using local spatial autocorrelation to understand the tornado record</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#constraining-group-membership-based-on-spatial-autocorrelation"><i class="fa fa-check"></i>Constraining group membership based on spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#estimating-spatial-autocorrelation-in-model-residuals"><i class="fa fa-check"></i>Estimating spatial autocorrelation in model residuals</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i>Choosing a spatial regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#fitting-and-interpreting-spatial-regression-models"><i class="fa fa-check"></i>Fitting and interpreting spatial regression models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html"><i class="fa fa-check"></i>Thursday February 23, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#fitting-and-interpreting-geographic-regression"><i class="fa fa-check"></i>Fitting and interpreting geographic regression</a></li>
<li class="chapter" data-level="0.2" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#multiscale-gwr"><i class="fa fa-check"></i><b>0.2</b> Multiscale GWR</a></li>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#mapping-incidence-and-risk-with-a-spatial-regression-model"><i class="fa fa-check"></i>Mapping incidence and risk with a spatial regression model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-march-2-2023.html"><a href="thursday-march-2-2023.html"><i class="fa fa-check"></i>Thursday March 2, 2023</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html"><i class="fa fa-check"></i>Tuesday March 7, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#spatial-data-as-point-patterns"><i class="fa fa-check"></i>Spatial data as point patterns</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#theoretical-framework-for-analyzingmodeling-point-pattern-data"><i class="fa fa-check"></i>Theoretical framework for analyzing/modeling point pattern data</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#working-with-point-pattern-data-using-functions-from-the-spatstat-package"><i class="fa fa-check"></i>Working with point pattern data using functions from the spatstat package</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#quantifying-the-spatial-intensity-of-events"><i class="fa fa-check"></i>Quantifying the spatial intensity of events</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html"><i class="fa fa-check"></i>Tuesday March 21, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#creating-ppp-and-owin-objects-from-simple-feature-data-frames"><i class="fa fa-check"></i>Creating <code>ppp</code> and <code>owin</code> objects from simple feature data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#estimating-spatial-intensity-as-a-function-of-distance"><i class="fa fa-check"></i>Estimating spatial intensity as a function of distance</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#covariate-trend-as-a-possible-confounding-factor"><i class="fa fa-check"></i>Covariate trend as a possible confounding factor</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html"><i class="fa fa-check"></i>Thursday March 23, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#estimating-the-relative-risk"><i class="fa fa-check"></i>Estimating the relative risk</a></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#estimating-second-moment-properties-of-events"><i class="fa fa-check"></i>Estimating second-moment properties of events</a></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#examples-of-clustered-events"><i class="fa fa-check"></i>Examples of clustered events</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html"><i class="fa fa-check"></i>Tuesday March 28, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#removing-duplicate-events-and-defining-the-domain"><i class="fa fa-check"></i>Removing duplicate events and defining the domain</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#determining-statistical-significance-of-clustering"><i class="fa fa-check"></i>Determining statistical significance of clustering</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#estimating-clustering-in-multi-type-event-locations"><i class="fa fa-check"></i>Estimating clustering in multi-type event locations</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#interpolating-output-from-a-distance-function"><i class="fa fa-check"></i>Interpolating output from a distance function</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#limitations-of-the-distance-functions"><i class="fa fa-check"></i>Limitations of the distance functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html"><i class="fa fa-check"></i>Thursday March 30, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#limitations-on-interpreting-distance-functions"><i class="fa fa-check"></i>Limitations on interpreting distance functions</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#models-for-point-pattern-data"><i class="fa fa-check"></i>Models for point pattern data</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#fitting-and-interpreting-inhibition-models"><i class="fa fa-check"></i>Fitting and interpreting inhibition models</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#fitting-and-interpreting-cluster-models"><i class="fa fa-check"></i>Fitting and interpreting cluster models</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#assessing-how-well-the-model-fits"><i class="fa fa-check"></i>Assessing how well the model fits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html"><i class="fa fa-check"></i>Tuesday April 4, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#fitting-a-log-gaussian-cox-model"><i class="fa fa-check"></i>Fitting a log-Gaussian Cox model</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#assessing-how-well-a-point-pattern-model-fits-the-data"><i class="fa fa-check"></i>Assessing how well a point pattern model fits the data</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#an-example-of-a-point-process-model-in-the-wild"><i class="fa fa-check"></i>An example of a point process model in the wild</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html"><i class="fa fa-check"></i>Thursday April 6, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#spatial-logistic-regression"><i class="fa fa-check"></i>Spatial logistic regression</a></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#spatial-data-interpolation"><i class="fa fa-check"></i>Spatial data interpolation</a></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#computing-the-sample-variogram"><i class="fa fa-check"></i>Computing the sample variogram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html"><i class="fa fa-check"></i>Thursday April 13, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html#fitting-a-variogram-model-to-the-sample-variogram"><i class="fa fa-check"></i>Fitting a variogram model to the sample variogram</a></li>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html#creating-an-interpolated-surface-with-the-method-of-kriging"><i class="fa fa-check"></i>Creating an interpolated surface with the method of kriging</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html"><i class="fa fa-check"></i>Tuesday April 18, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#comparing-interpolation-methods"><i class="fa fa-check"></i>Comparing interpolation methods</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#evaluating-interpolation-accuracy"><i class="fa fa-check"></i>Evaluating interpolation accuracy</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#block-cross-validation"><i class="fa fa-check"></i>Block cross validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html"><i class="fa fa-check"></i>Thursday April 20, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#interpolating-to-areal-units-block-kriging"><i class="fa fa-check"></i>Interpolating to areal units (block kriging)</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#simulating-spatial-fields"><i class="fa fa-check"></i>Simulating spatial fields</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#interpolating-multiple-variables"><i class="fa fa-check"></i>Interpolating multiple variables</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#machine-learning-for-spatial-interpolation"><i class="fa fa-check"></i>Machine learning for spatial interpolation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GIS5122: Applied Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tuesday-february-21-2023" class="section level1 unnumbered hasAnchor">
<h1>Tuesday February 21, 2023<a href="tuesday-february-21-2023.html#tuesday-february-21-2023" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>“Feeling a little uncomfortable with your skills is a sign of learning, and continuous learning is what the tech industry thrives on!”</strong> — Vanessa Hurst</p>
<div id="using-local-spatial-autocorrelation-to-understand-the-tornado-record" class="section level2 hasAnchor" number="0.1">
<h2><span class="header-section-number">0.1</span> Using local spatial autocorrelation to understand the tornado record<a href="tuesday-february-21-2023.html#using-local-spatial-autocorrelation-to-understand-the-tornado-record" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Is the frequency of tornado reports correlated with the number of people in a region? Might this correlation extend to the number of people in neighboring regions?</p>
<p>To answer these questions you quantify the non-spatial correlation and the bi-variate spatial autocorrelation between tornado occurrences and population. To keep this manageable you focus on one state (Iowa)</p>
<p>Start by getting the U.S. Census data with functions from the {tidycensus} package. Downloading U.S. census data using functions from the {tidycensus} package requires you register with the Census Bureau</p>
<p>You can get an API key from <a href="http://api.census.gov/data/key_signup.html" class="uri">http://api.census.gov/data/key_signup.html</a>. Then use the <code>tidycensus::census_api_key()</code> function and put your key in quotes.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="tuesday-february-21-2023.html#cb1-1" aria-hidden="true" tabindex="-1"></a>tidycensus<span class="sc">::</span><span class="fu">census_api_key</span>(<span class="st">&quot;YOUR API KEY GOES HERE&quot;</span>)</span></code></pre></div>
<p>The <code>get_decennial()</code> function grants access to the 1990, 2000, and 2010 decennial US Census data and the <code>get_acs()</code> function grants access to the 5-year American Community Survey data. For example, here is how you get county-level population for Iowa</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="tuesday-february-21-2023.html#cb2-1" aria-hidden="true" tabindex="-1"></a>Counties.sf <span class="ot">&lt;-</span> tidycensus<span class="sc">::</span><span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;county&quot;</span>, </span>
<span id="cb2-2"><a href="tuesday-february-21-2023.html#cb2-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">variables =</span> <span class="st">&quot;B02001_001E&quot;</span>, </span>
<span id="cb2-3"><a href="tuesday-february-21-2023.html#cb2-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">state =</span> <span class="st">&quot;IA&quot;</span>,</span>
<span id="cb2-4"><a href="tuesday-february-21-2023.html#cb2-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">geometry =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Getting data from the 2017-2021 5-year ACS</code></pre>
<pre><code>## Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.</code></pre>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |                                                                      |   1%
  |                                                                            
  |=                                                                     |   1%
  |                                                                            
  |=                                                                     |   2%
  |                                                                            
  |==                                                                    |   2%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |==                                                                    |   4%
  |                                                                            
  |===                                                                   |   4%
  |                                                                            
  |===                                                                   |   5%
  |                                                                            
  |====                                                                  |   5%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |=====                                                                 |   6%
  |                                                                            
  |=====                                                                 |   7%
  |                                                                            
  |=====                                                                 |   8%
  |                                                                            
  |======                                                                |   8%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |=======                                                               |   9%
  |                                                                            
  |=======                                                               |  10%
  |                                                                            
  |=======                                                               |  11%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |========                                                              |  12%
  |                                                                            
  |=========                                                             |  12%
  |                                                                            
  |=========                                                             |  13%
  |                                                                            
  |=========                                                             |  14%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |==========                                                            |  15%
  |                                                                            
  |===========                                                           |  15%
  |                                                                            
  |===========                                                           |  16%
  |                                                                            
  |============                                                          |  16%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |============                                                          |  18%
  |                                                                            
  |=============                                                         |  18%
  |                                                                            
  |=============                                                         |  19%
  |                                                                            
  |==============                                                        |  19%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |==============                                                        |  21%
  |                                                                            
  |===============                                                       |  21%
  |                                                                            
  |===============                                                       |  22%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |=================                                                     |  24%
  |                                                                            
  |=================                                                     |  25%
  |                                                                            
  |==================                                                    |  25%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |===================                                                   |  26%
  |                                                                            
  |===================                                                   |  27%
  |                                                                            
  |===================                                                   |  28%
  |                                                                            
  |====================                                                  |  28%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |=====================                                                 |  29%
  |                                                                            
  |=====================                                                 |  30%
  |                                                                            
  |=====================                                                 |  31%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |======================                                                |  32%
  |                                                                            
  |=======================                                               |  32%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |========================                                              |  35%
  |                                                                            
  |=========================                                             |  35%
  |                                                                            
  |=========================                                             |  36%
  |                                                                            
  |==========================                                            |  36%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |===========================                                           |  38%
  |                                                                            
  |===========================                                           |  39%
  |                                                                            
  |============================                                          |  39%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |============================                                          |  41%
  |                                                                            
  |=============================                                         |  41%
  |                                                                            
  |=============================                                         |  42%
  |                                                                            
  |==============================                                        |  42%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |==============================                                        |  44%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |===============================                                       |  45%
  |                                                                            
  |================================                                      |  45%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |=================================                                     |  47%
  |                                                                            
  |=================================                                     |  48%
  |                                                                            
  |==================================                                    |  48%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |===================================                                   |  49%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |===================================                                   |  51%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |====================================                                  |  52%
  |                                                                            
  |=====================================                                 |  52%
  |                                                                            
  |=====================================                                 |  53%
  |                                                                            
  |=====================================                                 |  54%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |======================================                                |  55%
  |                                                                            
  |=======================================                               |  55%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |========================================                              |  56%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |========================================                              |  58%
  |                                                                            
  |=========================================                             |  58%
  |                                                                            
  |=========================================                             |  59%
  |                                                                            
  |==========================================                            |  59%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |==========================================                            |  61%
  |                                                                            
  |===========================================                           |  61%
  |                                                                            
  |===========================================                           |  62%
  |                                                                            
  |============================================                          |  62%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |============================================                          |  64%
  |                                                                            
  |=============================================                         |  64%
  |                                                                            
  |=============================================                         |  65%
  |                                                                            
  |==============================================                        |  65%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |===============================================                       |  66%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |===============================================                       |  68%
  |                                                                            
  |================================================                      |  68%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |=================================================                     |  69%
  |                                                                            
  |=================================================                     |  70%
  |                                                                            
  |=================================================                     |  71%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |==================================================                    |  72%
  |                                                                            
  |===================================================                   |  72%
  |                                                                            
  |===================================================                   |  73%
  |                                                                            
  |===================================================                   |  74%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |====================================================                  |  75%
  |                                                                            
  |=====================================================                 |  75%
  |                                                                            
  |=====================================================                 |  76%
  |                                                                            
  |======================================================                |  76%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |=======================================================               |  78%
  |                                                                            
  |=======================================================               |  79%
  |                                                                            
  |========================================================              |  79%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |========================================================              |  81%
  |                                                                            
  |=========================================================             |  81%
  |                                                                            
  |=========================================================             |  82%
  |                                                                            
  |==========================================================            |  82%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |==========================================================            |  84%
  |                                                                            
  |===========================================================           |  84%
  |                                                                            
  |===========================================================           |  85%
  |                                                                            
  |============================================================          |  85%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |=============================================================         |  86%
  |                                                                            
  |=============================================================         |  87%
  |                                                                            
  |=============================================================         |  88%
  |                                                                            
  |==============================================================        |  88%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |===============================================================       |  89%
  |                                                                            
  |===============================================================       |  90%
  |                                                                            
  |===============================================================       |  91%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |================================================================      |  92%
  |                                                                            
  |=================================================================     |  92%
  |                                                                            
  |=================================================================     |  93%
  |                                                                            
  |=================================================================     |  94%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |==================================================================    |  95%
  |                                                                            
  |===================================================================   |  95%
  |                                                                            
  |===================================================================   |  96%
  |                                                                            
  |====================================================================  |  96%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |====================================================================  |  98%
  |                                                                            
  |===================================================================== |  98%
  |                                                                            
  |===================================================================== |  99%
  |                                                                            
  |======================================================================|  99%
  |                                                                            
  |======================================================================| 100%</code></pre>
<p>The code returns a simple feature data frame with county borders as multi-polygons. The variable <code>B02001_001E</code> is the 2016-2020 population estimate in each county within the state</p>
<p>Next get the tornado data and count the number of tracks by county. A single track can intersect more than one county</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tuesday-february-21-2023.html#cb6-1" aria-hidden="true" tabindex="-1"></a>Torn.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;1950-2021-torn-aspath&quot;</span>), </span>
<span id="cb6-2"><a href="tuesday-february-21-2023.html#cb6-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">&quot;1950-2021-torn-aspath&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="tuesday-february-21-2023.html#cb6-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(Counties.sf)) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="tuesday-february-21-2023.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(yr <span class="sc">&gt;=</span> <span class="dv">2016</span>)</span></code></pre></div>
<pre><code>## Reading layer `1950-2021-torn-aspath&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/ASS-2023/data/1950-2021-torn-aspath&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 67558 features and 22 fields
## Geometry type: LINESTRING
## Dimension:     XY
## Bounding box:  xmin: -163.53 ymin: 17.7212 xmax: -64.7151 ymax: 61.02
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tuesday-february-21-2023.html#cb8-1" aria-hidden="true" tabindex="-1"></a>( TorCounts.df <span class="ot">&lt;-</span> Torn.sf <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="tuesday-february-21-2023.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(Counties.sf) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="tuesday-february-21-2023.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="tuesday-february-21-2023.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(GEOID) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="tuesday-february-21-2023.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">nT =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) )</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<pre><code>## # A tibble: 92 × 2
##    GEOID    nT
##    &lt;chr&gt; &lt;int&gt;
##  1 19001     7
##  2 19003     3
##  3 19007     5
##  4 19009     2
##  5 19011    11
##  6 19013     4
##  7 19015     7
##  8 19017     3
##  9 19019     6
## 10 19021     6
## # … with 82 more rows</code></pre>
<p>Next join the counts to the simple feature data frame by the common column name <code>GEOID</code></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tuesday-february-21-2023.html#cb11-1" aria-hidden="true" tabindex="-1"></a>Counties.sf <span class="ot">&lt;-</span> Counties.sf <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="tuesday-february-21-2023.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(TorCounts.df,</span>
<span id="cb11-3"><a href="tuesday-february-21-2023.html#cb11-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;GEOID&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="tuesday-february-21-2023.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">nT =</span> tidyr<span class="sc">::</span><span class="fu">replace_na</span>(nT, <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="tuesday-february-21-2023.html#cb11-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(Counties.sf),</span>
<span id="cb11-6"><a href="tuesday-february-21-2023.html#cb11-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">rate =</span> nT<span class="sc">/</span>Area<span class="sc">/</span>(<span class="dv">2020</span> <span class="sc">-</span> <span class="dv">2016</span> <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">10</span>,</span>
<span id="cb11-7"><a href="tuesday-february-21-2023.html#cb11-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">lpop =</span> <span class="fu">log10</span>(estimate))</span></code></pre></div>
<p>Note that some counties had no tornadoes and the <code>dplyr::left_join()</code> returns a value of <code>NA</code> for those. You use <code>dplyr::mutate()</code> with <code>tidyr::replace_na()</code> to turn those counts to a value of 0.</p>
<p>Make a two-panel map displaying the log of the population and the tornado rates.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="tuesday-february-21-2023.html#cb12-1" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> tmap<span class="sc">::</span><span class="fu">tm_shape</span>(Counties.sf) <span class="sc">+</span></span>
<span id="cb12-2"><a href="tuesday-february-21-2023.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="tuesday-february-21-2023.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;lpop&quot;</span>,</span>
<span id="cb12-4"><a href="tuesday-february-21-2023.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Log Population&quot;</span>,</span>
<span id="cb12-5"><a href="tuesday-february-21-2023.html#cb12-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="tuesday-february-21-2023.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb12-7"><a href="tuesday-february-21-2023.html#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="tuesday-february-21-2023.html#cb12-8" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> tmap<span class="sc">::</span><span class="fu">tm_shape</span>(Counties.sf) <span class="sc">+</span></span>
<span id="cb12-9"><a href="tuesday-february-21-2023.html#cb12-9" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="tuesday-february-21-2023.html#cb12-10" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;rate&quot;</span>,</span>
<span id="cb12-11"><a href="tuesday-february-21-2023.html#cb12-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Annual Rate</span><span class="sc">\n</span><span class="st">[/10,000 sq. km]&quot;</span>,</span>
<span id="cb12-12"><a href="tuesday-february-21-2023.html#cb12-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">palette =</span> <span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb12-13"><a href="tuesday-february-21-2023.html#cb12-13" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb12-14"><a href="tuesday-february-21-2023.html#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="tuesday-february-21-2023.html#cb12-15" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tmap_arrange</span>(map1, map2)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>There appears some relationship. The non-spatial correlation between the two variables is obtained with the <code>cor.test()</code> function</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="tuesday-february-21-2023.html#cb13-1" aria-hidden="true" tabindex="-1"></a>lpop <span class="ot">&lt;-</span> Counties.sf<span class="sc">$</span>lpop</span>
<span id="cb13-2"><a href="tuesday-february-21-2023.html#cb13-2" aria-hidden="true" tabindex="-1"></a>rate <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(Counties.sf<span class="sc">$</span>rate)</span>
<span id="cb13-3"><a href="tuesday-february-21-2023.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="tuesday-february-21-2023.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(lpop, rate)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  lpop and rate
## t = 2.7884, df = 97, p-value = 0.006376
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.07925894 0.44584430
## sample estimates:
##       cor 
## 0.2724085</code></pre>
<p>The bi-variate spatial autocorrelation is assessed using the Lee statistic. A formal non-parametric test under the null hypothesis of no bi-variate spatial autocorrelation is done using a Monte Carlo simulation</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tuesday-february-21-2023.html#cb15-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(Counties.sf)</span>
<span id="cb15-2"><a href="tuesday-february-21-2023.html#cb15-2" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs)</span>
<span id="cb15-3"><a href="tuesday-february-21-2023.html#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="tuesday-february-21-2023.html#cb15-4" aria-hidden="true" tabindex="-1"></a>Lee <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">lee</span>(lpop, rate, </span>
<span id="cb15-5"><a href="tuesday-february-21-2023.html#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">listw =</span> wts, </span>
<span id="cb15-6"><a href="tuesday-february-21-2023.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="fu">length</span>(nbs))</span>
<span id="cb15-7"><a href="tuesday-february-21-2023.html#cb15-7" aria-hidden="true" tabindex="-1"></a>Lee<span class="sc">$</span>L</span></code></pre></div>
<pre><code>## [1] 0.1755534</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tuesday-february-21-2023.html#cb17-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lee.mc</span>(lpop, rate, <span class="at">listw =</span> wts, <span class="at">nsim =</span> <span class="dv">9999</span>)</span></code></pre></div>
<pre><code>## 
##  Monte-Carlo simulation of Lee&#39;s L
## 
## data:  lpop ,  rate 
## weights: wts  
## number of simulations + 1: 10000 
## 
## statistic = 0.17555, observed rank = 9999, p-value = 1e-04
## alternative hypothesis: greater</code></pre>
<p>Finally you map out the local variation in the bi-variate spatial autocorrelation</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="tuesday-february-21-2023.html#cb19-1" aria-hidden="true" tabindex="-1"></a>Counties.sf<span class="sc">$</span>localL <span class="ot">&lt;-</span> Lee<span class="sc">$</span>localL</span>
<span id="cb19-2"><a href="tuesday-february-21-2023.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="tuesday-february-21-2023.html#cb19-3" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(Counties.sf) <span class="sc">+</span></span>
<span id="cb19-4"><a href="tuesday-february-21-2023.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="st">&quot;localL&quot;</span>,</span>
<span id="cb19-5"><a href="tuesday-february-21-2023.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Local Bivariate</span><span class="sc">\n</span><span class="st">Spatial Autocorrelation&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-6"><a href="tuesday-february-21-2023.html#cb19-6" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-7"><a href="tuesday-february-21-2023.html#cb19-7" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Variable(s) &quot;localL&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>What might cause this? Cedar County (dark green) lies between the cities of Cedar Rapids (to the northwest), Iowa City (to the west) and the Quad Cities (to the east). Commuters from neighboring counties into cities like Cedar Rapids provide an ad hoc spotter network for all kinds of phenomenon including severe weather and tornadoes</p>
<p>Repeat this analysis for the state of Kansas and compare/contrast the results and interpretation</p>
<p>Also, compare local Lee with local Moran</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="tuesday-february-21-2023.html#cb21-1" aria-hidden="true" tabindex="-1"></a>Ii_stats <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">localmoran</span>(rate, </span>
<span id="cb21-2"><a href="tuesday-february-21-2023.html#cb21-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">listw =</span> wts)</span>
<span id="cb21-3"><a href="tuesday-february-21-2023.html#cb21-3" aria-hidden="true" tabindex="-1"></a>Counties.sf<span class="sc">$</span>localI <span class="ot">=</span> Ii_stats[, <span class="dv">1</span>]</span>
<span id="cb21-4"><a href="tuesday-february-21-2023.html#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="tuesday-february-21-2023.html#cb21-5" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(Counties.sf) <span class="sc">+</span></span>
<span id="cb21-6"><a href="tuesday-february-21-2023.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="tuesday-february-21-2023.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;localI&quot;</span>,</span>
<span id="cb21-8"><a href="tuesday-february-21-2023.html#cb21-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Local Autocorrelation&quot;</span>,</span>
<span id="cb21-9"><a href="tuesday-february-21-2023.html#cb21-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">palette =</span> <span class="st">&quot;Purples&quot;</span>) <span class="sc">+</span></span>
<span id="cb21-10"><a href="tuesday-february-21-2023.html#cb21-10" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="st">&quot;TRUE&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The clustering of tornado occurrences coincides with the largest population corridor in the state</p>
</div>
<div id="constraining-group-membership-based-on-spatial-autocorrelation" class="section level2 unnumbered hasAnchor">
<h2>Constraining group membership based on spatial autocorrelation<a href="tuesday-february-21-2023.html#constraining-group-membership-based-on-spatial-autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As a spatial data analyst you likely will face the situation in which there are many variables and you need to group them in a way that minimizes inter-group variation but maximizes between-group variation. If you know the number of groups before hand then a common grouping (or clustering) method is called K-means</p>
<p>If your data is spatial you may want the additional constraint that the resulting groups be geographically linked. There are many situations that require separating geographies into discrete but contiguous regions (“regionalization”) such as designing communities, planning areas, amenity zones, logistical units, or for setting up experiments with real world geographic constraints</p>
<p>Optimal grouping using only traditional cluster metrics is generally sub-optimal in practice for regionalization because the metrics do not consider geographic contiguity</p>
<p>Unconstrained grouping on data with spatial characteristics may result in contiguous regions because of autocorrelation, but if you want to <em>ensure</em> that all groups are spatially-contiguous you need a method specifically designed for the task. The ‘skater’ algorithm available in the {spdep} package is well-implemented and well-documented</p>
<p>The ‘skater’ algorithm (spatial ’k’luster analysis by tree edge removal) builds a connectivity graph to represent spatial relationships between neighboring areas, where each area is represented by a node and edges represent connections between areas. Edge costs are calculated by evaluating the dissimilarity in attribute space between neighboring areas. The connectivity graph is reduced by pruning edges with higher dissimilarity</p>
<p>Consider again the crime data at the tract level in the city of Columbus, Ohio. The tract polygons are projected with arbitrary spatial coordinates</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="tuesday-february-21-2023.html#cb22-1" aria-hidden="true" tabindex="-1"></a>( CC.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus&quot;</span>),</span>
<span id="cb22-2"><a href="tuesday-february-21-2023.html#cb22-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">&quot;columbus&quot;</span>) )</span></code></pre></div>
<pre><code>## Reading layer `columbus&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/ASS-2023/data/columbus&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA</code></pre>
<pre><code>## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA
## First 10 features:
##        AREA PERIMETER COLUMBUS_ COLUMBUS_I POLYID NEIG  HOVAL    INC     CRIME
## 1  0.309441  2.440629         2          5      1    5 80.467 19.531 15.725980
## 2  0.259329  2.236939         3          1      2    1 44.567 21.232 18.801754
## 3  0.192468  2.187547         4          6      3    6 26.350 15.956 30.626781
## 4  0.083841  1.427635         5          2      4    2 33.200  4.477 32.387760
## 5  0.488888  2.997133         6          7      5    7 23.225 11.252 50.731510
## 6  0.283079  2.335634         7          8      6    8 28.750 16.029 26.066658
## 7  0.257084  2.554577         8          4      7    4 75.000  8.438  0.178269
## 8  0.204954  2.139524         9          3      8    3 37.125 11.337 38.425858
## 9  0.500755  3.169707        10         18      9   18 52.600 17.586 30.515917
## 10 0.246689  2.087235        11         10     10   10 96.400 13.598 34.000835
##        OPEN    PLUMB DISCBD     X     Y NSA NSB EW CP THOUS NEIGNO
## 1  2.850747 0.217155   5.03 38.80 44.07   1   1  1  0  1000   1005
## 2  5.296720 0.320581   4.27 35.62 42.38   1   1  0  0  1000   1001
## 3  4.534649 0.374404   3.89 39.82 41.18   1   1  1  0  1000   1006
## 4  0.394427 1.186944   3.70 36.50 40.52   1   1  0  0  1000   1002
## 5  0.405664 0.624596   2.83 40.01 38.00   1   1  1  0  1000   1007
## 6  0.563075 0.254130   3.78 43.75 39.28   1   1  1  0  1000   1008
## 7  0.000000 2.402402   2.74 33.36 38.41   1   1  0  0  1000   1004
## 8  3.483478 2.739726   2.89 36.71 38.71   1   1  0  0  1000   1003
## 9  0.527488 0.890736   3.17 43.44 35.92   1   1  1  0  1000   1018
## 10 1.548348 0.557724   4.33 47.61 36.42   1   1  1  0  1000   1010
##                          geometry
## 1  POLYGON ((8.624129 14.23698...
## 2  POLYGON ((8.25279 14.23694,...
## 3  POLYGON ((8.653305 14.00809...
## 4  POLYGON ((8.459499 13.82035...
## 5  POLYGON ((8.685274 13.63952...
## 6  POLYGON ((9.401384 13.5504,...
## 7  POLYGON ((8.037741 13.60752...
## 8  POLYGON ((8.247527 13.58651...
## 9  POLYGON ((9.333297 13.27242...
## 10 POLYGON ((10.08251 13.03377...</code></pre>
<p>First, create choropleth maps of housing value, income, and crime.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="tuesday-february-21-2023.html#cb25-1" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb25-2"><a href="tuesday-february-21-2023.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;HOVAL&quot;</span>, <span class="st">&quot;INC&quot;</span>, <span class="st">&quot;CRIME&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is
## assumed.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The maps show distinct regional patterns. Housing values and income are clustered toward the southeast and crime is clustered in the center. But although housing values are also high in the north you don’t necessarily want to group that tract with those in the southeast because they are geographically distinct</p>
<p>To group these patterns under the constraint of spatial contiguity you first scale the attribute values and center them using the <code>scale()</code> function. Scaling and centering variables should be done before any type of clustering procedure</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="tuesday-february-21-2023.html#cb27-1" aria-hidden="true" tabindex="-1"></a>( CCs.df <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="tuesday-february-21-2023.html#cb27-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">HOVALs =</span> <span class="fu">scale</span>(HOVAL),</span>
<span id="cb27-3"><a href="tuesday-february-21-2023.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">INCs =</span> <span class="fu">scale</span>(INC),</span>
<span id="cb27-4"><a href="tuesday-february-21-2023.html#cb27-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">CRIMEs =</span> <span class="fu">scale</span>(CRIME)) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="tuesday-february-21-2023.html#cb27-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(HOVALs, INCs, CRIMEs) <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="tuesday-february-21-2023.html#cb27-6" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() )</span></code></pre></div>
<pre><code>##         HOVALs        INCs      CRIMEs
## 1   2.27610855  0.90403637 -1.15961852
## 2   0.33200225  1.20228067 -0.97579369
## 3  -0.65450986  0.27721488 -0.26906635
## 4  -0.28355918 -1.73545197 -0.16382075
## 5  -0.82373916 -0.54755948  0.93250061
## 6  -0.52454175  0.29001413 -0.54160387
## 7   1.98005188 -1.04095129 -2.08883352
## 8  -0.07100723 -0.53265603  0.19704853
## 9   0.76701615  0.56301041 -0.27569218
## 10  3.13893423 -0.13622431 -0.06741470
## 11 -1.01462975 -1.21120127  1.62242856
## 12 -1.00379913 -0.75866244  1.28954855
## 13  0.17674452 -0.84615445  0.69251980
## 14  0.24172862 -0.77356589  1.31109176
## 15 -1.10669054 -0.78934601  0.80424271
## 16 -1.06336790 -1.18349839  1.17796908
## 17  0.17945213 -0.80249612  0.10398880
## 18  1.16775124 -0.20863754  0.52794726
## 19 -0.42435801 -0.48338699  1.15903863
## 20  2.31943098  2.92722331 -2.08611253
## 21 -0.99973763 -0.65223429  0.29555480
## 22 -0.43248096 -0.46743153 -0.08509252
## 23  0.50345189  1.18878008 -0.90128119
## 24  0.79950834 -0.02436078  0.18939933
## 25 -1.11210588 -1.03691859  1.56408123
## 26 -0.98213783 -1.10284443  0.34908475
## 27 -0.23482130 -0.62295340  1.05579183
## 28 -0.84404667 -1.14299607  1.30234528
## 29 -0.32146659 -0.99834496  1.53128622
## 30 -0.86300035 -0.08222123  2.01787200
## 31 -0.35937401  0.44974438 -1.04300226
## 32  0.10092968  0.80076407 -0.95524408
## 33 -0.80343164 -0.78145595  0.40875576
## 34 -0.54078771  0.10047751 -0.66667072
## 35 -0.61931016 -0.27368671  0.24182446
## 36 -0.11568382  0.76517130 -1.24451072
## 37  0.26338981  0.46324498  0.43725866
## 38 -0.85216962 -0.57298301  1.11056729
## 39  0.06302227  0.71923344 -0.95791733
## 40  1.27335038  2.71033430 -1.12882028
## 41  0.19840570  1.37323217 -0.96961443
## 42  0.31933030  2.01600877 -1.11384361
## 43 -0.68970950 -0.17444727  0.09172721
## 44 -0.26731322  0.45342623 -0.54784308
## 45 -0.57961574 -0.04206959 -0.36458895
## 46  2.03962048  0.69240723 -1.11153410
## 47  0.22006716  0.80216710 -0.43664372
## 48 -0.63014089 -0.44919672 -0.50702314
## 49 -0.14276051  0.77516538 -0.75228685</code></pre>
<p>Next create adjacency neighbors using queen contiguity. Note queen contiguity is the default but here you specify <code>TRUE</code> as a reminder that you can change this</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="tuesday-february-21-2023.html#cb29-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(CC.sf, </span>
<span id="cb29-2"><a href="tuesday-february-21-2023.html#cb29-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-3"><a href="tuesday-february-21-2023.html#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="tuesday-february-21-2023.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(CC.sf<span class="sc">$</span>geometry)</span>
<span id="cb29-5"><a href="tuesday-february-21-2023.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs, </span>
<span id="cb29-6"><a href="tuesday-february-21-2023.html#cb29-6" aria-hidden="true" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(CC.sf)),</span>
<span id="cb29-7"><a href="tuesday-february-21-2023.html#cb29-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Next combine the contiguity graph with your scaled attribute data to calculate edge costs based on distances between each node. The function <code>spdep::nbcosts()</code> provides distance methods for Euclidean, Manhattan, Canberra, binary, Minkowski, and Mahalanobis, and defaults to Euclidean if not specified like here. Save the object of class <code>nbdist</code> with name <code>edge_costs</code></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="tuesday-february-21-2023.html#cb30-1" aria-hidden="true" tabindex="-1"></a>edge_costs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nbcosts</span>(nbs, </span>
<span id="cb30-2"><a href="tuesday-february-21-2023.html#cb30-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> CCs.df)</span></code></pre></div>
<p>Next transform the edge costs into spatial weights using the <code>spdep::nb2listw()</code> function before constructing the minimum spanning tree with the weights list.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="tuesday-february-21-2023.html#cb31-1" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs,</span>
<span id="cb31-2"><a href="tuesday-february-21-2023.html#cb31-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">glist =</span> edge_costs,</span>
<span id="cb31-3"><a href="tuesday-february-21-2023.html#cb31-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">&quot;B&quot;</span>)</span>
<span id="cb31-4"><a href="tuesday-february-21-2023.html#cb31-4" aria-hidden="true" tabindex="-1"></a>mst <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">mstree</span>(wts)</span>
<span id="cb31-5"><a href="tuesday-february-21-2023.html#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="tuesday-february-21-2023.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mst)</span></code></pre></div>
<pre><code>##      [,1] [,2]      [,3]
## [1,]   13   14 0.6261975
## [2,]   13    8 0.6365171
## [3,]   14   19 0.7422906
## [4,]    8    5 1.0524815
## [5,]    5   15 0.3936652
## [6,]   15   16 0.5448893</code></pre>
<p>Edges with higher dissimilarity are removed leaving a set of nodes and edges that take the minimum sum of dissimilarities across all edges of the tree (a minimum spanning tree).</p>
<p>The edge connecting node (tract) 12 with node (tract) 16 has a dissimilarity of .44 units. The edge connecting tract 16 with tract 25 has a dissimilarity of .42 units</p>
<p>Finally, the <code>spdep::skater()</code> function partitions the graph by identifying which edges to remove based on dissimilarity while maximizing the between-group variation. The <code>ncuts =</code> argument specifies the number of partitions to make, resulting in <code>ncuts</code> + 1 groups</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="tuesday-february-21-2023.html#cb33-1" aria-hidden="true" tabindex="-1"></a>clus5 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">skater</span>(<span class="at">edges =</span> mst[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb33-2"><a href="tuesday-february-21-2023.html#cb33-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> CCs.df, </span>
<span id="cb33-3"><a href="tuesday-february-21-2023.html#cb33-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ncuts =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Where are these groups located?</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="tuesday-february-21-2023.html#cb34-1" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="tuesday-february-21-2023.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Group =</span> clus5<span class="sc">$</span>groups)</span>
<span id="cb34-3"><a href="tuesday-february-21-2023.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="tuesday-february-21-2023.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb34-5"><a href="tuesday-february-21-2023.html#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="tuesday-february-21-2023.html#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-7"><a href="tuesday-february-21-2023.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf,</span>
<span id="cb34-8"><a href="tuesday-february-21-2023.html#cb34-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(Group)))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The map shows five distinct regions based on the three variables of income, housing value, and crime. Importantly the regions are contiguous</p>
<p>Region 1 encompasses most tracts in the urban core where housing values and income are low and crime rates are highest. Regions 2 and 3 in the east and west are where housing values and income are moderately high and crime rates are lower. Region 4 is where income and housing values are highest and crime is the lowest</p>
<p>As a comparison, here is the result of grouping the same three variables using hierarchical clustering using the method of minimum variance (Ward) and without regard to spatial contiguity</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="tuesday-february-21-2023.html#cb35-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">dist</span>(CCs.df)</span>
<span id="cb35-2"><a href="tuesday-february-21-2023.html#cb35-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dd, </span>
<span id="cb35-3"><a href="tuesday-february-21-2023.html#cb35-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">&quot;ward.D&quot;</span>)</span>
<span id="cb35-4"><a href="tuesday-february-21-2023.html#cb35-4" aria-hidden="true" tabindex="-1"></a>hcGroup <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb35-5"><a href="tuesday-february-21-2023.html#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="tuesday-february-21-2023.html#cb35-6" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="tuesday-february-21-2023.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">hcGroup =</span> hcGroup)</span>
<span id="cb35-8"><a href="tuesday-february-21-2023.html#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="tuesday-february-21-2023.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-10"><a href="tuesday-february-21-2023.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf,</span>
<span id="cb35-11"><a href="tuesday-february-21-2023.html#cb35-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(hcGroup)))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Here the map shows five regions but the regions are not contiguous.</p>
<p>More information: <a href="https://www.tandfonline.com/doi/abs/10.1080/13658810600665111" class="uri">https://www.tandfonline.com/doi/abs/10.1080/13658810600665111</a></p>
<p>Also the {motif} package has functions that implement and extend ideas of the pattern-based spatial analysis. They can be used to describe spatial patterns of categorical raster data for any defined regular and irregular areas</p>
<p>Patterns are represented quantitatively using built-in signatures based on co-occurrence matrices but the functions are flexible to allow for user-defined functions. Functions enable spatial analysis such as search, change detection, and clustering to be performed on spatial patterns <a href="https://jakubnowosad.com/motif/" class="uri">https://jakubnowosad.com/motif/</a></p>
</div>
<div id="estimating-spatial-autocorrelation-in-model-residuals" class="section level2 unnumbered hasAnchor">
<h2>Estimating spatial autocorrelation in model residuals<a href="tuesday-february-21-2023.html#estimating-spatial-autocorrelation-in-model-residuals" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A spatial regression model should be entertained for your data whenever the residuals from an ordinary-least-squares (OLS) regression model exhibit significant spatial autocorrelation</p>
<p>So you first fit an OLS regression model regressing the response variable onto the explanatory variables and then check for autocorrelation in the residuals. If there is significant spatial autocorrelation in the residuals then you should consider some type of spatial regression model</p>
<p>Staying with the crime data at the tract level in the city of Columbus, Ohio</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="tuesday-february-21-2023.html#cb36-1" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus&quot;</span>),</span>
<span id="cb36-2"><a href="tuesday-february-21-2023.html#cb36-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">&quot;columbus&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `columbus&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/ASS-2023/data/columbus&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA</code></pre>
<p><code>CRIME</code> is the response variable and <code>INC</code> and <code>HOVAL</code> as the explanatory variables. How well do these two explanatory variables statistically explain the amount of crime at the tract level?</p>
<p>An answer to this question is obtained by regressing crime onto income and housing values. Here you use the <code>lm()</code> function and save the results to the object <code>model.ols</code></p>
<p>Set the formula, then use the formula as the first argument in the <code>lm()</code> function. Summarize the results with the <code>summary()</code> method</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="tuesday-february-21-2023.html#cb38-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> CRIME <span class="sc">~</span> INC <span class="sc">+</span> HOVAL</span>
<span id="cb38-2"><a href="tuesday-february-21-2023.html#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="tuesday-february-21-2023.html#cb38-3" aria-hidden="true" tabindex="-1"></a>model.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(f, </span>
<span id="cb38-4"><a href="tuesday-february-21-2023.html#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> CC.sf)</span>
<span id="cb38-5"><a href="tuesday-february-21-2023.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.ols)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = f, data = CC.sf)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -34.418  -6.388  -1.580   9.052  28.649 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  68.6190     4.7355  14.490  &lt; 2e-16 ***
## INC          -1.5973     0.3341  -4.780 1.83e-05 ***
## HOVAL        -0.2739     0.1032  -2.654   0.0109 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.43 on 46 degrees of freedom
## Multiple R-squared:  0.5524, Adjusted R-squared:  0.5329 
## F-statistic: 28.39 on 2 and 46 DF,  p-value: 9.341e-09</code></pre>
<p>The model statistically explains 55% of the variation in crime as is seen by looking at the multiple R-squared value</p>
<p>Looking at the coefficients (values under the <code>Estimate</code> column), you see that <em>higher</em> incomes are associated with <em>lower</em> values of crime (negative coefficient) and <em>higher</em> housing values are associated with <em>lower</em> crime. For every one unit increase in income, crime values decrease by 1.6 units</p>
<p>Use the <code>residuals()</code> method to extract the vector of residuals from the model object</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="tuesday-february-21-2023.html#cb40-1" aria-hidden="true" tabindex="-1"></a>( res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model.ols) )</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##   0.3465419  -3.6947990  -5.2873940 -19.9855151   6.4475490  -9.0734793 
##           7           8           9          10          11          12 
## -34.4177224  -1.9146840   4.3960594  13.5091017  10.9800573   9.5877236 
##          13          14          15          16          17          18 
##   4.7728320  16.1128397   0.6675424   3.5491565  -4.6630963  12.8399569 
##          19          20          21          22          23          24 
##  12.8428644   3.4948724  -6.0537589  -7.8697868  -1.7037730   6.9913819 
##          25          26          27          28          29          30 
##  11.0984343  -9.1741523  10.8026296   7.1086321  14.9005133  28.6487456 
##          31          32          33          34          35          36 
## -15.1722792  -8.1776706  -4.3438864 -12.9749799  -1.5798172 -14.4376850 
##          37          38          39          40          41          42 
##  12.8687861   9.0515532  -9.1569014  12.2449674  -2.7098171   1.3443547 
##          43          44          45          46          47          48 
##  -3.5432909  -6.3880045  -9.4155428  -1.9731210   1.1150296 -15.7632989 
##          49 
##  -6.2476690</code></pre>
<p>There are 49 residuals, one for each tract. The residuals are the difference between the observed crime rates and the predicted crime rates (observed - predicted). A residual that has a value greater than 0 indicates that the model <em>under</em> predicts the observed crime rate in that tract and a residual that has a value less than 0 indicates that the model <em>over</em> predicts the observed crime rate.</p>
<p>A normal distribution should be a good approximation to the distribution of the residuals. You check this with the <code>sm::sm.density()</code> function with the first argument the vector of residuals (<code>res</code>) and the argument <code>model =</code> set to “Normal”</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="tuesday-february-21-2023.html#cb42-1" aria-hidden="true" tabindex="-1"></a>sm<span class="sc">::</span><span class="fu">sm.density</span>(res, </span>
<span id="cb42-2"><a href="tuesday-february-21-2023.html#cb42-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;Normal&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The density curve of the residuals (black line) fits completely within the blue ribbon that defines a normal distribution</p>
<p>Next create a map of the model residuals. Do the residuals show any pattern of clustering? Since the values in the vector of residuals <code>res</code> are arranged in the same order as the rows in the simple feature data frame you create a new column in the data frame using the <code>$</code> syntax and calling the new column <code>res</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="tuesday-february-21-2023.html#cb43-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>res <span class="ot">&lt;-</span> res</span>
<span id="cb43-2"><a href="tuesday-february-21-2023.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="tuesday-february-21-2023.html#cb43-3" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb43-4"><a href="tuesday-february-21-2023.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;res&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-5"><a href="tuesday-february-21-2023.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb43-6"><a href="tuesday-february-21-2023.html#cb43-6" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Linear model residuals&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is
## assumed.</code></pre>
<pre><code>## Variable(s) &quot;res&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>The map shows contiguous tracts with negative residuals across the southwestern and southern part of the city and a group of contiguous tracts with positive residuals toward the center</p>
<p>The map indicates some clustering but the clustering appears to be less than with the crime values themselves. That is, after accounting for regional factors related to crime, the autocorrelation is reduced</p>
<p>To determine the amount of autocorrelation in the residuals use the <code>spdep::lm.morantest()</code> function, passing the regression model object and the weights object to it. Note that you once again use the default neighborhood and weighting schemes to generate the weights matrix <code>wts</code></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="tuesday-february-21-2023.html#cb46-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="tuesday-february-21-2023.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">poly2nb</span>()</span>
<span id="cb46-3"><a href="tuesday-february-21-2023.html#cb46-3" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> nbs <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="tuesday-february-21-2023.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">nb2listw</span>()</span>
<span id="cb46-5"><a href="tuesday-february-21-2023.html#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="tuesday-february-21-2023.html#cb46-6" aria-hidden="true" tabindex="-1"></a>model.ols <span class="sc">|&gt;</span></span>
<span id="cb46-7"><a href="tuesday-february-21-2023.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">lm.morantest</span>(<span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## 
##  Global Moran I for regression residuals
## 
## data:  
## model: lm(formula = f, data = CC.sf)
## weights: wts
## 
## Moran I statistic standard deviate = 2.8393, p-value = 0.00226
## alternative hypothesis: greater
## sample estimates:
## Observed Moran I      Expectation         Variance 
##      0.222109407     -0.033418335      0.008099305</code></pre>
<p>Moran’s I on the model residuals is .22. This compares with the value of .5 on the value of crime alone</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="tuesday-february-21-2023.html#cb48-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> CC.sf<span class="sc">$</span>CRIME <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="tuesday-february-21-2023.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>()</span>
<span id="cb48-3"><a href="tuesday-february-21-2023.html#cb48-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> wts <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="tuesday-february-21-2023.html#cb48-4" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">Szero</span>()</span>
<span id="cb48-5"><a href="tuesday-february-21-2023.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="tuesday-february-21-2023.html#cb48-6" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>CRIME <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="tuesday-february-21-2023.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">moran</span>(<span class="at">listw =</span> wts, </span>
<span id="cb48-8"><a href="tuesday-february-21-2023.html#cb48-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">n =</span> m, </span>
<span id="cb48-9"><a href="tuesday-february-21-2023.html#cb48-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">S0 =</span> s)</span></code></pre></div>
<pre><code>## $I
## [1] 0.5001886
## 
## $K
## [1] 2.225946</code></pre>
<p>Part of the autocorrelation in the crime rates is statistically ‘absorbed’ by the explanatory factors</p>
<p>The <span class="math inline">\(p\)</span>-value on I of .002, thus you reject the null hypothesis of no spatial autocorrelation in the model residuals and conclude that a spatial regression model would be an improvement over the non-spatial OLS model. The <span class="math inline">\(z\)</span>-value (as the basis for the <span class="math inline">\(p\)</span>-value) takes into account the fact that these are residuals from a model so the variance is adjusted accordingly</p>
<p>Given significant spatial autocorrelation in the model residuals, the next step is to choose the type of spatial regression model</p>
</div>
<div id="choosing-a-spatial-regression-model" class="section level2 unnumbered hasAnchor">
<h2>Choosing a spatial regression model<a href="tuesday-february-21-2023.html#choosing-a-spatial-regression-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Ordinary least-squares regression models fit to spatial data can lead to improper inference because observations are not independent. This might lead to poor policy decisions. If the residuals from an OLS model are strongly correlated the model is not specified properly</p>
<p>You can try to improve the model by adding variables. If that’s not possible (no additional data, or no clue as to what variable to include), you can try a spatial regression model. Spatial regression models are widely used in econometrics and epidemiology</p>
<p>The equation for a regression model in vector notation is</p>
<p><span class="math display">\[
y = X \beta + \varepsilon
\]</span>
where <span class="math inline">\(y\)</span> is a <span class="math inline">\(n\)</span> by 1 vector of response variable values, <span class="math inline">\(X\)</span> is a <span class="math inline">\(n\)</span> by <span class="math inline">\(p+1\)</span> matrix containing the explanatory variables and augmented by a column of ones for the intercept term, <span class="math inline">\(\beta\)</span> is a <span class="math inline">\(p+1\)</span> <span class="math inline">\(\times\)</span> 1 vector of model coefficients and <span class="math inline">\(\varepsilon\)</span> is a <span class="math inline">\(n\)</span> by 1 vector of residuals (iid: independent and identically distributed)</p>
<p>A couple options exist if the elements of the vector <span class="math inline">\(\varepsilon\)</span> are correlated. One is to include a spatial lag term so the model becomes</p>
<p><span class="math display">\[
y = \rho W y + X \beta + \varepsilon
\]</span></p>
<p>where <span class="math inline">\(Wy\)</span> is the weighted average of the neighborhood response values with <span class="math inline">\(W\)</span> the spatial weights matrix, and <span class="math inline">\(\rho\)</span> is the autoregression coefficient. This is called a spatial autoregressive (SAR) model</p>
<p>Note: <span class="math inline">\(Wy\)</span> is the spatial lag variable you compute with the <code>spdep::lag.listw()</code> function and <span class="math inline">\(\rho\)</span> is Moran’s I. Thus the model is also called a spatial lag model (SLM)</p>
<p>Justification for the spatial lag model is domain specific but motivated by a ‘diffusion’ process. The response variable <span class="math inline">\(y_i\)</span> is influenced by the explanatory variables at location <span class="math inline">\(i\)</span> and by explanatory variables at locations <span class="math inline">\(j\)</span></p>
<p><span class="math inline">\(\rho Wy\)</span> is called the <em>spatial signal</em> term and <span class="math inline">\(\beta X\)</span> is called the <em>trend</em> term</p>
<p>Another option is to include a spatial error term so the model becomes</p>
<p><span class="math display">\[
y = X\beta + \lambda W \epsilon + u
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is the autoregression coefficient, <span class="math inline">\(W\epsilon\)</span> is the spatial error term representing the weighted average of the neighborhood residuals, and <span class="math inline">\(u\)</span> are the overall residuals assumed to be iid. This is called a spatial error model (SEM)</p>
<p>Here the lag term is computed using the residuals rather the response variable</p>
<p>Application of the spatial error model is motivated by the omitted variable bias. Suppose the variable <span class="math inline">\(y\)</span> is statistically described by two variables <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> each centered on zero and independent. Then</p>
<p><span class="math display">\[
y = \beta x + \theta z
\]</span></p>
<p>If <span class="math inline">\(z\)</span> is not observed, then the vector <span class="math inline">\(\theta z\)</span> is nested in the error term <span class="math inline">\(\epsilon\)</span></p>
<p><span class="math display">\[
y = \beta x + \epsilon
\]</span></p>
<p>Examples of an unobserved latent variable <span class="math inline">\(z\)</span> include local culture, social capital, neighborhood readiness. Importantly you would expect the latent variable to be spatially correlated (e.g., culture will be similar across neighborhoods), so let</p>
<p><span class="math display">\[
z = \lambda W z + r\\
z = (I - \lambda W)^{-1} r
\]</span></p>
<p>where <span class="math inline">\(r\)</span> is a vector of random independent residuals (e.g., culture is similar but not identical), <span class="math inline">\(W\)</span> is the spatial weights matrix and <span class="math inline">\(\lambda\)</span> is a scalar spatial correlation parameter. Substituting into the equation above</p>
<p><span class="math display">\[
y = \beta x + \theta z \\
y = \beta x +   \theta (I - \lambda W)^{-1} r\\
y = \beta x + (I - \lambda W)^{-1} \varepsilon
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\varepsilon = \theta r
\]</span></p>
<p>Another motivation for considering a spatial error model is heterogeneity. Suppose you have multiple observations for each unit. If you want a model that incorporates individual effects you can include a <span class="math inline">\(n \times 1\)</span> vector <span class="math inline">\(a\)</span> of individual intercepts for each unit</p>
<p><span class="math display">\[
y = a + X\beta
\]</span></p>
<p>where now <span class="math inline">\(X\)</span> is a <span class="math inline">\(n\)</span> <span class="math inline">\(\times\)</span> <span class="math inline">\(p\)</span> matrix</p>
<p>In a cross-sectional setting with one observation per unit (typically the case in observational studies), this approach is not possible since you will have more parameters than observations</p>
<p>Instead you can treat <span class="math inline">\(a\)</span> as a vector of spatial random effects. You assume that the intercepts follows a spatially smoothed process</p>
<p><span class="math display">\[
a = \lambda W a + \epsilon \\
a = (I - \lambda W)^{-1} \epsilon
\]</span></p>
<p>which leads to the previous model</p>
<p><span class="math display">\[
y = X\beta + (I - \lambda W)^{-1} \epsilon
\]</span></p>
<p>In the absence of domain-specific knowledge of the process that might be responsible for the spatially autocorrelated residuals, you can run some statistical tests on the linear model</p>
<p>The tests are performed with the <code>spdep::lm.LMtests()</code> function. The <code>LM</code> stands for ‘Lagrange multiplier’ indicating that the technique simultaneously determines the coefficients on the explanatory variables AND the coefficient on the spatial lag variable</p>
<p>The test type is specified as a character string. The tests should be considered in a sequence starting with the standard versions and moving to the ‘robust’ versions if the choice remains ambiguous</p>
<p>To perform LM tests you specify the model object, the weights matrix, and the two model types using the <code>test =</code> argument. The model types are specified as character strings <code>"LMerr"</code> and <code>"LMlag"</code> for the spatial error and lag models, respectively</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="tuesday-february-21-2023.html#cb50-1" aria-hidden="true" tabindex="-1"></a>model.ols <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="tuesday-february-21-2023.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">lm.LMtests</span>(<span class="at">listw =</span> wts, </span>
<span id="cb50-3"><a href="tuesday-february-21-2023.html#cb50-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;LMerr&quot;</span>, <span class="st">&quot;LMlag&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = f, data = CC.sf)
## weights: wts
## 
## LMerr = 5.2062, df = 1, p-value = 0.02251
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = f, data = CC.sf)
## weights: wts
## 
## LMlag = 8.898, df = 1, p-value = 0.002855</code></pre>
<p>The output shows that both the spatial error and spatial lag models are significant (<span class="math inline">\(p\)</span>-value &lt; .15). Ideally one model is significant and the other is not, and you choose the model that is significant</p>
<p>Since both are significant, you test again. This time you use the robust forms of the statistics with character strings <code>"RLMerr"</code> and <code>"RLMlag"</code> in the <code>test =</code> argument</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="tuesday-february-21-2023.html#cb52-1" aria-hidden="true" tabindex="-1"></a>model.ols <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="tuesday-february-21-2023.html#cb52-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">lm.LMtests</span>(<span class="at">listw =</span> wts, </span>
<span id="cb52-3"><a href="tuesday-february-21-2023.html#cb52-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;RLMerr&quot;</span>, <span class="st">&quot;RLMlag&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = f, data = CC.sf)
## weights: wts
## 
## RLMerr = 0.043906, df = 1, p-value = 0.834
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = f, data = CC.sf)
## weights: wts
## 
## RLMlag = 3.7357, df = 1, p-value = 0.05326</code></pre>
<p>Here the error model has a large <span class="math inline">\(p\)</span>-value and the lag model has a <span class="math inline">\(p\)</span>-value that is less than .15 so you choose the lag model for your spatial regression</p>
<p>A decision tree (from Luc Anselin) shows the sequence of tests for making a choice about which type of spatial model to use <a href="http://myweb.fsu.edu/jelsner/temp/SpatialRegressionDecisionTree.png">Decision Tree</a></p>
<p>If both tests show significance models, then you should fit both models and check which one results in the lowest information criteria (AIC)</p>
<p>Another options is to include both a spatial lag term and a spatial error term into a single model</p>
<p>Ordinary least-squares regression models fit to spatial data can lead to improper inference because observations are not independent. This might lead to poor policy decisions. Thus it’s necessary to check the residuals from an aspatial model for autocorrelation. If the residuals are strongly correlated the model is not specified properly</p>
</div>
<div id="fitting-and-interpreting-spatial-regression-models" class="section level2 unnumbered hasAnchor">
<h2>Fitting and interpreting spatial regression models<a href="tuesday-february-21-2023.html#fitting-and-interpreting-spatial-regression-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Recall that the marginal effect of income on crime is -1.6 and the marginal effect of housing value on crime is -.27</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="tuesday-february-21-2023.html#cb54-1" aria-hidden="true" tabindex="-1"></a>model.ols</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = f, data = CC.sf)
## 
## Coefficients:
## (Intercept)          INC        HOVAL  
##     68.6190      -1.5973      -0.2739</code></pre>
<p>A nice way to visualize the relative significance of the explanatory variables is to make a plot. Here you use the <code>broom::tidy()</code> method and then <code>ggplot()</code> as follows</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="tuesday-february-21-2023.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(broom)) <span class="fu">install.packages</span>(<span class="at">pkgs =</span> <span class="st">&quot;broom&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: broom</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="tuesday-february-21-2023.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb58-2"><a href="tuesday-february-21-2023.html#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="tuesday-february-21-2023.html#cb58-3" aria-hidden="true" tabindex="-1"></a>( d <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">tidy</span>(model.ols, </span>
<span id="cb58-4"><a href="tuesday-february-21-2023.html#cb58-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">conf.int =</span> <span class="cn">TRUE</span>) )</span></code></pre></div>
<pre><code>## # A tibble: 3 × 7
##   term        estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   68.6       4.74      14.5  9.21e-19   59.1     78.2   
## 2 INC           -1.60      0.334     -4.78 1.83e- 5   -2.27    -0.925 
## 3 HOVAL         -0.274     0.103     -2.65 1.09e- 2   -0.482   -0.0662</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="tuesday-february-21-2023.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb60-2"><a href="tuesday-february-21-2023.html#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="tuesday-february-21-2023.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d[<span class="sc">-</span><span class="dv">1</span>,], <span class="fu">aes</span>(<span class="at">x =</span> estimate,  <span class="co"># we do not plot the intercept term</span></span>
<span id="cb60-4"><a href="tuesday-february-21-2023.html#cb60-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> term, </span>
<span id="cb60-5"><a href="tuesday-february-21-2023.html#cb60-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmin =</span> conf.low, </span>
<span id="cb60-6"><a href="tuesday-february-21-2023.html#cb60-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmax =</span> conf.high, </span>
<span id="cb60-7"><a href="tuesday-february-21-2023.html#cb60-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb60-8"><a href="tuesday-february-21-2023.html#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb60-9"><a href="tuesday-february-21-2023.html#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb60-10"><a href="tuesday-february-21-2023.html#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>The maximum likelihood estimate is shown as a point and the confidence interval around the estimate is shown as a horizontal error bar. The default confidence level is 95% (<code>conf.level = .95</code>). The effects are statistically significant as the confidence intervals do not intersect the zero line (dashed-dotted)</p>
<p>But you’ve shown above that the model residuals have significant spatial autocorrelation so reporting the marginal effects with an OLS regression model is incorrect</p>
<p>Instead, you fit a spatially-lagged Y model using the <code>lagsarlm()</code> function from the {spatialreg} package. The model is</p>
<p><span class="math display">\[
y = \rho W y + X \beta + \varepsilon
\]</span></p>
<p>where <span class="math inline">\(Wy\)</span> is the weighted average of the neighborhood response values (spatial lag variable) with <span class="math inline">\(W\)</span> the spatial weights matrix, and <span class="math inline">\(\rho\)</span> is the autoregression coefficient</p>
<p>The <code>spatialreg::lagsarlm()</code> function first determines a value for <span class="math inline">\(\rho\)</span> ( with the internal <code>optimize()</code> function) and then the <span class="math inline">\(\beta\)</span>’s are obtained using generalized least squares (GLS). The model formula <code>f</code> is the same as what you used to fit the OLS regression above. You save the model object as <code>model.slym</code></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="tuesday-february-21-2023.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(spatialreg)) <span class="fu">install.packages</span>(<span class="at">pkgs =</span> <span class="st">&quot;spatialreg&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: spatialreg</code></pre>
<pre><code>## Loading required package: spData</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="tuesday-february-21-2023.html#cb67-1" aria-hidden="true" tabindex="-1"></a>model.slym <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">lagsarlm</span>(<span class="at">formula =</span> f, </span>
<span id="cb67-2"><a href="tuesday-february-21-2023.html#cb67-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> CC.sf, </span>
<span id="cb67-3"><a href="tuesday-february-21-2023.html#cb67-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">listw =</span> wts)</span>
<span id="cb67-4"><a href="tuesday-february-21-2023.html#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="tuesday-february-21-2023.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.slym)</span></code></pre></div>
<pre><code>## 
## Call:spatialreg::lagsarlm(formula = f, data = CC.sf, listw = wts)
## 
## Residuals:
##        Min         1Q     Median         3Q        Max 
## -37.652017  -5.334611   0.071473   6.107196  23.302618 
## 
## Type: lag 
## Coefficients: (asymptotic standard errors) 
##              Estimate Std. Error z value  Pr(&gt;|z|)
## (Intercept) 45.603250   7.257404  6.2837 3.306e-10
## INC         -1.048728   0.307406 -3.4115  0.000646
## HOVAL       -0.266335   0.089096 -2.9893  0.002796
## 
## Rho: 0.42333, LR test value: 9.4065, p-value: 0.0021621
## Asymptotic standard error: 0.11951
##     z-value: 3.5422, p-value: 0.00039686
## Wald statistic: 12.547, p-value: 0.00039686
## 
## Log likelihood: -182.674 for lag model
## ML residual variance (sigma squared): 96.857, (sigma: 9.8416)
## Number of observations: 49 
## Number of parameters estimated: 5 
## AIC: 375.35, (AIC for lm: 382.75)
## LM test for residual autocorrelation
## test value: 0.24703, p-value: 0.61917</code></pre>
<p>The first batch of output concerns the model residuals and the coefficients on the explanatory variables. The model residuals are the observed crime rates minus the predicted crime rates</p>
<p>The coefficients on income and housing have the same sign (negative) and they remain statistically significant (-1.05 for income and -.27 for housing value). But you can’t interpret these coefficients as the marginal effects</p>
<p>The next set of output is about the coefficient of spatial autocorrelation (<span class="math inline">\(\rho\)</span>). The value is .423 and a likelihood ratio test gives a value of 9.41 which translates to a <span class="math inline">\(p\)</span>-value of .002. The null hypothesis is the autocorrelation is zero, so you confidently reject it. This is consistent with the significant Moran’s I value that you found in the linear model residuals</p>
<p>Two other tests are performed on the value of <span class="math inline">\(\rho\)</span> including a z-test (t-test) using the asymptotic standard error and a Wald test. Both tests confirm that the lag term should be included in the model from crime involving income and housing values</p>
<p>In spatial models that contain a lagged response term, the coefficients are not marginal effects. The spatial lag model allows for ‘spillover’. That is a change in an explanatory variable anywhere in the study domain will affect the value of the response variable <em>everywhere</em>. Spillover occurs even when the neighborhood weights matrix represents local contiguity. The spillover makes interpreting the coefficients more complicated</p>
<p>With a spatially-lagged Y model a change in the value of an explanatory variable results in both <em>direct</em> and <em>indirect</em> effects on the response variable</p>
<p>For example, the direct effect gives the impact a change in income has on crime averaged over all tracts. It takes into account the effects that occur from a change in the <span class="math inline">\(i\)</span>th tract’s income on crime across neighboring tracts</p>
<p>The indirect effect gives the impact of a change in income has on crime averaged over all <em>other</em> tracts. The indirect effect represent spillovers. The influences on the dependent variable <span class="math inline">\(y\)</span> in a region rendered by change in <span class="math inline">\(x\)</span> in some <em>other</em> region. For example, if all tracts <span class="math inline">\(i \ne j\)</span> (i not equal to j) increase their income, what will be the impact on crime in region <span class="math inline">\(i\)</span>?</p>
<p>The total effect (TE) is the sum of the direct and indirect effects. It measures the total cumulative impact on crime arising from one tract <span class="math inline">\(j\)</span> increasing its income over all other tracts (on average). It is given by</p>
<p><span class="math display">\[
\hbox{TE} = \left(\frac{\beta_k}{1-\rho^2}\right)\left(1 + \rho\right)
\]</span></p>
<p>where <span class="math inline">\(\beta_k\)</span> is the effect of variable <span class="math inline">\(k\)</span> and <span class="math inline">\(\rho\)</span> is the spatial autocorrelation coefficient. With <span class="math inline">\(\rho = 0\)</span> TE is <span class="math inline">\(\beta_k\)</span></p>
<p>Here <span class="math inline">\(\beta_{INC}\)</span> is -1.0487 and <span class="math inline">\(\rho\)</span> is .4233, so the total effect is</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="tuesday-february-21-2023.html#cb69-1" aria-hidden="true" tabindex="-1"></a>( TE_INC <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.0487</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .<span class="dv">4233</span><span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> .<span class="dv">4233</span>) )</span></code></pre></div>
<pre><code>## [1] -1.81845</code></pre>
<p>The direct, indirect, and total effects are shown using the <code>spatialreg::impacts()</code> function</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="tuesday-february-21-2023.html#cb71-1" aria-hidden="true" tabindex="-1"></a>model.slym <span class="sc">|&gt;</span> </span>
<span id="cb71-2"><a href="tuesday-february-21-2023.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  spatialreg<span class="sc">::</span><span class="fu">impacts</span>(<span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## Impact measures (lag, exact):
##           Direct   Indirect      Total
## INC   -1.1008955 -0.7176833 -1.8185788
## HOVAL -0.2795832 -0.1822627 -0.4618459</code></pre>
<p>The direct effects are the changes in the response variable of a particular region arising from a one unit increase in an explanatory variable in that region</p>
<p>The indirect effects are the changes in the response variable of a particular region arising from a one unit increase in an explanatory variable in another region. For example, due to spatial autocorrelation, a one-unit change in the income variable in region 1 affects the crime rate in regions 2 and 3</p>
<p>The next set of output concerns the overall model fit. It includes the log likelihood value and the AIC (Akaike Information Criterion). The AIC value for the linear model is included. Here it is clear that the spatial lag model is an improvement (smaller AIC) over the aspatial model</p>
<p>The larger the likelihood, the better the model and two times the difference in log likelihoods from two competing models divided by the number of observations gives a scale for how much improvement</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="tuesday-february-21-2023.html#cb73-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(model.slym) <span class="sc">-</span> <span class="fu">logLik</span>(model.ols))<span class="sc">/</span><span class="dv">49</span></span>
<span id="cb73-2"><a href="tuesday-february-21-2023.html#cb73-2" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 0.1919701</code></pre>
<p>Improvement table</p>
<table>
<thead>
<tr class="header">
<th>Likelihood difference</th>
<th>Qualitative improvement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>huge</td>
</tr>
<tr class="even">
<td>.1</td>
<td>large</td>
</tr>
<tr class="odd">
<td>.01</td>
<td>good</td>
</tr>
<tr class="even">
<td>.001</td>
<td>okay</td>
</tr>
</tbody>
</table>
<p>The final bit of output is a Lagrange multiplier test for remaining autocorrelation. The null hypothesis is there is no remaining autocorrelation since we have a lag term in the model. The result is a high <span class="math inline">\(p\)</span>-value so you are satisfied that the lag term takes care of the autocorrelation</p>
<p>Compare the spatial lag model to a spatial error model. Here you use the <code>spatialreg::errorsarlm()</code> function.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="tuesday-february-21-2023.html#cb75-1" aria-hidden="true" tabindex="-1"></a>model.sem <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">errorsarlm</span>(<span class="at">formula =</span> f, </span>
<span id="cb75-2"><a href="tuesday-february-21-2023.html#cb75-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> CC.sf, </span>
<span id="cb75-3"><a href="tuesday-february-21-2023.html#cb75-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">listw =</span> wts)</span>
<span id="cb75-4"><a href="tuesday-february-21-2023.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.sem)</span></code></pre></div>
<pre><code>## 
## Call:spatialreg::errorsarlm(formula = f, data = CC.sf, listw = wts)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -34.65998  -6.16943  -0.70623   7.75392  23.43878 
## 
## Type: error 
## Coefficients: (asymptotic standard errors) 
##              Estimate Std. Error z value  Pr(&gt;|z|)
## (Intercept) 60.279469   5.365594 11.2344 &lt; 2.2e-16
## INC         -0.957305   0.334231 -2.8642 0.0041806
## HOVAL       -0.304559   0.092047 -3.3087 0.0009372
## 
## Lambda: 0.54675, LR test value: 7.2556, p-value: 0.0070679
## Asymptotic standard error: 0.13805
##     z-value: 3.9605, p-value: 7.4786e-05
## Wald statistic: 15.686, p-value: 7.4786e-05
## 
## Log likelihood: -183.7494 for error model
## ML residual variance (sigma squared): 97.674, (sigma: 9.883)
## Number of observations: 49 
## Number of parameters estimated: 5 
## AIC: 377.5, (AIC for lm: 382.75)</code></pre>
<p>You find the coefficient of spatial autocorrelation (<span class="math inline">\(\lambda\)</span>) is significant, but the log likelihood value from the model is smaller (-183.7) and the AIC value is larger (377.5) compared with corresponding values from the lag model. This is consistent with the Lagrange multiplier (LM) tests indicating the spatial lag model is more appropriate</p>
<p>Also you can compare the log likelihoods from the two spatial regression models that you fit</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="tuesday-february-21-2023.html#cb77-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(model.slym) <span class="sc">-</span> <span class="fu">logLik</span>(model.sem))<span class="sc">/</span><span class="dv">49</span></span>
<span id="cb77-2"><a href="tuesday-february-21-2023.html#cb77-2" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 0.04389617</code></pre>
<p>With a value of .04 you conclude that there is good improvement of the lag model over the error model. Again, this is consistent with your decision above to use the lag model</p>
<p>With the spatial error model the coefficients can be interpreted as marginal effects like with the OLS model</p>
<p>If there are large differences (e.g., different signs) between the coefficient estimate from SEM and OLS, this suggests that neither model is yielding parameters estimates matching the underlying parameters of the data generating process</p>
<p>You test whether there is a significant difference in coefficient estimates with the Hausman test under the hypothesis of no difference.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="tuesday-february-21-2023.html#cb79-1" aria-hidden="true" tabindex="-1"></a>spatialreg<span class="sc">::</span><span class="fu">Hausman.test</span>(model.sem)</span></code></pre></div>
<pre><code>## 
##  Spatial Hausman test (asymptotic)
## 
## data:  NULL
## Hausman test = 5.6132, df = 3, p-value = 0.132</code></pre>
<p>The <span class="math inline">\(p\)</span>-value gives inconclusive evidence that the coefficients are different and that maybe the SEM is not the right way to proceed with these data</p>
<p>The <code>predict()</code> method implements the <code>predict.sarlm()</code> function to calculate predictions from the spatial regression model. The prediction on a spatial lag Y model is decomposed into a “trend” term (explanatory variable effect) and a “signal” term (spatial smoother). The predicted fit is the sum of the trend and the signal terms when using the spatial lag model.</p>
<p>You make predictions with the <code>predict()</code> method under the assumption that the mean response is known. You examine the structure of the corresponding predict object.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="tuesday-february-21-2023.html#cb81-1" aria-hidden="true" tabindex="-1"></a>( predictedValues <span class="ot">&lt;-</span> <span class="fu">predict</span>(model.slym) )</span></code></pre></div>
<pre><code>## This method assumes the response is known - see manual page</code></pre>
<pre><code>##          fit     trend    signal
## 1  14.151553  3.689376 10.462177
## 2  22.577864 11.466910 11.110954
## 3  34.302562 21.851821 12.450741
## 4  46.732511 32.065778 14.666733
## 5  44.747335 27.617335 17.130001
## 6  38.333111 21.136061 17.197049
## 7  37.830286 16.778971 21.051314
## 8  41.393775 23.826139 17.567636
## 9  28.792040 13.151106 15.640934
## 10 16.390116  5.667968 10.722148
## 11 53.631524 32.525601 21.105923
## 12 48.074429 29.765567 18.308862
## 13 40.608933 24.482783 16.126150
## 14 41.856029 23.729007 18.127021
## 15 51.665885 30.455130 21.210754
## 16 54.767238 32.599604 22.167634
## 17 31.866732 24.208333  7.658399
## 18 37.461969 15.795681 21.666289
## 19 44.929428 25.269281 19.660147
## 20  5.110404 -8.624965 13.735369
## 21 47.617356 29.109014 18.508343
## 22 40.412907 25.213797 15.199111
## 23 18.640125 10.704444  7.935681
## 24 39.747460 16.504544 23.242917
## 25 53.116667 31.962568 21.154099
## 26 52.303708 31.717686 20.586022
## 27 39.228078 25.171897 14.056180
## 28 51.354572 31.278691 20.075881
## 29 49.767662 27.843360 21.924302
## 30 45.589426 25.027103 20.562323
## 31 27.465214 19.368347  8.096867
## 32 20.869990 15.004949  5.865041
## 33 44.697299 28.916463 15.780837
## 34 31.720868 22.349636  9.371232
## 35 38.985264 24.973807 14.011457
## 36 24.222607 16.283179  7.939428
## 37 37.811893 16.224746 21.587148
## 38 46.388525 27.909226 18.479299
## 39 22.524680 15.679043  6.845638
## 40  6.730001 -2.182900  8.912900
## 41 20.020878 11.101447  8.919431
## 42 14.764446  6.662086  8.102360
## 43 40.034408 24.726462 15.307946
## 44 34.026283 18.893555 15.132728
## 45 36.970894 23.393214 13.577680
## 46 13.189170  6.118277  7.070893
## 47 21.849812 14.410621  7.439191
## 48 38.162353 26.076852 12.085501
## 49 27.876102 16.356569 11.519533</code></pre>
<p>The predicted values are in the column labeled <code>fit</code>. The predicted values are a sum of the trend term (<span class="math inline">\(X\beta\)</span>) and the signal term (<span class="math inline">\(\rho W y\)</span>). The signal term is called the spatial smoother</p>
<p>As a first-order check if things are what you think they are, compare the first five predicted values with the corresponding observed values</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="tuesday-february-21-2023.html#cb84-1" aria-hidden="true" tabindex="-1"></a>predictedValues[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>##        1        2        3        4        5 
## 14.15155 22.57786 34.30256 46.73251 44.74734</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="tuesday-february-21-2023.html#cb86-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>CRIME[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre><code>## [1] 15.72598 18.80175 30.62678 32.38776 50.73151</code></pre>
<p>Some predicted values are lower than the corresponding observed values and some are higher</p>
<p>The predicted values along with the values for the trend and signal are added to the simple features data frame</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="tuesday-february-21-2023.html#cb88-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(predictedValues)</span>
<span id="cb88-2"><a href="tuesday-february-21-2023.html#cb88-2" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>trend <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictedValues, <span class="st">&quot;trend&quot;</span>)</span>
<span id="cb88-3"><a href="tuesday-february-21-2023.html#cb88-3" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>signal <span class="ot">&lt;-</span> <span class="fu">attr</span>(predictedValues, <span class="st">&quot;signal&quot;</span>)</span></code></pre></div>
<p>You plot the observed versus the predicted as a scatter plot with a y = x line and a best-fit regression line</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="tuesday-february-21-2023.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> CC.sf,</span>
<span id="cb89-2"><a href="tuesday-february-21-2023.html#cb89-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CRIME, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="tuesday-february-21-2023.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb89-4"><a href="tuesday-february-21-2023.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-5"><a href="tuesday-february-21-2023.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span></span>
<span id="cb89-6"><a href="tuesday-february-21-2023.html#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb89-7"><a href="tuesday-february-21-2023.html#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb89-8"><a href="tuesday-february-21-2023.html#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Observed Crime&quot;</span>) <span class="sc">+</span></span>
<span id="cb89-9"><a href="tuesday-february-21-2023.html#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Predicted Crime&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula = &#39;y ~ x&#39;</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>The components of the predictions are mapped and placed on the same plot</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="tuesday-february-21-2023.html#cb91-1" aria-hidden="true" tabindex="-1"></a>( g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb91-2"><a href="tuesday-february-21-2023.html#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf, <span class="fu">aes</span>(<span class="at">fill =</span> fit)) <span class="sc">+</span></span>
<span id="cb91-3"><a href="tuesday-february-21-2023.html#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb91-4"><a href="tuesday-february-21-2023.html#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Predicted Crime&quot;</span>) )</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="tuesday-february-21-2023.html#cb92-1" aria-hidden="true" tabindex="-1"></a>( g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-2"><a href="tuesday-february-21-2023.html#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf, <span class="fu">aes</span>(<span class="at">fill =</span> trend)) <span class="sc">+</span></span>
<span id="cb92-3"><a href="tuesday-february-21-2023.html#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb92-4"><a href="tuesday-february-21-2023.html#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Trend (Explanatory Variables)&quot;</span>) )</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-41-2.png" width="672" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="tuesday-february-21-2023.html#cb93-1" aria-hidden="true" tabindex="-1"></a>( g3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-2"><a href="tuesday-february-21-2023.html#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf, <span class="fu">aes</span>(<span class="at">fill =</span> signal)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="tuesday-february-21-2023.html#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb93-4"><a href="tuesday-february-21-2023.html#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Signal&quot;</span>) )</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-41-3.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="tuesday-february-21-2023.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb94-2"><a href="tuesday-february-21-2023.html#cb94-2" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2 <span class="sc">+</span> g3</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-41-4.png" width="672" /></p>
<p>The trend term and the spatial smoother have similar ranges indicating nearly equal contributions to the predictions. The largest difference between the two terms occurs in the city’s east side</p>
<p>A map of the difference makes this clear</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="tuesday-february-21-2023.html#cb95-1" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a href="tuesday-february-21-2023.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CovMinusSmooth =</span> trend <span class="sc">-</span> signal)</span>
<span id="cb95-3"><a href="tuesday-february-21-2023.html#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="tuesday-february-21-2023.html#cb95-4" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb95-5"><a href="tuesday-february-21-2023.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;CovMinusSmooth&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is
## assumed.</code></pre>
<pre><code>## Variable(s) &quot;CovMinusSmooth&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>How many tracts have a smaller residual with the lag model versus the OLS model?</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="tuesday-february-21-2023.html#cb98-1" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="sc">|&gt;</span></span>
<span id="cb98-2"><a href="tuesday-february-21-2023.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">residualsL =</span> CRIME <span class="sc">-</span> fit,</span>
<span id="cb98-3"><a href="tuesday-february-21-2023.html#cb98-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">lagWins =</span> <span class="fu">abs</span>(<span class="fu">residuals</span>(model.ols)) <span class="sc">&gt;</span> <span class="fu">abs</span>(residualsL),</span>
<span id="cb98-4"><a href="tuesday-february-21-2023.html#cb98-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">CovMinusSmooth =</span> trend <span class="sc">-</span> signal) <span class="sc">|&gt;</span></span>
<span id="cb98-5"><a href="tuesday-february-21-2023.html#cb98-5" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">|&gt;</span></span>
<span id="cb98-6"><a href="tuesday-february-21-2023.html#cb98-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">N =</span> <span class="fu">sum</span>(lagWins))</span></code></pre></div>
<pre><code>##    N
## 1 32</code></pre>
<p>In 32 out of the 49 tracts the residuals from the spatial model are smaller than the residuals from the OLS model</p>
<p>Another spatial regression option is to modify the linear model to include spatially-lagged explanatory variables. This is called the spatially-lagged X model</p>
<p><span class="math display">\[
y = X \beta + XW \theta + \varepsilon
\]</span></p>
<p>In this case the weights matrix is (post) multiplied by the matrix of X variables where <span class="math inline">\(W\)</span> is again the weights matrix and <span class="math inline">\(\theta\)</span> is a vector of coefficients for each lagged explanatory variable</p>
<p>Here you fit the spatially-lagged X model using the <code>spatialreg::lmSLX()</code> function and save the model object as <code>model.slxm</code></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="tuesday-february-21-2023.html#cb100-1" aria-hidden="true" tabindex="-1"></a>( model.slxm <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">lmSLX</span>(<span class="at">formula =</span> f, </span>
<span id="cb100-2"><a href="tuesday-february-21-2023.html#cb100-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> CC.sf, </span>
<span id="cb100-3"><a href="tuesday-february-21-2023.html#cb100-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">listw =</span> wts) )</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = formula(paste(&quot;y ~ &quot;, paste(colnames(x)[-1], collapse = &quot;+&quot;))), 
##     data = as.data.frame(x), weights = weights)
## 
## Coefficients:
## (Intercept)          INC        HOVAL      lag.INC    lag.HOVAL  
##     74.5534      -1.0974      -0.2944      -1.3987       0.2148</code></pre>
<p>With this model, beside the direct marginal effects of income and housing value on crime, you also have the spatially-lagged indirect effects</p>
<p>The total effect of income on crime is the sum of the direct effect and indirect effect. And again, using the <code>spatialreg::impacts()</code> function you see this</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="tuesday-february-21-2023.html#cb102-1" aria-hidden="true" tabindex="-1"></a>model.slxm <span class="sc">|&gt;</span></span>
<span id="cb102-2"><a href="tuesday-february-21-2023.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  spatialreg<span class="sc">::</span><span class="fu">impacts</span>(<span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## Impact measures (SlX, estimable):
##           Direct  Indirect       Total
## INC   -1.0973898 -1.398746 -2.49613551
## HOVAL -0.2943898  0.214841 -0.07954881</code></pre>
<p>You get the impact measures and their standard errors, z-values and <span class="math inline">\(p\)</span>-values with the <code>summary()</code> method applied to the output of the <code>impacts()</code> function</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="tuesday-february-21-2023.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spatialreg<span class="sc">::</span><span class="fu">impacts</span>(model.slxm, <span class="at">listw =</span> wts))</span></code></pre></div>
<pre><code>## Impact measures (SlX, estimable, n-k):
##           Direct  Indirect       Total
## INC   -1.0973898 -1.398746 -2.49613551
## HOVAL -0.2943898  0.214841 -0.07954881
## ========================================================
## Standard errors:
##          Direct  Indirect     Total
## INC   0.3738313 0.5601247 0.4929713
## HOVAL 0.1016586 0.2079212 0.2074767
## ========================================================
## Z-values:
##          Direct  Indirect      Total
## INC   -2.935522 -2.497204 -5.0634496
## HOVAL -2.895867  1.033281 -0.3834108
## 
## p-values:
##       Direct    Indirect Total     
## INC   0.0033299 0.012518 4.1174e-07
## HOVAL 0.0037811 0.301473 0.70142</code></pre>
<p>Results show that income has a significant direct <em>and</em> indirect effect on crime rates, but housing values only show a significant direct effect and not a significant indirect effect</p>
<p>Again you visualize the relative significance of the effects</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="tuesday-february-21-2023.html#cb106-1" aria-hidden="true" tabindex="-1"></a>model.slxm <span class="sc">|&gt;</span></span>
<span id="cb106-2"><a href="tuesday-february-21-2023.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>(<span class="at">conf.int =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-3"><a href="tuesday-february-21-2023.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb106-4"><a href="tuesday-february-21-2023.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate,</span>
<span id="cb106-5"><a href="tuesday-february-21-2023.html#cb106-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> term, </span>
<span id="cb106-6"><a href="tuesday-february-21-2023.html#cb106-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmin =</span> conf.low, </span>
<span id="cb106-7"><a href="tuesday-february-21-2023.html#cb106-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xmax =</span> conf.high, </span>
<span id="cb106-8"><a href="tuesday-february-21-2023.html#cb106-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">height =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb106-9"><a href="tuesday-february-21-2023.html#cb106-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb106-10"><a href="tuesday-february-21-2023.html#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb106-11"><a href="tuesday-february-21-2023.html#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>()</span></code></pre></div>
<pre><code>## Warning: The `tidy()` method for objects of class `SlX` is not maintained by the broom team, and is only supported through the `lm` tidier method. Please be cautious in interpreting and reporting broom output.
## 
## This warning is displayed once per session.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>Compare R squared values between the OLS model and the spatially-lagged X model</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="tuesday-february-21-2023.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.ols)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.552404</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="tuesday-february-21-2023.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model.slxm)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.6105076</code></pre>
<p>The spatially lagged model has an R squared value that is higher than the R squared value from the linear regression</p>
<p>Another way to find the correct spatial model is to consider both the spatial Durbin error model and the spatial Durbin model</p>
<p>The spatial Durban error model (SDEM) is a spatial error model with a spatially-lagged X term added</p>
<p>To fit a SDEM use the <code>spatialreg::errorsarlm()</code> function but include the argument <code>etype = "emixed"</code> to ensure that the spatially lagged X variables are added and the lagged intercept term is dropped when the weights style is row standardized (<code>"W"</code>)</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="tuesday-february-21-2023.html#cb112-1" aria-hidden="true" tabindex="-1"></a>( model.sdem <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">errorsarlm</span>(<span class="at">formula =</span> f, </span>
<span id="cb112-2"><a href="tuesday-february-21-2023.html#cb112-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">data =</span> CC.sf, </span>
<span id="cb112-3"><a href="tuesday-february-21-2023.html#cb112-3" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">listw =</span> wts,</span>
<span id="cb112-4"><a href="tuesday-february-21-2023.html#cb112-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">etype =</span> <span class="st">&quot;emixed&quot;</span>) )</span></code></pre></div>
<pre><code>## 
## Call:
## spatialreg::errorsarlm(formula = f, data = CC.sf, listw = wts, 
##     etype = &quot;emixed&quot;)
## Type: error 
## 
## Coefficients:
##      lambda (Intercept)         INC       HOVAL     lag.INC   lag.HOVAL 
##   0.4035821  73.6450826  -1.0522585  -0.2781741  -1.2048761   0.1312451 
## 
## Log likelihood: -181.779</code></pre>
<p>The spatial Durban model (SDM) is a spatially-lagged Y model with a spatially-lagged X term added to it</p>
<p>To fit a SDM use the <code>lagsarlm()</code> function but include the argument <code>type = "mixed"</code> to ensure that the spatially lagged X variables are added and the lagged intercept term is dropped when the weights style is row standardized (<code>"W"</code>)</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="tuesday-february-21-2023.html#cb114-1" aria-hidden="true" tabindex="-1"></a>( model.sdm <span class="ot">&lt;-</span> spatialreg<span class="sc">::</span><span class="fu">lagsarlm</span>(<span class="at">formula =</span> f, </span>
<span id="cb114-2"><a href="tuesday-february-21-2023.html#cb114-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> CC.sf, </span>
<span id="cb114-3"><a href="tuesday-february-21-2023.html#cb114-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">listw =</span> wts,</span>
<span id="cb114-4"><a href="tuesday-february-21-2023.html#cb114-4" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">type =</span> <span class="st">&quot;mixed&quot;</span>) )</span></code></pre></div>
<pre><code>## 
## Call:
## spatialreg::lagsarlm(formula = f, data = CC.sf, listw = wts, 
##     type = &quot;mixed&quot;)
## Type: mixed 
## 
## Coefficients:
##         rho (Intercept)         INC       HOVAL     lag.INC   lag.HOVAL 
##   0.4034626  44.3200052  -0.9199061  -0.2971294  -0.5839133   0.2576843 
## 
## Log likelihood: -181.6393</code></pre>
<p>How to do you choose between these two models? Is the relationship between crime and income and housing values a global or local effect? Is there any reason to think that if something happens in one tract it will spillover across the entire city? If crime happens in one tract does it influence crime across the entire city? If so, then it is a global relationship. Or should it be a more local effect? If there is more crime in one tract then maybe that influences crime in the neighboring tract but not tracts farther away. If so, then it is a local relationship</p>
<p>If you think it is a local relationship, start with the spatial Durbin error model and look at the <span class="math inline">\(p\)</span>-values on the direct and indirect effects</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="tuesday-february-21-2023.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(spatialreg<span class="sc">::</span><span class="fu">impacts</span>(model.sdem, </span>
<span id="cb116-2"><a href="tuesday-february-21-2023.html#cb116-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">listw =</span> wts, </span>
<span id="cb116-3"><a href="tuesday-february-21-2023.html#cb116-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">R =</span> <span class="dv">500</span>), <span class="at">zstats =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Impact measures (SDEM, estimable, n):
##           Direct   Indirect     Total
## INC   -1.0522585 -1.2048761 -2.257135
## HOVAL -0.2781741  0.1312451 -0.146929
## ========================================================
## Standard errors:
##           Direct  Indirect     Total
## INC   0.32127932 0.5736416 0.6326029
## HOVAL 0.09114185 0.2072449 0.2372854
## ========================================================
## Z-values:
##          Direct  Indirect     Total
## INC   -3.275214 -2.100399 -3.568012
## HOVAL -3.052101  0.633285 -0.619208
## 
## p-values:
##       Direct    Indirect Total    
## INC   0.0010558 0.035694 0.0003597
## HOVAL 0.0022725 0.526548 0.5357794</code></pre>
<p>You see that income has a statistically significant direct and indirect effect on crime. This means that tracts with higher income have lower crime and tracts whose <em>neighboring tracts</em> have higher income also have lower crime</p>
<p>On the other hand, housing values have only a statistically significant direct effect on crime. Tracts with more expensive houses have lower crime but tracts whose neighboring tracts have more expensive houses do not imply lower crime. And the total effect of housing values on crime across the city is not significant. So if housing values go up in tracts citywide, there is no statistical evidence that crime will go down (or up)</p>
<p>Try a likelihood ratio test with the null hypothesis being that you should restrict the model</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="tuesday-february-21-2023.html#cb118-1" aria-hidden="true" tabindex="-1"></a>spatialreg<span class="sc">::</span><span class="fu">LR.Sarlm</span>(model.sdem, </span>
<span id="cb118-2"><a href="tuesday-february-21-2023.html#cb118-2" aria-hidden="true" tabindex="-1"></a>                     model.slxm)</span></code></pre></div>
<pre><code>## 
##  Likelihood ratio for spatial linear models
## 
## data:  
## Likelihood ratio = 4.3832, df = 1, p-value = 0.03629
## sample estimates:
## Log likelihood of model.sdem Log likelihood of model.slxm 
##                    -181.7790                    -183.9706</code></pre>
<p>The relatively small <span class="math inline">\(p\)</span>-value suggests you shouldn’t restrict the spatial Durbin model to just the spatially-lagged X model although the evidence is not overwhelming</p>
<p>More information:</p>
<ul>
<li><a href="https://youtu.be/b3HtV2Mhmvk" class="uri">https://youtu.be/b3HtV2Mhmvk</a> Video explaining the types of spatial regression models and how to implement them in R</li>
<li><a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2420725" class="uri">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=2420725</a> What Regional Scientists Need to Know About Spatial Econometrics</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="thursday-february-16-2023.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="thursday-february-23-2023.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
