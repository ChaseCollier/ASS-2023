<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tuesday September 27, 2022 | GIS5122: Applied Spatial Statistics</title>
  <meta name="description" content="Tuesday September 27, 2022 | GIS5122: Applied Spatial Statistics" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Tuesday September 27, 2022 | GIS5122: Applied Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="jelsner/ASS-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tuesday September 27, 2022 | GIS5122: Applied Spatial Statistics" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="thursday-september-22-2022.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Spatial Statistics</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html"><i class="fa fa-check"></i>Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#gis5122-applied-spatial-statistics"><i class="fa fa-check"></i>GIS5122: Applied Spatial Statistics</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#course-description"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#expected-learning-outcomes"><i class="fa fa-check"></i>Expected learning outcomes</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#materials"><i class="fa fa-check"></i>Materials</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#class-meetings"><i class="fa fa-check"></i>Class meetings</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#grades"><i class="fa fa-check"></i>Grades</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#ethics"><i class="fa fa-check"></i>Ethics</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#outline-of-topics"><i class="fa fa-check"></i>Outline of topics</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#schedule-subject-to-change-with-notice"><i class="fa fa-check"></i>Schedule (subject to change with notice)</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#reference-materials"><i class="fa fa-check"></i>Reference materials</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#reproducible-research"><i class="fa fa-check"></i>Reproducible research</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html"><i class="fa fa-check"></i>Tuesday, August 23, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#install-r-and-rstudio-on-your-computer"><i class="fa fa-check"></i>Install R and RStudio on your computer</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#download-course-materials"><i class="fa fa-check"></i>Download course materials</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#read-the-syllabus"><i class="fa fa-check"></i>Read the syllabus</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#about-rstudio"><i class="fa fa-check"></i>About RStudio</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#lab-assignments"><i class="fa fa-check"></i>Lab assignments</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#getting-started-with-r"><i class="fa fa-check"></i>Getting started with R</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#are-you-completely-new-to-r"><i class="fa fa-check"></i>Are you completely new to R?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html"><i class="fa fa-check"></i>Thursday, August 25, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#expectations"><i class="fa fa-check"></i>Expectations</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#data-science-workflow-with-r-markdown"><i class="fa fa-check"></i>Data science workflow with R markdown</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#an-introduction-to-using-r"><i class="fa fa-check"></i>An introduction to using R</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html"><i class="fa fa-check"></i>Tuesday August 30, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#working-with-data-frames"><i class="fa fa-check"></i>Working with data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html"><i class="fa fa-check"></i>Thursday September 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#making-graphs"><i class="fa fa-check"></i>Making graphs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html"><i class="fa fa-check"></i>Tuesday September 6, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#working-with-spatial-data"><i class="fa fa-check"></i>Working with spatial data</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#geo-computation-on-simple-features"><i class="fa fa-check"></i>Geo-computation on simple features</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html"><i class="fa fa-check"></i>Thursday September 8, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#spatial-data-subsets-and-joins"><i class="fa fa-check"></i>Spatial data subsets and joins</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#interpolation-using-areal-weights"><i class="fa fa-check"></i>Interpolation using areal weights</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html"><i class="fa fa-check"></i>Tuesday September 13, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#s4-spatial-data-objects"><i class="fa fa-check"></i>S4 spatial data objects</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#working-with-raster-data"><i class="fa fa-check"></i>Working with raster data</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html"><i class="fa fa-check"></i>Thursday September 15, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#working-with-space-time-data"><i class="fa fa-check"></i>Working with space-time data</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#mapping-using-functions-from-the-ggplot2-package"><i class="fa fa-check"></i>Mapping using functions from the {ggplot2} package</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#mapping-using-functions-from-the-tmap-package"><i class="fa fa-check"></i>Mapping using functions from the {tmap} package</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#creating-an-interactive-map"><i class="fa fa-check"></i>Creating an interactive map</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#adding-an-inset-map"><i class="fa fa-check"></i>Adding an inset map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html"><i class="fa fa-check"></i>Tuesday September 20, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#defining-spatial-neighborhoods-and-spatial-weights"><i class="fa fa-check"></i>Defining spatial neighborhoods and spatial weights</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#computing-autocorrelation"><i class="fa fa-check"></i>Computing autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#spatial-lag-and-its-relation-to-autocorrelation"><i class="fa fa-check"></i>Spatial lag and its relation to autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html"><i class="fa fa-check"></i>Thursday September 22, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#other-neighbor-definitions"><i class="fa fa-check"></i>Other neighbor definitions</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#assessing-the-statistical-significance-of-autocorrelation"><i class="fa fa-check"></i>Assessing the statistical significance of autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#bivariate-spatial-autocorrelation"><i class="fa fa-check"></i>Bivariate spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#local-indicators-of-spatial-autocorrelation"><i class="fa fa-check"></i>Local indicators of spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-27-2022.html"><a href="tuesday-september-27-2022.html"><i class="fa fa-check"></i>Tuesday September 27, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-27-2022.html"><a href="tuesday-september-27-2022.html#constraining-group-membership-based-on-spatial-autocorrelation"><i class="fa fa-check"></i>Constraining group membership based on spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-27-2022.html"><a href="tuesday-september-27-2022.html#estimating-spatial-autocorrelation-in-model-residuals"><i class="fa fa-check"></i>Estimating spatial autocorrelation in model residuals</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-27-2022.html"><a href="tuesday-september-27-2022.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i>Choosing a spatial regression model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GIS5122: Applied Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tuesday-september-27-2022" class="section level1 unnumbered">
<h1>Tuesday September 27, 2022</h1>
<p><strong>“The most important single aspect of software development is to be clear about what you are trying to build.”</strong> – Bjarne Stroustrup</p>
<p>Today</p>
<ul>
<li>Constraining group membership based on spatial autocorrelation</li>
<li>Estimating spatial autocorrelation in model residuals</li>
<li>Choosing a spatial regression model</li>
</ul>
<div id="constraining-group-membership-based-on-spatial-autocorrelation" class="section level2 unnumbered">
<h2>Constraining group membership based on spatial autocorrelation</h2>
<p>As a spatial data analyst you likely will face the situation in which there are many variables and you need to group them in a way that minimizes inter-group variation but maximizes between-group variation. If you know the number of groups a priori then a common grouping (or clustering) method is called K-means.</p>
<p>If your data is spatial you will want the additional constraint that the resulting groups be geographically linked. In fact there are many situations that require separating geographies into discrete but contiguous regions (regionalization) such as designing communities, planning areas, amenity zones, logistical units, or even for the purpose of setting up experiments with real world geographic constraints.</p>
<p>There are many situations where the optimal grouping using traditional cluster metrics is sub-optimal in practice because of these geographic constraints.</p>
<p>Unconstrained grouping on data with spatial characteristics may result in contiguous regions because of autocorrelation, but if you want to ensure that all groups are spatially-contiguous you need a method specifically designed for the task. The ‘skater’ algorithm available in the {spdep} package is well-implemented and well-documented.</p>
<p>The ‘skater’ algorithm (spatial ’k’luster analysis by tree edge removal) builds a connectivity graph to represent spatial relationships between neighboring areas, where each area is represented by a node and edges represent connections between areas. Edge costs are calculated by evaluating the dissimilarity in attribute space between neighboring areas. The connectivity graph is reduced by pruning edges with higher dissimilarity.</p>
<p>Consider again the crime data at the tract level in the city of Columbus, Ohio. The tract polygons are projected with arbitrary spatial coordinates.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="tuesday-september-27-2022.html#cb1-1" aria-hidden="true" tabindex="-1"></a>( CC.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus&quot;</span>),</span>
<span id="cb1-2"><a href="tuesday-september-27-2022.html#cb1-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">&quot;columbus&quot;</span>) )</span></code></pre></div>
<pre><code>## Reading layer `columbus&#39; from data source 
##   `/Users/jameselsner/Desktop/ClassNotes/ASS-2022/data/columbus&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA</code></pre>
<pre><code>## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA
## First 10 features:
##        AREA PERIMETER COLUMBUS_ COLUMBUS_I POLYID NEIG  HOVAL    INC     CRIME
## 1  0.309441  2.440629         2          5      1    5 80.467 19.531 15.725980
## 2  0.259329  2.236939         3          1      2    1 44.567 21.232 18.801754
## 3  0.192468  2.187547         4          6      3    6 26.350 15.956 30.626781
## 4  0.083841  1.427635         5          2      4    2 33.200  4.477 32.387760
## 5  0.488888  2.997133         6          7      5    7 23.225 11.252 50.731510
## 6  0.283079  2.335634         7          8      6    8 28.750 16.029 26.066658
## 7  0.257084  2.554577         8          4      7    4 75.000  8.438  0.178269
## 8  0.204954  2.139524         9          3      8    3 37.125 11.337 38.425858
## 9  0.500755  3.169707        10         18      9   18 52.600 17.586 30.515917
## 10 0.246689  2.087235        11         10     10   10 96.400 13.598 34.000835
##        OPEN    PLUMB DISCBD     X     Y NSA NSB EW CP THOUS NEIGNO
## 1  2.850747 0.217155   5.03 38.80 44.07   1   1  1  0  1000   1005
## 2  5.296720 0.320581   4.27 35.62 42.38   1   1  0  0  1000   1001
## 3  4.534649 0.374404   3.89 39.82 41.18   1   1  1  0  1000   1006
## 4  0.394427 1.186944   3.70 36.50 40.52   1   1  0  0  1000   1002
## 5  0.405664 0.624596   2.83 40.01 38.00   1   1  1  0  1000   1007
## 6  0.563075 0.254130   3.78 43.75 39.28   1   1  1  0  1000   1008
## 7  0.000000 2.402402   2.74 33.36 38.41   1   1  0  0  1000   1004
## 8  3.483478 2.739726   2.89 36.71 38.71   1   1  0  0  1000   1003
## 9  0.527488 0.890736   3.17 43.44 35.92   1   1  1  0  1000   1018
## 10 1.548348 0.557724   4.33 47.61 36.42   1   1  1  0  1000   1010
##                          geometry
## 1  POLYGON ((8.624129 14.23698...
## 2  POLYGON ((8.25279 14.23694,...
## 3  POLYGON ((8.653305 14.00809...
## 4  POLYGON ((8.459499 13.82035...
## 5  POLYGON ((8.685274 13.63952...
## 6  POLYGON ((9.401384 13.5504,...
## 7  POLYGON ((8.037741 13.60752...
## 8  POLYGON ((8.247527 13.58651...
## 9  POLYGON ((9.333297 13.27242...
## 10 POLYGON ((10.08251 13.03377...</code></pre>
<p>First, create choropleth maps of housing value, income, and crime.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="tuesday-september-27-2022.html#cb4-1" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb4-2"><a href="tuesday-september-27-2022.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;HOVAL&quot;</span>, <span class="st">&quot;INC&quot;</span>, <span class="st">&quot;CRIME&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is assumed.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>The maps show distinct regional patterns. Housing values and income are clustered toward the southeast and crime is clustered in the center. But although housing values are also high in the north you don’t necessarily want to group that tract with those in the southeast because they are geographically distinct.</p>
<p>To group these patterns under the constraint of spatial contiguity you first scale the attribute values and center them using the <code>scale()</code> function. Scaling and centering variables should be done with any clustering approaches.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tuesday-september-27-2022.html#cb6-1" aria-hidden="true" tabindex="-1"></a>( CCs.df <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="tuesday-september-27-2022.html#cb6-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">HOVAL =</span> <span class="fu">scale</span>(HOVAL),</span>
<span id="cb6-3"><a href="tuesday-september-27-2022.html#cb6-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">INC =</span> <span class="fu">scale</span>(INC),</span>
<span id="cb6-4"><a href="tuesday-september-27-2022.html#cb6-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">CRIME =</span> <span class="fu">scale</span>(CRIME)) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="tuesday-september-27-2022.html#cb6-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(HOVAL, INC, CRIME) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="tuesday-september-27-2022.html#cb6-6" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() )</span></code></pre></div>
<pre><code>##          HOVAL         INC       CRIME
## 1   2.27610855  0.90403637 -1.15961852
## 2   0.33200225  1.20228067 -0.97579369
## 3  -0.65450986  0.27721488 -0.26906635
## 4  -0.28355918 -1.73545197 -0.16382075
## 5  -0.82373916 -0.54755948  0.93250061
## 6  -0.52454175  0.29001413 -0.54160387
## 7   1.98005188 -1.04095129 -2.08883352
## 8  -0.07100723 -0.53265603  0.19704853
## 9   0.76701615  0.56301041 -0.27569218
## 10  3.13893423 -0.13622431 -0.06741470
## 11 -1.01462975 -1.21120127  1.62242856
## 12 -1.00379913 -0.75866244  1.28954855
## 13  0.17674452 -0.84615445  0.69251980
## 14  0.24172862 -0.77356589  1.31109176
## 15 -1.10669054 -0.78934601  0.80424271
## 16 -1.06336790 -1.18349839  1.17796908
## 17  0.17945213 -0.80249612  0.10398880
## 18  1.16775124 -0.20863754  0.52794726
## 19 -0.42435801 -0.48338699  1.15903863
## 20  2.31943098  2.92722331 -2.08611253
## 21 -0.99973763 -0.65223429  0.29555480
## 22 -0.43248096 -0.46743153 -0.08509252
## 23  0.50345189  1.18878008 -0.90128119
## 24  0.79950834 -0.02436078  0.18939933
## 25 -1.11210588 -1.03691859  1.56408123
## 26 -0.98213783 -1.10284443  0.34908475
## 27 -0.23482130 -0.62295340  1.05579183
## 28 -0.84404667 -1.14299607  1.30234528
## 29 -0.32146659 -0.99834496  1.53128622
## 30 -0.86300035 -0.08222123  2.01787200
## 31 -0.35937401  0.44974438 -1.04300226
## 32  0.10092968  0.80076407 -0.95524408
## 33 -0.80343164 -0.78145595  0.40875576
## 34 -0.54078771  0.10047751 -0.66667072
## 35 -0.61931016 -0.27368671  0.24182446
## 36 -0.11568382  0.76517130 -1.24451072
## 37  0.26338981  0.46324498  0.43725866
## 38 -0.85216962 -0.57298301  1.11056729
## 39  0.06302227  0.71923344 -0.95791733
## 40  1.27335038  2.71033430 -1.12882028
## 41  0.19840570  1.37323217 -0.96961443
## 42  0.31933030  2.01600877 -1.11384361
## 43 -0.68970950 -0.17444727  0.09172721
## 44 -0.26731322  0.45342623 -0.54784308
## 45 -0.57961574 -0.04206959 -0.36458895
## 46  2.03962048  0.69240723 -1.11153410
## 47  0.22006716  0.80216710 -0.43664372
## 48 -0.63014089 -0.44919672 -0.50702314
## 49 -0.14276051  0.77516538 -0.75228685</code></pre>
<p>Next create adjacency neighbors using queen contiguity.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tuesday-september-27-2022.html#cb8-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(CC.sf, </span>
<span id="cb8-2"><a href="tuesday-september-27-2022.html#cb8-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">queen =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-3"><a href="tuesday-september-27-2022.html#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="tuesday-september-27-2022.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(CC.sf<span class="sc">$</span>geometry)</span>
<span id="cb8-5"><a href="tuesday-september-27-2022.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs, </span>
<span id="cb8-6"><a href="tuesday-september-27-2022.html#cb8-6" aria-hidden="true" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(CC.sf)),</span>
<span id="cb8-7"><a href="tuesday-september-27-2022.html#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Next combine the contiguity graph with your scaled attribute data to calculate edge costs based on the distance between each node. The function <code>spdep::nbcosts()</code> provides distance methods for Euclidean, Manhattan, Canberra, binary, Minkowski, and Mahalanobis, and defaults to Euclidean if not specified.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tuesday-september-27-2022.html#cb9-1" aria-hidden="true" tabindex="-1"></a>costs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nbcosts</span>(nbs, </span>
<span id="cb9-2"><a href="tuesday-september-27-2022.html#cb9-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> CCs.df)</span></code></pre></div>
<p>Next transform the edge costs into spatial weights using the <code>spdep::nb2listw()</code> function before constructing the minimum spanning tree with the weights list.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="tuesday-september-27-2022.html#cb10-1" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs,</span>
<span id="cb10-2"><a href="tuesday-september-27-2022.html#cb10-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">glist =</span> costs,</span>
<span id="cb10-3"><a href="tuesday-september-27-2022.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">&quot;B&quot;</span>)</span>
<span id="cb10-4"><a href="tuesday-september-27-2022.html#cb10-4" aria-hidden="true" tabindex="-1"></a>mst <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">mstree</span>(wts)</span>
<span id="cb10-5"><a href="tuesday-september-27-2022.html#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="tuesday-september-27-2022.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mst)</span></code></pre></div>
<pre><code>##      [,1] [,2]      [,3]
## [1,]   21   34 1.3050242
## [2,]   34   31 0.5445399
## [3,]   31   36 0.4466371
## [4,]   36   39 0.3408547
## [5,]   36   42 1.3307538
## [6,]   21   30 1.8193374</code></pre>
<p>Edges with higher dissimilarity are removed leaving a set of nodes and edges that take the minimum sum of dissimilarities across all edges of the tree (a minimum spanning tree).</p>
<p>The edge connecting node (tract) 33 with node (tract) 35 has a dissimilarity of .56 units. The edge connecting tract 35 with tract 43 has a dissimilarity of .19 units.</p>
<p>Finally, the <code>spdep::skater()</code> function partitions the graph by identifying which edges to remove based on dissimilarity while maximizing the between-group variation. The <code>ncuts =</code> argument specifies the number of partitions to make, resulting in <code>ncuts</code> + 1 groups.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="tuesday-september-27-2022.html#cb12-1" aria-hidden="true" tabindex="-1"></a>clus5 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">skater</span>(<span class="at">edges =</span> mst[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], </span>
<span id="cb12-2"><a href="tuesday-september-27-2022.html#cb12-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> CCs.df, </span>
<span id="cb12-3"><a href="tuesday-september-27-2022.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ncuts =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Where are these groups located?</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="tuesday-september-27-2022.html#cb13-1" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="tuesday-september-27-2022.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Group =</span> clus5<span class="sc">$</span>groups)</span>
<span id="cb13-3"><a href="tuesday-september-27-2022.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="tuesday-september-27-2022.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-5"><a href="tuesday-september-27-2022.html#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-6"><a href="tuesday-september-27-2022.html#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf,</span>
<span id="cb13-7"><a href="tuesday-september-27-2022.html#cb13-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(Group)))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The map shows five distinct regions based on the three variables of income, housing value, and crime. Importantly the regions are contiguous.</p>
<p>As a comparison, here is the result of grouping the same three variables using hierarchical clustering using the method of minimum variance (Ward) and without regard to spatial contiguity.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="tuesday-september-27-2022.html#cb14-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">dist</span>(CCs.df)</span>
<span id="cb14-2"><a href="tuesday-september-27-2022.html#cb14-2" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dd, </span>
<span id="cb14-3"><a href="tuesday-september-27-2022.html#cb14-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">&quot;ward.D&quot;</span>)</span>
<span id="cb14-4"><a href="tuesday-september-27-2022.html#cb14-4" aria-hidden="true" tabindex="-1"></a>hcGroup <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb14-5"><a href="tuesday-september-27-2022.html#cb14-5" aria-hidden="true" tabindex="-1"></a>CC.sf <span class="ot">&lt;-</span> CC.sf <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="tuesday-september-27-2022.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">hcGroup =</span> hcGroup)</span>
<span id="cb14-7"><a href="tuesday-september-27-2022.html#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="tuesday-september-27-2022.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-9"><a href="tuesday-september-27-2022.html#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> CC.sf,</span>
<span id="cb14-10"><a href="tuesday-september-27-2022.html#cb14-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(hcGroup)))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Here the map shows five regions but the regions are not contiguous.</p>
<p>More information: <a href="https://www.tandfonline.com/doi/abs/10.1080/13658810600665111" class="uri">https://www.tandfonline.com/doi/abs/10.1080/13658810600665111</a></p>
</div>
<div id="estimating-spatial-autocorrelation-in-model-residuals" class="section level2 unnumbered">
<h2>Estimating spatial autocorrelation in model residuals</h2>
<p>A spatial regression model should be considered for your data whenever the residuals resulting from a aspatial regression exhibit spatial autocorrelation. A common way to proceed is to first regress the response variable onto the explanatory variables and check for autocorrelation in the residuals.</p>
<p>If there is significant spatial autocorrelation in the residuals then a spatial regression model should be considered.</p>
<p>Let’s stay with the Columbus crime data and fit a linear regression model with <code>CRIME</code> as the response variable and <code>INC</code> and <code>HOVAL</code> as the explanatory variables. At the level of tracts, how well does income and housing value statistically explain the amount of crime?</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tuesday-september-27-2022.html#cb15-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(CRIME <span class="sc">~</span> INC <span class="sc">+</span> HOVAL, </span>
<span id="cb15-2"><a href="tuesday-september-27-2022.html#cb15-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> CC.sf)</span>
<span id="cb15-3"><a href="tuesday-september-27-2022.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -34.418  -6.388  -1.580   9.052  28.649 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  68.6190     4.7355  14.490  &lt; 2e-16 ***
## INC          -1.5973     0.3341  -4.780 1.83e-05 ***
## HOVAL        -0.2739     0.1032  -2.654   0.0109 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.43 on 46 degrees of freedom
## Multiple R-squared:  0.5524, Adjusted R-squared:  0.5329 
## F-statistic: 28.39 on 2 and 46 DF,  p-value: 9.341e-09</code></pre>
<p>The model statistically explains 55% of the variation in crime as can be seen by the multiple R-squared value. Looking at the coefficients (values under the <code>Estimate</code> column), you see that <em>higher</em> incomes are associated with lower values of crime (negative coefficient) and <em>higher</em> housing values are associated with lower crime. For every one unit increase in income, crime values decrease by 1.6 units.</p>
<p>Use the <code>residuals()</code> method to extract the vector of residuals from the model.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tuesday-september-27-2022.html#cb17-1" aria-hidden="true" tabindex="-1"></a>( res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model) )</span></code></pre></div>
<pre><code>##           1           2           3           4           5           6 
##   0.3465419  -3.6947990  -5.2873940 -19.9855151   6.4475490  -9.0734793 
##           7           8           9          10          11          12 
## -34.4177224  -1.9146840   4.3960594  13.5091017  10.9800573   9.5877236 
##          13          14          15          16          17          18 
##   4.7728320  16.1128397   0.6675424   3.5491565  -4.6630963  12.8399569 
##          19          20          21          22          23          24 
##  12.8428644   3.4948724  -6.0537589  -7.8697868  -1.7037730   6.9913819 
##          25          26          27          28          29          30 
##  11.0984343  -9.1741523  10.8026296   7.1086321  14.9005133  28.6487456 
##          31          32          33          34          35          36 
## -15.1722792  -8.1776706  -4.3438864 -12.9749799  -1.5798172 -14.4376850 
##          37          38          39          40          41          42 
##  12.8687861   9.0515532  -9.1569014  12.2449674  -2.7098171   1.3443547 
##          43          44          45          46          47          48 
##  -3.5432909  -6.3880045  -9.4155428  -1.9731210   1.1150296 -15.7632989 
##          49 
##  -6.2476690</code></pre>
<p>There are 49 residuals one for each tract. The residuals are the difference between the observed crime rates and the predicted crime rates (observed - predicted). A residual that has a value greater than 0 indicates that the model <em>under</em> predicts the observed crime rate in that tract and a residual that has a value less than 0 indicates that the model <em>over</em> predicts the observed crime rate.</p>
<p>If you plot the residuals, they should be approximated by a normal distribution. You check this with the <code>sm::sm.density()</code> function with the first argument the vector of residuals (<code>res</code>) and the argument <code>model =</code> set to “Normal”.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="tuesday-september-27-2022.html#cb19-1" aria-hidden="true" tabindex="-1"></a>sm<span class="sc">::</span><span class="fu">sm.density</span>(res, </span>
<span id="cb19-2"><a href="tuesday-september-27-2022.html#cb19-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">model =</span> <span class="st">&quot;Normal&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>The density curve of the residuals (black line) fits completely within the blue ribbon that defines a normal distribution.</p>
<p>Next create a map of the model residuals. Do the residuals show any pattern of clustering? Since the values in the vector of residuals <code>res</code> are arranged in the same order as the rows in the simple feature data frame you create a new column in the data frame using the <code>$</code> syntax and calling the new column <code>res</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="tuesday-september-27-2022.html#cb20-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>res <span class="ot">&lt;-</span> res</span>
<span id="cb20-2"><a href="tuesday-september-27-2022.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="tuesday-september-27-2022.html#cb20-3" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb20-4"><a href="tuesday-september-27-2022.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;res&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-5"><a href="tuesday-september-27-2022.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="tuesday-september-27-2022.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Linear model residuals&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is assumed.</code></pre>
<pre><code>## Variable(s) &quot;res&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>The map shows contiguous tracts with negative residuals across the southwestern and southern part of the city and a group of contiguous tracts with positive residuals toward the center.</p>
<p>The map indicates some clustering but the clustering appears to be less than with the crime values themselves. That is, after accounting for regional factors related to crime, the autocorrelation is reduced.</p>
<p>To determine the amount of autocorrelation in the residuals use the <code>spdep::lm.morantest()</code> function, passing the regression model object and the weights object to it. Note that you once again use the default neighborhood and weighting schemes.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="tuesday-september-27-2022.html#cb23-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(CC.sf)</span>
<span id="cb23-2"><a href="tuesday-september-27-2022.html#cb23-2" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs)</span>
<span id="cb23-3"><a href="tuesday-september-27-2022.html#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="tuesday-september-27-2022.html#cb23-4" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lm.morantest</span>(model, </span>
<span id="cb23-5"><a href="tuesday-september-27-2022.html#cb23-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## 
##  Global Moran I for regression residuals
## 
## data:  
## model: lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## weights: wts
## 
## Moran I statistic standard deviate = 2.8393, p-value = 0.00226
## alternative hypothesis: greater
## sample estimates:
## Observed Moran I      Expectation         Variance 
##      0.222109407     -0.033418335      0.008099305</code></pre>
<p>Moran’s I on the model residuals is .22. This compares with the value of .5 on the value of crime alone. Part of the autocorrelation in the crime rates is statistically ‘absorbed’ by the explanatory factors.</p>
<p>But does this output let you know if you need a spatial regression model?</p>
<p>The <span class="math inline">\(p\)</span>-value on I of .002, thus you reject the null hypothesis of no spatial autocorrelation in the model residuals and conclude that a spatial regression model would improve the fit. The <span class="math inline">\(z\)</span>-value (as the basis for the <span class="math inline">\(p\)</span>-value) takes into account the fact that these are residuals from a model so the variance is adjusted accordingly.</p>
<p>Given significant spatial autocorrelation in the model residuals, the next step is to choose the type of spatial regression model.</p>
</div>
<div id="choosing-a-spatial-regression-model" class="section level2 unnumbered">
<h2>Choosing a spatial regression model</h2>
<p>Ordinary regression models fit to spatial data can lead to improper inference because observations are not independent. Thus it’s necessary to check the residuals from an aspatial model for autocorrelation. If the residuals are strongly correlated the model is not specified properly.</p>
<p>You can try to improve the model by adding variables. If that’s not possible (no additional data, or no clue as to what variable to include), you can try a spatial regression model. Spatial regression models are widely used in econometrics and epidemiology.</p>
<p>The equation for a regression model in vector notation is
<span class="math display">\[
y = X \beta + \varepsilon
\]</span>
where <span class="math inline">\(y\)</span> is a <span class="math inline">\(n\)</span> by 1 vector of response variable values, <span class="math inline">\(X\)</span> is a <span class="math inline">\(n\)</span> by <span class="math inline">\(p+1\)</span> matrix containing the explanatory variables and augmented by a column of ones for the intercept term, <span class="math inline">\(\beta\)</span> is a <span class="math inline">\(p+1\)</span> <span class="math inline">\(\times\)</span> 1 vector of model coefficients and <span class="math inline">\(\varepsilon\)</span> is a <span class="math inline">\(n\)</span> by 1 vector of residuals (iid).</p>
<p>A couple options exist if the elements of the vector <span class="math inline">\(\varepsilon\)</span> are correlated. One is to include a spatial lag term so the model becomes
<span class="math display">\[
y = \rho W y + X \beta + \varepsilon
\]</span>
where <span class="math inline">\(Wy\)</span> is the weighted average of the neighborhood response values (spatial lag variable) with <span class="math inline">\(W\)</span> the spatial weights matrix, and <span class="math inline">\(\rho\)</span> is the autoregression coefficient. This is called a spatial autoregressive (SAR) model.</p>
<p>Note: <span class="math inline">\(Wy\)</span> is the spatial lag variable you compute with the <code>spdep::lag.listw()</code> function and <span class="math inline">\(\rho\)</span> is Moran’s I. Thus the model is also called a spatial lag model (SLM).</p>
<p>Justification for the spatial lag model is domain specific but motivated by a ‘diffusion’ process. The response variable <span class="math inline">\(y_i\)</span> is influenced by the explanatory variables at location <span class="math inline">\(i\)</span> and by explanatory variables at locations <span class="math inline">\(j\)</span>.</p>
<p><span class="math inline">\(\rho Wy\)</span> is called the <em>spatial signal</em> term and <span class="math inline">\(\beta X\)</span> is called the <em>trend</em> term.</p>
<p>Another option is to include a spatial error term so the model becomes
<span class="math display">\[
y = X\beta + \lambda W \epsilon + u
\]</span>
where <span class="math inline">\(\lambda\)</span> is the autoregression coefficient, <span class="math inline">\(W\epsilon\)</span> is the spatial error term representing the weighted average of the neighborhood residuals, and <span class="math inline">\(u\)</span> are the overall residuals assumed to be iid. This is called a spatial error model (SEM).</p>
<p>Here the lag term is computed using the residuals rather the response variable.</p>
<p>Application of the spatial error model is motivated by the omitted variable bias. Suppose the variable <span class="math inline">\(y\)</span> is statistically described by two variables <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> each centered on zero and independent. Then
<span class="math display">\[
y = \beta x + \theta z
\]</span></p>
<p>If <span class="math inline">\(z\)</span> is not observed, then the vector <span class="math inline">\(\theta z\)</span> is nested in the error term <span class="math inline">\(\epsilon\)</span>.
<span class="math display">\[
y = \beta x + \epsilon
\]</span></p>
<p>Examples of an unobserved latent variable <span class="math inline">\(z\)</span> include local culture, social capital, neighborhood readiness. Importantly you would expect the latent variable to be spatially correlated (e.g., culture will be similar across neighborhoods), so let
<span class="math display">\[
z = \lambda W z + r\\
z = (I - \lambda W)^{-1} r
\]</span>
where <span class="math inline">\(r\)</span> is a vector of random independent residuals (e.g., culture is similar but not identical), <span class="math inline">\(W\)</span> is the spatial weights matrix and <span class="math inline">\(\lambda\)</span> is a scalar spatial correlation parameter. Substituting into the equation above
<span class="math display">\[
y = \beta x + \theta z \\
y = \beta x +   \theta (I - \lambda W)^{-1} r\\
y = \beta x + (I - \lambda W)^{-1} \varepsilon
\]</span>
where <span class="math inline">\(\varepsilon = \theta r\)</span>.</p>
<p>Another motivation for considering a spatial error model is heterogeneity. Suppose you have multiple observations for each unit. If you want a model that incorporates individual effects you can include a <span class="math inline">\(n \times 1\)</span> vector <span class="math inline">\(a\)</span> of individual intercepts for each unit.
<span class="math display">\[
y = a + X\beta
\]</span>
where now <span class="math inline">\(X\)</span> is a <span class="math inline">\(n\)</span> <span class="math inline">\(\times\)</span> <span class="math inline">\(p\)</span> matrix.</p>
<p>In a cross-sectional setting with one observation per unit (typically the case in observational studies), this approach is not possible since you will have more parameters than observations.</p>
<p>Instead you can treat <span class="math inline">\(a\)</span> as a vector of spatial random effects. You assume that the intercepts follows a spatially smoothed process
<span class="math display">\[
a = \lambda W a + \epsilon \\
a = (I - \lambda W)^{-1} \epsilon
\]</span>
which leads to the previous model
<span class="math display">\[
y = X\beta + (I - \lambda W)^{-1} \epsilon
\]</span></p>
<p>In the absence of domain-specific knowledge of the process that might be responsible for the autocorrelated residuals, you can run some statistical tests on the linear model.</p>
<p>The tests are performed with the <code>spdep::lm.LMtests()</code> function. The <code>LM</code> stands for ‘Lagrange multiplier’ indicating that the technique simultaneously determines the coefficients on the explanatory variables AND the coefficient on the spatial lag variable.</p>
<p>The test type is specified as a character string. The tests should be considered in a sequence starting with the standard versions and moving to the ‘robust’ versions if the choice remains ambiguous.</p>
<p>To perform LM tests you specify the model object, the weights matrix, and the two model types using the <code>test =</code> argument. The model types are specified as character strings <code>"LMerr"</code> and <code>"LMlag"</code> for the spatial error and lag models, respectively.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="tuesday-september-27-2022.html#cb25-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lm.LMtests</span>(model, </span>
<span id="cb25-2"><a href="tuesday-september-27-2022.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">listw =</span> wts, </span>
<span id="cb25-3"><a href="tuesday-september-27-2022.html#cb25-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;LMerr&quot;</span>, <span class="st">&quot;LMlag&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## weights: wts
## 
## LMerr = 5.2062, df = 1, p-value = 0.02251
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## weights: wts
## 
## LMlag = 8.898, df = 1, p-value = 0.002855</code></pre>
<p>The output shows that both the spatial error and spatial lag models are significant (<span class="math inline">\(p\)</span>-value &lt; .15). Ideally one model is significant and the other is not, and you choose the model that is significant.</p>
<p>Since both are significant, you test again. This time you use the robust forms of the statistics with character strings <code>"RLMerr"</code> and <code>"RLMlag"</code> in the <code>test =</code> argument.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="tuesday-september-27-2022.html#cb27-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lm.LMtests</span>(model, </span>
<span id="cb27-2"><a href="tuesday-september-27-2022.html#cb27-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">listw =</span> wts, </span>
<span id="cb27-3"><a href="tuesday-september-27-2022.html#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">test =</span> <span class="fu">c</span>(<span class="st">&quot;RLMerr&quot;</span>, <span class="st">&quot;RLMlag&quot;</span>))</span></code></pre></div>
<pre><code>## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## weights: wts
## 
## RLMerr = 0.043906, df = 1, p-value = 0.834
## 
## 
##  Lagrange multiplier diagnostics for spatial dependence
## 
## data:  
## model: lm(formula = CRIME ~ INC + HOVAL, data = CC.sf)
## weights: wts
## 
## RLMlag = 3.7357, df = 1, p-value = 0.05326</code></pre>
<p>Here the error model has a large <span class="math inline">\(p\)</span>-value and the lag model has a <span class="math inline">\(p\)</span>-value that is less than .15 so you choose the lag model for your spatial regression.</p>
<p>A decision tree (from Luc Anselin) shows the sequence of tests for making a choice about which type of spatial model to use <a href="http://myweb.fsu.edu/jelsner/temp/SpatialRegressionDecisionTree.png">Decision Tree</a></p>
<p>If both tests show significance models, then you should fit both models and check which one results in the lowest information criteria (AIC).</p>
<p>Another options is to include both a spatial lag term and a spatial error term into a single model.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="thursday-september-22-2022.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
