<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tuesday September 6, 2022 | GIS5122: Applied Spatial Statistics</title>
  <meta name="description" content="Tuesday September 6, 2022 | GIS5122: Applied Spatial Statistics" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Tuesday September 6, 2022 | GIS5122: Applied Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="jelsner/ASS-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tuesday September 6, 2022 | GIS5122: Applied Spatial Statistics" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="thursday-september-1-2022.html"/>

<script src="libs/header-attrs-2.13/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Spatial Statistics</a></li>

<li class="divider"></li>
<li><a href="index.html#section"></a></li>
<li><a href="syllabus.html#syllabus">Syllabus<span></span></a>
<ul>
<li><a href="syllabus.html#gis5122-applied-spatial-statistics">GIS5122: Applied Spatial Statistics<span></span></a></li>
<li><a href="syllabus.html#contact-information">Contact information<span></span></a></li>
<li><a href="syllabus.html#course-description">Course description<span></span></a></li>
<li><a href="syllabus.html#expected-learning-outcomes">Expected learning outcomes<span></span></a></li>
<li><a href="syllabus.html#materials">Materials<span></span></a></li>
<li><a href="syllabus.html#class-meetings">Class meetings<span></span></a></li>
<li><a href="syllabus.html#grades">Grades<span></span></a></li>
<li><a href="syllabus.html#ethics">Ethics<span></span></a></li>
<li><a href="syllabus.html#outline-of-topics">Outline of topics<span></span></a></li>
<li><a href="syllabus.html#schedule-subject-to-change-with-notice">Schedule (subject to change with notice)<span></span></a></li>
<li><a href="syllabus.html#reference-materials">Reference materials<span></span></a></li>
<li><a href="syllabus.html#reproducible-research">Reproducible research<span></span></a></li>
</ul></li>
<li><a href="tuesday-august-23-2022.html#tuesday-august-23-2022">Tuesday, August 23, 2022<span></span></a>
<ul>
<li><a href="tuesday-august-23-2022.html#today">Today<span></span></a></li>
<li><a href="tuesday-august-23-2022.html#syllabus-1">Syllabus<span></span></a></li>
<li><a href="tuesday-august-23-2022.html#getting-setup-for-this-course">Getting setup for this course<span></span></a></li>
<li><a href="tuesday-august-23-2022.html#the-rstudio-ide">The RStudio IDE<span></span></a></li>
<li><a href="tuesday-august-23-2022.html#lab-assignments">Lab assignments<span></span></a></li>
<li><a href="tuesday-august-23-2022.html#getting-started-with-r">Getting started with R<span></span></a></li>
</ul></li>
<li><a href="thursday-august-25-2022.html#thursday-august-25-2022">Thursday, August 25, 2022<span></span></a>
<ul>
<li><a href="thursday-august-25-2022.html#today-1">Today<span></span></a></li>
<li><a href="thursday-august-25-2022.html#review-of-class-expectations">Review of class expectations<span></span></a></li>
<li><a href="thursday-august-25-2022.html#data-science-workflow-with-r-markdown">Data science workflow with R markdown<span></span></a></li>
<li><a href="thursday-august-25-2022.html#an-introduction-to-using-r">An introduction to using R<span></span></a></li>
<li><a href="thursday-august-25-2022.html#data-frames">Data frames<span></span></a></li>
</ul></li>
<li><a href="tuesday-august-30-2022.html#tuesday-august-30-2022">Tuesday August 30, 2022<span></span></a>
<ul>
<li><a href="tuesday-august-30-2022.html#today-2">Today<span></span></a></li>
<li><a href="tuesday-august-30-2022.html#working-with-data-frames">Working with data frames<span></span></a></li>
<li><a href="tuesday-august-30-2022.html#working-with-data-frames-using-functions-from-the-dplyr-package">Working with data frames using functions from the {dplyr} package<span></span></a></li>
</ul></li>
<li><a href="thursday-september-1-2022.html#thursday-september-1-2022">Thursday September 1, 2022<span></span></a>
<ul>
<li><a href="thursday-september-1-2022.html#today-3">Today<span></span></a></li>
<li><a href="thursday-september-1-2022.html#making-graphs">Making graphs<span></span></a></li>
<li><a href="thursday-september-1-2022.html#more-resources-and-additional-examples">More resources and additional examples<span></span></a></li>
</ul></li>
<li><a href="tuesday-september-6-2022.html#tuesday-september-6-2022">Tuesday September 6, 2022<span></span></a>
<ul>
<li><a href="tuesday-september-6-2022.html#today-4">Today<span></span></a></li>
<li><a href="tuesday-september-6-2022.html#working-with-spatial-data">Working with spatial data<span></span></a></li>
<li><a href="tuesday-september-6-2022.html#geo-computation-on-simple-features">Geo-computation on simple features<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GIS5122: Applied Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tuesday-september-6-2022" class="section level1 unnumbered hasAnchor">
<h1>Tuesday September 6, 2022<a href="tuesday-september-6-2022.html#tuesday-september-6-2022" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>“An awful lot of time I spend”coding" is actually spent copying and pasting (And much of the rest is spent googling)."</strong> – Meghan Duffy</p>
<div id="today-4" class="section level2 unnumbered hasAnchor">
<h2>Today<a href="tuesday-september-6-2022.html#today-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Working with spatial data</li>
<li>Geo-computation on simple features</li>
</ul>
</div>
<div id="working-with-spatial-data" class="section level2 unnumbered hasAnchor">
<h2>Working with spatial data<a href="tuesday-september-6-2022.html#working-with-spatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The vector model for data (vector data) represents things in the world using points, lines and polygons. These objects have discrete, well-defined borders and a high level of precision. Of course, precision does not imply accurate.</p>
<p>The raster model for data (raster data) represents continuous fields (like elevation and rainfall) using a grid of cells (raster). A raster aggregates fields to a given resolution, meaning that they are consistent over space and scale-able. The smallest features within the field are blurred or lost.</p>
<p>The choice of which data model to use depends on the application: Vector data tends to dominate the social sciences because human settlements and boundaries have discrete borders. Raster data (e.g., remotely sensed imagery) tends to dominate the environmental sciences because environmental conditions are typically continuous. Geographers, ecologists, demographers use vector and raster data.</p>
<p>Here we use functions from the {sf} package to work with vector data and functions in the {terra} and {raster} packages to work with raster data sets. We will also look at functions from the new {stars} package that work with both vector and raster data models.</p>
<p>R’s spatial ecosystem continues to evolve. Most changes build on what has already been done. Occasionally there is a significant change that builds from scratch. The introduction of the {sf} package in about 2018 (Edzer Pebesma) is a significant change.</p>
<p>Simple features</p>
<p>Simple features is a standard from the Open (‘open source’) Geospatial Consortium (OGC) to represent geographic information. It condenses geographic forms into a single geometry class.</p>
<p>The standard is used in spatial databases (e.g., PostGIS), commercial GIS (e.g., ESRI) and forms the vector data basis for libraries such as <a href="http://www.gdal.org/">GDAL</a>. A subset of simple features forms the <a href="http://geojson.org/">GeoJSON</a> standard. The {sf} package supports these classes and includes plotting and other methods.</p>
<p>Functions in the {sf} package work with all common vector geometry types: points, lines, polygons and their respective ‘multi’ versions (which group together features of the same type into a single feature). These functions also support geometry collections, which contain multiple geometry types in a single object. The <code>raster</code> data classes are not supported.</p>
<p>The {sf} package incorporates the three main packages of the spatial R ecosystem: {sp} for the class system, {rgdal} for reading and writing data, and {rgeos} for spatial operations done with GEOS.</p>
<p>Simple features are data frames with a special column for storing the spatial information. The spatial column is called <code>geometry</code> (or <code>geom</code>). The geometry column is referenced like a regular column.</p>
<p>The difference is that the geometry column is a ‘list column’ of class <code>sfc</code> (simple feature column). And the <code>sfc</code> is a set of objects of class <code>sfg</code> (simple feature geometries).</p>
<div class="figure">
<img src="figures/sf_anatomy.png" alt="" />
<p class="caption">Simple Feature Anatomy</p>
</div>
<ul>
<li>green box is a simple feature: a single record, or <code>data.frame</code> row, consisting of attributes and geometry</li>
<li>blue box is a single simple feature geometry (an object of class <code>sfg</code>)</li>
<li>red box a simple feature list-column (an object of class <code>sfc</code>, which is a column in the <code>data.frame</code>)</li>
<li>the geometries are given in well-known text (WKT) format</li>
</ul>
<p>Geometries are the building blocks of simple features. Well-known text (WKT) is the way simple feature geometries are coded. Well-known binaries (WKB) are hexadecimal strings readable by computers. GIS and spatial databases use WKB to transfer and store geometry objects. WKT is a human-readable text description of simple features. The two formats are exchangeable.</p>
<p>See: <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry" class="uri">https://en.wikipedia.org/wiki/Well-known_text_representation_of_geometry</a></p>
<p>In WKT format a point is a coordinate in 2D, 3D or 4D space (see <code>vignette("sf1")</code> for more information) such as:</p>
<ul>
<li><code>POINT (5 2)</code></li>
</ul>
<p>The first number is the x coordinate and the second number is the y coordinate.</p>
<p>A line string is a sequence of points with a straight line connecting the points, for example:</p>
<ul>
<li><code>LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</code></li>
</ul>
<p>Each pair of x and y coordinates is separated by a comma.</p>
<p>A polygon is a sequence of points that form a closed, non-intersecting ring. Closed means that the first and the last point of a polygon have the same coordinates. A polygon has one exterior boundary (outer ring) but it can have interior boundaries (inner rings). An inner ring is called a ‘hole.’</p>
<ul>
<li>Polygon without a hole - <code>POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5))</code></li>
</ul>
<p>Here there are two parentheses to start and two to end the string of coordinates.</p>
<ul>
<li>Polygon with one hole - <code>POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4))</code></li>
</ul>
<p>Here the first set of coordinates defines the outer edge of the polygon and the next set of coordinates defines the hole. The outer edge vertexes are connected in a counterclockwise direction. The inner edge vertexes (defining the hole in the polygon) are connected in a clockwise direction.</p>
<p>Simple features allow multiple geometries (hence the term ‘geometry collection’) using ‘multi’ version of each geometry type:</p>
<ul>
<li>Multi-point - <code>MULTIPOINT (5 2, 1 3, 3 4, 3 2)</code></li>
<li>Multi-string - <code>MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))</code></li>
<li>Multi-polygon - <code>MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5), (0 2, 1 2, 1 3, 0 3, 0 2)))</code></li>
</ul>
<p>The difference (syntax wise) between a polygon with a hole and a multi-polygon is that the vertexes of each polygon are connected in a counterclockwise direction.</p>
<p>A collection of these is made:</p>
<ul>
<li>Geometry collection - <code>GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2), LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)))</code></li>
</ul>
<p>Simple feature geometry (<code>sfg</code>)</p>
<p>The <code>sfg</code> class represents the simple feature geometry types: point, line string, polygon (and their ‘multi’ equivalents, such as multi points) or geometry collection.</p>
<p>Usually you don’t need to create geometries. Geometries are typically part of the spatial data we import. However, there are a set of functions to create simple feature geometry objects (<code>sfg</code>) from scratch, if needed. The names of these functions are simple and consistent, as they all start with the <code>st_</code> prefix and end with the name of the geometry type in lowercase letters:</p>
<ul>
<li>A point - <code>st_point()</code></li>
<li>A linestring - <code>st_linestring()</code></li>
<li>A polygon - <code>st_polygon()</code></li>
<li>A multipoint - <code>st_multipoint()</code></li>
<li>A multilinestring - <code>st_multilinestring()</code></li>
<li>A multipolygon - <code>st_multipolygon()</code></li>
<li>A geometry collection - <code>st_geometrycollection()</code></li>
</ul>
<p>An <code>sfg</code> object can be created from three data types:</p>
<ul>
<li>A numeric vector - a single point</li>
<li>A matrix - a set of points, where each row contains a point - a multi-point or line string</li>
<li>A list - any other set, e.g. a multi-line string or geometry collection</li>
</ul>
<p>To create point objects, you use the <code>st_point()</code> function from the {sf} package applied to a numeric vector.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="tuesday-september-6-2022.html#cb320-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>)) <span class="co"># XY point</span></span></code></pre></div>
<pre><code>## POINT (5 2)</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="tuesday-september-6-2022.html#cb322-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># XYZ point</span></span></code></pre></div>
<pre><code>## POINT Z (5 2 3)</code></pre>
<p>To create multi-point objects, you use matrices constructed from the <code>rbind()</code> function.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="tuesday-september-6-2022.html#cb324-1" aria-hidden="true" tabindex="-1"></a>mp.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb324-2"><a href="tuesday-september-6-2022.html#cb324-2" aria-hidden="true" tabindex="-1"></a>mp.matrix</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    5    2
## [2,]    1    3
## [3,]    3    4
## [4,]    3    2</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="tuesday-september-6-2022.html#cb326-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_multipoint</span>(mp.matrix)</span></code></pre></div>
<pre><code>## MULTIPOINT ((5 2), (1 3), (3 4), (3 2))</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="tuesday-september-6-2022.html#cb328-1" aria-hidden="true" tabindex="-1"></a>ls.matrix <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb328-2"><a href="tuesday-september-6-2022.html#cb328-2" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_linestring</span>(ls.matrix)</span></code></pre></div>
<pre><code>## LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="tuesday-september-6-2022.html#cb330-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_linestring</span>(ls.matrix)</span></code></pre></div>
<pre><code>## LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="tuesday-september-6-2022.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_multipoint</span>(mp.matrix))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="tuesday-september-6-2022.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_linestring</span>(ls.matrix))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-143-2.png" width="672" /></p>
<p>To create a polygon, you use lists.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="tuesday-september-6-2022.html#cb334-1" aria-hidden="true" tabindex="-1"></a>poly.list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</span>
<span id="cb334-2"><a href="tuesday-september-6-2022.html#cb334-2" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.list)</span></code></pre></div>
<pre><code>## POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5))</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="tuesday-september-6-2022.html#cb336-1" aria-hidden="true" tabindex="-1"></a>poly.border <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb336-2"><a href="tuesday-september-6-2022.html#cb336-2" aria-hidden="true" tabindex="-1"></a>poly.hole <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb336-3"><a href="tuesday-september-6-2022.html#cb336-3" aria-hidden="true" tabindex="-1"></a>poly.with.hole.list <span class="ot">&lt;-</span> <span class="fu">list</span>(poly.border, poly.hole)</span>
<span id="cb336-4"><a href="tuesday-september-6-2022.html#cb336-4" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.with.hole.list)</span></code></pre></div>
<pre><code>## POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4))</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="tuesday-september-6-2022.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.list))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-144-1.png" width="672" /></p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="tuesday-september-6-2022.html#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.with.hole.list))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-144-2.png" width="672" /></p>
<p>Simple feature geometry column</p>
<p>One <code>sfg</code> object contains a single simple feature geometry. A simple feature geometry column (<code>sfc</code>) is a list of <code>sfg</code> objects together with information about the coordinate reference system.</p>
<p>For example, to combine two simple features into one object with two features, you use the <code>st_sfc()</code> function. This is important since <code>sfg</code> represents the geometry column in <code>sf</code> data frames.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="tuesday-september-6-2022.html#cb340-1" aria-hidden="true" tabindex="-1"></a>point1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">2</span>))</span>
<span id="cb340-2"><a href="tuesday-september-6-2022.html#cb340-2" aria-hidden="true" tabindex="-1"></a>point2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb340-3"><a href="tuesday-september-6-2022.html#cb340-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_sfc</span>(point1, point2)</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 1 ymin: 2 xmax: 5 ymax: 3
## CRS:           NA</code></pre>
<pre><code>## POINT (5 2)</code></pre>
<pre><code>## POINT (1 3)</code></pre>
<p>In most cases, a <code>sfc</code> object contains objects of the same geometry type. Thus, when you convert <code>sfg</code> objects of type <code>polygon</code> into a simple feature geometry column, you end up with an <code>sfc</code> object of type <code>polygon</code>. A geometry column of multiple line strings would result in an <code>sfc</code> object of type <code>multilinestring</code>.</p>
<p>An example with polygons.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="tuesday-september-6-2022.html#cb344-1" aria-hidden="true" tabindex="-1"></a>poly.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)))</span>
<span id="cb344-2"><a href="tuesday-september-6-2022.html#cb344-2" aria-hidden="true" tabindex="-1"></a>polygon1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.list1)</span>
<span id="cb344-3"><a href="tuesday-september-6-2022.html#cb344-3" aria-hidden="true" tabindex="-1"></a>poly.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)))</span>
<span id="cb344-4"><a href="tuesday-september-6-2022.html#cb344-4" aria-hidden="true" tabindex="-1"></a>polygon2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_polygon</span>(poly.list2)</span>
<span id="cb344-5"><a href="tuesday-september-6-2022.html#cb344-5" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_sfc</span>(polygon1, polygon2)</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 0 ymin: 1 xmax: 4 ymax: 5
## CRS:           NA</code></pre>
<pre><code>## POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5))</code></pre>
<pre><code>## POLYGON ((0 2, 1 2, 1 3, 0 3, 0 2))</code></pre>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="tuesday-september-6-2022.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_sfc</span>(polygon1, polygon2))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<p>An example with line strings.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="tuesday-september-6-2022.html#cb349-1" aria-hidden="true" tabindex="-1"></a>mls.list1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>)), </span>
<span id="cb349-2"><a href="tuesday-september-6-2022.html#cb349-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>)))</span>
<span id="cb349-3"><a href="tuesday-september-6-2022.html#cb349-3" aria-hidden="true" tabindex="-1"></a>mls1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_multilinestring</span>((mls.list1))</span>
<span id="cb349-4"><a href="tuesday-september-6-2022.html#cb349-4" aria-hidden="true" tabindex="-1"></a>mls.list2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">7</span>)), </span>
<span id="cb349-5"><a href="tuesday-september-6-2022.html#cb349-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>), <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">8</span>)))</span>
<span id="cb349-6"><a href="tuesday-september-6-2022.html#cb349-6" aria-hidden="true" tabindex="-1"></a>mls2 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_multilinestring</span>((mls.list2))</span>
<span id="cb349-7"><a href="tuesday-september-6-2022.html#cb349-7" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_sfc</span>(mls1, mls2)</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: 1 ymin: 1 xmax: 7 ymax: 9
## CRS:           NA</code></pre>
<pre><code>## MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 ...</code></pre>
<pre><code>## MULTILINESTRING ((2 9, 7 9, 5 6, 4 7, 2 7), (1 ...</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="tuesday-september-6-2022.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_sfc</span>(mls1, mls2))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p>An example with a geometry collection.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="tuesday-september-6-2022.html#cb354-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_sfc</span>(point1, mls1)</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: GEOMETRY
## Dimension:     XY
## Bounding box:  xmin: 1 ymin: 1 xmax: 5 ymax: 5
## CRS:           NA</code></pre>
<pre><code>## POINT (5 2)</code></pre>
<pre><code>## MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 ...</code></pre>
<p>A <code>sfc</code> object also stores information on the coordinate reference systems (CRS). To specify a certain CRS, you use the <code>epsg</code> or <code>proj4string</code> attributes. The default value of <code>epsg</code> and <code>proj4string</code> is <code>NA</code> (Not Available).</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="tuesday-september-6-2022.html#cb358-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_sfc</span>(point1, point2)</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 1 ymin: 2 xmax: 5 ymax: 3
## CRS:           NA</code></pre>
<pre><code>## POINT (5 2)</code></pre>
<pre><code>## POINT (1 3)</code></pre>
<p>All geometries in an <code>sfc</code> object must have the same CRS. We add coordinate reference system as a <code>crs =</code> argument in <code>st_sfc()</code>. The argument accepts an integer with the epsg code (for example, 4326).</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="tuesday-september-6-2022.html#cb362-1" aria-hidden="true" tabindex="-1"></a>( sfc1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(point1, point2, </span>
<span id="cb362-2"><a href="tuesday-september-6-2022.html#cb362-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">crs =</span> <span class="dv">4326</span>) )</span></code></pre></div>
<pre><code>## Geometry set for 2 features 
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 1 ymin: 2 xmax: 5 ymax: 3
## Geodetic CRS:  WGS 84</code></pre>
<pre><code>## POINT (5 2)</code></pre>
<pre><code>## POINT (1 3)</code></pre>
<p>The epsg code is translated to a well-known text (WKT) representation of the CRS.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="tuesday-september-6-2022.html#cb366-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(sfc1)</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: EPSG:4326 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     ENSEMBLE[&quot;World Geodetic System 1984 ensemble&quot;,
##         MEMBER[&quot;World Geodetic System 1984 (Transit)&quot;],
##         MEMBER[&quot;World Geodetic System 1984 (G730)&quot;],
##         MEMBER[&quot;World Geodetic System 1984 (G873)&quot;],
##         MEMBER[&quot;World Geodetic System 1984 (G1150)&quot;],
##         MEMBER[&quot;World Geodetic System 1984 (G1674)&quot;],
##         MEMBER[&quot;World Geodetic System 1984 (G1762)&quot;],
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]],
##         ENSEMBLEACCURACY[2.0]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;geodetic latitude (Lat)&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;geodetic longitude (Lon)&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     USAGE[
##         SCOPE[&quot;Horizontal component of 3D system.&quot;],
##         AREA[&quot;World.&quot;],
##         BBOX[-90,-180,90,180]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<p>Here the WKT describes a two-dimensional geographic coordinate reference system (GEOCRS) with a latitude axis first, then a longitude axis. The coordinate system is related to Earth by the WGS84 geodetic datum.</p>
<p>See: <a href="https://en.wikipedia.org/wiki/Well-known_text_representation_of_coordinate_reference_systems" class="uri">https://en.wikipedia.org/wiki/Well-known_text_representation_of_coordinate_reference_systems</a></p>
<p>Simple feature data frames</p>
<p>Features (geometries) typically come with attributes. The attributes might represent the name of the geometry, measured values, groups to which the geometry belongs, etc.</p>
<p>The simple feature class, <code>sf</code>, is a combination of an attribute table (<code>data.frame</code>) and a simple feature geometry column (<code>sfc</code>). Simple features are created using the <code>st_sf()</code> function.</p>
<p>Objects of class <code>sf</code> behave like regular data frames.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="tuesday-september-6-2022.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] [             [[&lt;-          $&lt;-           aggregate     as.data.frame
##  [6] cbind         coerce        filter        identify      initialize   
## [11] merge         plot          print         rbind         show         
## [16] slotsFromS3   transform    
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>Simple features have two classes, <code>sf</code> and <code>data.frame</code>. This is central to the concept of simple features: most of the time a <code>sf</code> can be treated as, and behaves like, a <code>data.frame</code>. Simple features are, in essence, data frames but with a column containing the geometric information.</p>
<p>I refer to simple feature objects redundantly as ‘simple feature data frames’ to distinguish them from S4 class spatial data frames.</p>
<p>Many of these functions were developed for data frames including <code>rbind()</code> (for binding rows of data together) and <code>$</code> (for creating new columns). The key feature of <code>sf</code> objects is that they store spatial and non-spatial data in the same way, as columns in a <code>data.frame</code>.</p>
<p>The geometry column of {sf} objects is typically called <code>geometry</code> but any name can be used.</p>
<p>Thus <code>sf</code> objects take advantage of R’s data analysis capabilities to be used on geographic data. It’s worth reviewing how to discover basic properties of vector data objects.</p>
<p>For example, we get information about the size and breadth of the <code>world</code> simple feature data frame from the {spData} package using <code>dim()</code>, <code>nrow()</code>, etc.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="tuesday-september-6-2022.html#cb370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spData)</span></code></pre></div>
<pre><code>## To access larger datasets in this package, install the spDataLarge
## package with: `install.packages(&#39;spDataLarge&#39;,
## repos=&#39;https://nowosad.github.io/drat/&#39;, type=&#39;source&#39;)`</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="tuesday-september-6-2022.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(world)</span></code></pre></div>
<pre><code>## [1] 177  11</code></pre>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="tuesday-september-6-2022.html#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(world)</span></code></pre></div>
<pre><code>## [1] 177</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="tuesday-september-6-2022.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(world)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>The data contains ten non-geographic columns (and one geometry column) with 177 rows each one representing a country.</p>
<p>Extracting the attribute data from an <code>sf</code> object is the same as dropping its geometry.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="tuesday-september-6-2022.html#cb378-1" aria-hidden="true" tabindex="-1"></a>world.df <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span></span>
<span id="cb378-2"><a href="tuesday-september-6-2022.html#cb378-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb378-3"><a href="tuesday-september-6-2022.html#cb378-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(world.df)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Example: Temperatures at FSU and at the airport</p>
<p>Suppose you measure a temperature of 25C at FSU and 22C at the airport at 9a on September 6, 2022. Thus, you have specific points in space (the coordinates), the name of the locations (FSU, Airport), temperature values and the date of the measurement. Other attributes might include a urbanity category (campus or city), or a remark if the measurement was made with an automatic station.</p>
<p>Start by creating to <code>sfg</code> (simple feature geometry) point objects.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="tuesday-september-6-2022.html#cb380-1" aria-hidden="true" tabindex="-1"></a>FSU.point <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">84.29849</span>, <span class="fl">30.44188</span>))</span>
<span id="cb380-2"><a href="tuesday-september-6-2022.html#cb380-2" aria-hidden="true" tabindex="-1"></a>TLH.point <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">84.34505</span>, <span class="fl">30.39541</span>))</span></code></pre></div>
<p>Then combine the point objects into a <code>sfc</code> (simple feature column) object.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="tuesday-september-6-2022.html#cb381-1" aria-hidden="true" tabindex="-1"></a>our.geometry <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(FSU.point, TLH.point, </span>
<span id="cb381-2"><a href="tuesday-september-6-2022.html#cb381-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">crs =</span> <span class="dv">4326</span>)</span></code></pre></div>
<p>Then create a data frame of attributes.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="tuesday-september-6-2022.html#cb382-1" aria-hidden="true" tabindex="-1"></a>our.attributes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;FSU&quot;</span>, <span class="st">&quot;Airport&quot;</span>),</span>
<span id="cb382-2"><a href="tuesday-september-6-2022.html#cb382-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">temperature =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb382-3"><a href="tuesday-september-6-2022.html#cb382-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">date =</span> <span class="fu">c</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2021-01-27&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2021-01-27&quot;</span>)),</span>
<span id="cb382-4"><a href="tuesday-september-6-2022.html#cb382-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">category =</span> <span class="fu">c</span>(<span class="st">&quot;campus&quot;</span>, <span class="st">&quot;airport&quot;</span>),</span>
<span id="cb382-5"><a href="tuesday-september-6-2022.html#cb382-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">automatic =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>))</span></code></pre></div>
<p>Finally create a simple feature data frame.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="tuesday-september-6-2022.html#cb383-1" aria-hidden="true" tabindex="-1"></a>sfdf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_sf</span>(our.attributes, </span>
<span id="cb383-2"><a href="tuesday-september-6-2022.html#cb383-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">geometry =</span> our.geometry)</span></code></pre></div>
<p>The example illustrates the components of <code>sf</code> objects. First, you use coordinates to define the geometry of the simple feature geometry (<code>sfg</code>). Second, you can combine the geometries into a simple feature geometry column (<code>sfc</code>) which also stores the CRS. Third, you store the attribute information on the geometries in a <code>data.frame</code>. Fourth, you use the <code>st_sf()</code> function to combine the attribute table and the <code>sfc</code> object into a <code>sf</code> object.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="tuesday-september-6-2022.html#cb384-1" aria-hidden="true" tabindex="-1"></a>sfdf</span></code></pre></div>
<pre><code>## Simple feature collection with 2 features and 5 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -84.34505 ymin: 30.39541 xmax: -84.29849 ymax: 30.44188
## Geodetic CRS:  WGS 84
##      name temperature       date category automatic                   geometry
## 1     FSU          10 2021-01-27   campus      TRUE POINT (-84.29849 30.44188)
## 2 Airport           5 2021-01-27  airport     FALSE POINT (-84.34505 30.39541)</code></pre>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="tuesday-september-6-2022.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sfdf)</span></code></pre></div>
<pre><code>## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>Given a simple feature data frame you create a non-spatial data frame with a geometry list-column but that is not of class <code>sf</code> using the <code>as.data.frame()</code> function.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="tuesday-september-6-2022.html#cb388-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sfdf)</span>
<span id="cb388-2"><a href="tuesday-september-6-2022.html#cb388-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(df)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>In this case the <code>geometry</code> column is</p>
<ul>
<li>no longer a <code>sfc</code>.</li>
<li>no longer has a plot method, and</li>
<li>lacks all dedicated methods listed above for class <code>sf</code></li>
</ul>
<p>In order to avoid any confusion it might be better to use the <code>st_drop_geometry()</code> column instead.</p>
<p>Example: US states</p>
<p>The object <code>us_states</code> from the {spData} package is a simple feature data frame from the U.S. Census Bureau. The variables include the name, region, area, and population.</p>
<p>Simple feature data frames can be treated as regular data frames. But the geometry is “sticky.” For example when we create a new data frame containing only the population information the geometry column is included in the new data frame.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="tuesday-september-6-2022.html#cb390-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb390-2"><a href="tuesday-september-6-2022.html#cb390-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;total&quot;</span>)) </span>
<span id="cb390-3"><a href="tuesday-september-6-2022.html#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df1)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -114.8136 ymin: 24.55868 xmax: -71.78699 ymax: 42.04964
## Geodetic CRS:  NAD83
##   total_pop_10 total_pop_15                       geometry
## 1      4712651      4830620 MULTIPOLYGON (((-88.20006 3...
## 2      6246816      6641928 MULTIPOLYGON (((-114.7196 3...
## 3      4887061      5278906 MULTIPOLYGON (((-109.0501 4...
## 4      3545837      3593222 MULTIPOLYGON (((-73.48731 4...
## 5     18511620     19645772 MULTIPOLYGON (((-81.81169 2...
## 6      9468815     10006693 MULTIPOLYGON (((-85.60516 3...</code></pre>
<p>The resulting data frame has the two population columns but also a column labeled <code>geometry</code>.</p>
<p>When we use the <code>summarize()</code> function, a union of the geometries across rows is made.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="tuesday-september-6-2022.html#cb392-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> us_states <span class="sc">|&gt;</span> </span>
<span id="cb392-2"><a href="tuesday-september-6-2022.html#cb392-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REGION <span class="sc">==</span> <span class="st">&quot;Midwest&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb392-3"><a href="tuesday-september-6-2022.html#cb392-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">TotalPop2010 =</span> <span class="fu">sum</span>(total_pop_10),</span>
<span id="cb392-4"><a href="tuesday-september-6-2022.html#cb392-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">TotalPop2015 =</span> <span class="fu">sum</span>(total_pop_15))</span>
<span id="cb392-5"><a href="tuesday-september-6-2022.html#cb392-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df2)</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 2 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -104.0577 ymin: 35.99568 xmax: -80.51869 ymax: 49.38436
## Geodetic CRS:  NAD83
##   TotalPop2010 TotalPop2015                       geometry
## 1     66514091     67546398 MULTIPOLYGON (((-85.48703 4...</code></pre>
<p>Why use the {sf} package when {sp} is already tried and tested?</p>
<ul>
<li>Fast reading and writing of data</li>
<li>Enhanced plotting performance</li>
<li><code>sf</code> objects are treated as data frames in most operations</li>
<li><code>sf</code> functions are combined using <code>|&gt;</code> operator and they work well with the {tidyverse} packages</li>
<li><code>sf</code> function names are consistent and intuitive (all begin with <code>st_</code>)</li>
</ul>
<p>These advantages led to the development of spatial packages (including {tmap}, {mapview} and {tidycensus}) that now support simple feature objects.</p>
<p>It is easy to convert between the two classes. Consider the <code>world</code> S3 spatial data frame from the {spData} package. You convert it to a S4 spatial data frame with the <code>as()</code> method.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="tuesday-september-6-2022.html#cb394-1" aria-hidden="true" tabindex="-1"></a>world.sp <span class="ot">&lt;-</span> world <span class="sc">|&gt;</span></span>
<span id="cb394-2"><a href="tuesday-september-6-2022.html#cb394-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="at">Class =</span> <span class="st">&quot;Spatial&quot;</span>)</span></code></pre></div>
<p>The method coerces simple features to <code>Spatial*</code> and <code>Spatial*DataFrame</code> objects.</p>
<p>You convert a S4 spatial data frame into a simple feature data frame with the <code>st_as_sf()</code> function.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="tuesday-september-6-2022.html#cb395-1" aria-hidden="true" tabindex="-1"></a>world.sf <span class="ot">&lt;-</span> world.sp <span class="sc">|&gt;</span></span>
<span id="cb395-2"><a href="tuesday-september-6-2022.html#cb395-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span></code></pre></div>
<p>You can create basic maps from simple feature data frames with the base <code>plot()</code> method (<code>plot.sf()</code>). The function creates a multi-panel one sub-plot for each variable.</p>
</div>
<div id="geo-computation-on-simple-features" class="section level2 unnumbered hasAnchor">
<h2>Geo-computation on simple features<a href="tuesday-september-6-2022.html#geo-computation-on-simple-features" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Geo-computation on simple features is done with routines in the geometry engine-open source (GEOS) library that functions in the {sf} package make use of.</p>
<p>As an example, consider the file <code>police.zip</code> on my website contains shapefiles in a folder called <code>police</code>. The variables include police expenditures (POLICE), crime (CRIME), income (INC), unemployment (UNEMP) and other socio-economic variables for counties in Mississippi.</p>
<p>it with the <code>st_read()</code> function from the {sf} package and then assign a geographic coordinate reference system (CRS) to it using the EPSG number 4326.</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="tuesday-september-6-2022.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/police.zip&quot;</span>,</span>
<span id="cb396-2"><a href="tuesday-september-6-2022.html#cb396-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police.zip&quot;</span>))</span>
<span id="cb396-3"><a href="tuesday-september-6-2022.html#cb396-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police.zip&quot;</span>),</span>
<span id="cb396-4"><a href="tuesday-september-6-2022.html#cb396-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb396-5"><a href="tuesday-september-6-2022.html#cb396-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb396-6"><a href="tuesday-september-6-2022.html#cb396-6" aria-hidden="true" tabindex="-1"></a>sfdf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police&quot;</span>), </span>
<span id="cb396-7"><a href="tuesday-september-6-2022.html#cb396-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">layer =</span> <span class="st">&quot;police&quot;</span>) </span></code></pre></div>
<pre><code>## Reading layer `police&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/ASS-2022/data/police&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 82 features and 21 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -91.64356 ymin: 30.19474 xmax: -88.09043 ymax: 35.00496
## CRS:           NA</code></pre>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="tuesday-september-6-2022.html#cb398-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_crs</span>(sfdf) <span class="ot">&lt;-</span> <span class="dv">4326</span></span></code></pre></div>
<p>The geometry type is polygon and there are 82 polygons, one for each county.</p>
<p>You transform the geographic coordinate system to a specific projected CRS as suggested by the function <code>suggest_crs()</code> from the {crsuggest} package.</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="tuesday-september-6-2022.html#cb399-1" aria-hidden="true" tabindex="-1"></a>crsuggest<span class="sc">::</span><span class="fu">suggest_crs</span>(sfdf)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 6
##    crs_code crs_name                        crs_type crs_gcs crs_units crs_proj4
##    &lt;chr&gt;    &lt;chr&gt;                           &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;    
##  1 6508     NAD83(2011) / Mississippi TM    project…    6318 m         +proj=tm…
##  2 3816     NAD83(NSRS2007) / Mississippi … project…    4759 m         +proj=tm…
##  3 3815     NAD83(HARN) / Mississippi TM    project…    4152 m         +proj=tm…
##  4 3814     NAD83 / Mississippi TM          project…    4269 m         +proj=tm…
##  5 6510     NAD83(2011) / Mississippi West… project…    6318 us-ft     +proj=tm…
##  6 6509     NAD83(2011) / Mississippi West  project…    6318 m         +proj=tm…
##  7 3600     NAD83(NSRS2007) / Mississippi … project…    4759 us-ft     +proj=tm…
##  8 3599     NAD83(NSRS2007) / Mississippi … project…    4759 m         +proj=tm…
##  9 2900     NAD83(HARN) / Mississippi West… project…    4152 us-ft     +proj=tm…
## 10 2814     NAD83(HARN) / Mississippi West  project…    4152 m         +proj=tm…</code></pre>
<p>The function for transforming the CRS is <code>st_transform()</code> from the {sf} package.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="tuesday-september-6-2022.html#cb401-1" aria-hidden="true" tabindex="-1"></a>sfdf <span class="ot">&lt;-</span> sfdf <span class="sc">|&gt;</span></span>
<span id="cb401-2"><a href="tuesday-september-6-2022.html#cb401-2" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">6508</span>)</span></code></pre></div>
<p>The <code>st_centroid()</code> function computes the geographic center of each simple feature geometry (<code>sfg</code>) in the data frame.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="tuesday-september-6-2022.html#cb402-1" aria-hidden="true" tabindex="-1"></a>countyCenters.sf <span class="ot">&lt;-</span> sfdf <span class="sc">|&gt;</span></span>
<span id="cb402-2"><a href="tuesday-september-6-2022.html#cb402-2" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_centroid</span>()</span></code></pre></div>
<pre><code>## Warning in st_centroid.sf(sfdf): st_centroid assumes attributes are constant
## over geometries of x</code></pre>
<p>The warning is to let you know that the attributes attached to each geometry (polygons) might be misleading when attached to the new geometry (points). Different geometric support can mean different interpretations of the attribute.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="tuesday-september-6-2022.html#cb404-1" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_geometry</span>(countyCenters.sf)</span></code></pre></div>
<pre><code>## Geometry set for 82 features 
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 347970.3 ymin: 1069814 xmax: 639099.2 ymax: 1565402
## Projected CRS: NAD83(2011) / Mississippi TM
## First 5 geometries:</code></pre>
<pre><code>## POINT (607909.2 1565402)</code></pre>
<pre><code>## POINT (639099.2 1550199)</code></pre>
<pre><code>## POINT (577860 1552732)</code></pre>
<pre><code>## POINT (552191 1557790)</code></pre>
<pre><code>## POINT (478087.6 1564075)</code></pre>
<p>To get the centroid location for the state, you first take the a union of all the counties using the <code>st_union()</code> function, then use the <code>st_centroid()</code> function.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="tuesday-september-6-2022.html#cb411-1" aria-hidden="true" tabindex="-1"></a>stateCenter.sfc <span class="ot">&lt;-</span> sfdf <span class="sc">|&gt;</span></span>
<span id="cb411-2"><a href="tuesday-september-6-2022.html#cb411-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">|&gt;</span></span>
<span id="cb411-3"><a href="tuesday-september-6-2022.html#cb411-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_centroid</span>()</span></code></pre></div>
<p>The result is a simple feature geometry column of length one where the geometry contains the centroid location.</p>
<p>Which county contains the geographic center of the state? Here we use the geometric binary predicate <code>st_contains()</code>.</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="tuesday-september-6-2022.html#cb412-1" aria-hidden="true" tabindex="-1"></a>( Contains <span class="ot">&lt;-</span> sfdf <span class="sc">|&gt;</span></span>
<span id="cb412-2"><a href="tuesday-september-6-2022.html#cb412-2" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_contains</span>(stateCenter.sfc,</span>
<span id="cb412-3"><a href="tuesday-september-6-2022.html#cb412-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sparse =</span> <span class="cn">FALSE</span>) )</span></code></pre></div>
<pre><code>##        [,1]
##  [1,] FALSE
##  [2,] FALSE
##  [3,] FALSE
##  [4,] FALSE
##  [5,] FALSE
##  [6,] FALSE
##  [7,] FALSE
##  [8,] FALSE
##  [9,] FALSE
## [10,] FALSE
## [11,] FALSE
## [12,] FALSE
## [13,] FALSE
## [14,] FALSE
## [15,] FALSE
## [16,] FALSE
## [17,] FALSE
## [18,] FALSE
## [19,] FALSE
## [20,] FALSE
## [21,] FALSE
## [22,] FALSE
## [23,] FALSE
## [24,] FALSE
## [25,] FALSE
## [26,] FALSE
## [27,] FALSE
## [28,] FALSE
## [29,] FALSE
## [30,] FALSE
## [31,] FALSE
## [32,] FALSE
## [33,] FALSE
## [34,] FALSE
## [35,] FALSE
## [36,] FALSE
## [37,] FALSE
## [38,] FALSE
## [39,] FALSE
## [40,] FALSE
## [41,] FALSE
## [42,] FALSE
## [43,] FALSE
## [44,]  TRUE
## [45,] FALSE
## [46,] FALSE
## [47,] FALSE
## [48,] FALSE
## [49,] FALSE
## [50,] FALSE
## [51,] FALSE
## [52,] FALSE
## [53,] FALSE
## [54,] FALSE
## [55,] FALSE
## [56,] FALSE
## [57,] FALSE
## [58,] FALSE
## [59,] FALSE
## [60,] FALSE
## [61,] FALSE
## [62,] FALSE
## [63,] FALSE
## [64,] FALSE
## [65,] FALSE
## [66,] FALSE
## [67,] FALSE
## [68,] FALSE
## [69,] FALSE
## [70,] FALSE
## [71,] FALSE
## [72,] FALSE
## [73,] FALSE
## [74,] FALSE
## [75,] FALSE
## [76,] FALSE
## [77,] FALSE
## [78,] FALSE
## [79,] FALSE
## [80,] FALSE
## [81,] FALSE
## [82,] FALSE</code></pre>
<p>You include the <code>sparse = FALSE</code> argument so the result is a matrix containing <code>TRUE</code>s and <code>FALSE</code>s. Since there are 82 counties and one centroid the matrix has 82 rows and 1 column. All matrix entries are <code>FALSE</code> except the one containing the center.</p>
<p>To map the result you first plot the county geometries, then add the county geometry for the center county and fill it red. Note that you use the matrix you called <code>Contains</code> to subset this county. Finally you add the location of the state centroid to the plot.</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="tuesday-september-6-2022.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb414-2"><a href="tuesday-september-6-2022.html#cb414-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-3"><a href="tuesday-september-6-2022.html#cb414-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sfdf) <span class="sc">+</span></span>
<span id="cb414-4"><a href="tuesday-september-6-2022.html#cb414-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb414-5"><a href="tuesday-september-6-2022.html#cb414-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sfdf[Contains, ], <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb414-6"><a href="tuesday-september-6-2022.html#cb414-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> stateCenter.sfc) <span class="sc">+</span></span>
<span id="cb414-7"><a href="tuesday-september-6-2022.html#cb414-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<p>The function <code>st_area()</code> returns a vector of the geographical area (in sq. units) of each of the spatial objects. Here county boundaries as polygons.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="tuesday-september-6-2022.html#cb415-1" aria-hidden="true" tabindex="-1"></a>sfdf <span class="sc">|&gt;</span></span>
<span id="cb415-2"><a href="tuesday-september-6-2022.html#cb415-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_area</span>()</span></code></pre></div>
<pre><code>## Units: [m^2]
##  [1] 1059845789 1129805491 1177795196 1063555913 1292308911 1837313947
##  [7] 1209563206 1050434214 1081610367 1111684631 1789727469 1873807962
## [13] 1537935343 1182321227 1047492468 1387412534 1298534836 1305083703
## [19] 1689710519 1539012925 2325208833 2002801262 1320449739 1821075582
## [25] 1165056081 1566560661 1062455271 1313215090 1103428267 1584296774
## [31] 1053624790 1195801329 1966286085 1077116415 2004569381 1127253959
## [37] 1933657382 1811075898 1604263674 1162255863 2412017942 1136584592
## [43] 1491632367 1497746748 1952707326 1894657055 1566911457 1653697972
## [49] 2045637420 1824649519 1481229225 2294433604 1797593028 1798362792
## [55] 1625787733 1254286842 1564126825 2051293154 2027900509 1366995434
## [61] 1858641378 1066358984 1072169833 1117271183 1208280395 1493574538
## [67] 1450255735 1398323080 1284051541 1225628132 1695604706 1798766462
## [73] 1811701938 1955125869 1067233035 1063132758 2151445783 1205245026
## [79] 1177906764 1834858322 1533395797 1238226953</code></pre>
<p>The vector values have units which are derived from the CRS.</p>
<p>There is an attribute called <code>AREA</code> in the data frame but it is better to calculate it from the spatial geometries because you are sure then of the units.</p>
<p>What happens when you apply the area function on the centroid object?</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="tuesday-september-6-2022.html#cb417-1" aria-hidden="true" tabindex="-1"></a>countyCenters.sf <span class="sc">|&gt;</span></span>
<span id="cb417-2"><a href="tuesday-september-6-2022.html#cb417-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_area</span>()</span></code></pre></div>
<pre><code>## Units: [m^2]
##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [77] 0 0 0 0 0 0</code></pre>
<p>Compute a 10 km buffer around the state and show the result with a plot. First use <code>st_union()</code>, then <code>st_buffer()</code>, then pipe the output (a simple feature data frame to <code>ggplot()</code>).</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="tuesday-september-6-2022.html#cb419-1" aria-hidden="true" tabindex="-1"></a>sfdf <span class="sc">|&gt;</span></span>
<span id="cb419-2"><a href="tuesday-september-6-2022.html#cb419-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_union</span>() <span class="sc">|&gt;</span></span>
<span id="cb419-3"><a href="tuesday-september-6-2022.html#cb419-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">10000</span>) <span class="sc">|&gt;</span></span>
<span id="cb419-4"><a href="tuesday-september-6-2022.html#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb419-5"><a href="tuesday-september-6-2022.html#cb419-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb419-6"><a href="tuesday-september-6-2022.html#cb419-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> sfdf) <span class="sc">+</span></span>
<span id="cb419-7"><a href="tuesday-september-6-2022.html#cb419-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
<p>Length of boundary lines for U.S. states. Transform the CRS to 2163 (US National Atlas Equal Area). Note that the geometry is multi-polygons. Convert the polygons to multi-linestrings, then use <code>st_length()</code> to get the total length of the lines.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="tuesday-september-6-2022.html#cb420-1" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> spData<span class="sc">::</span>us_states <span class="sc">|&gt;</span></span>
<span id="cb420-2"><a href="tuesday-september-6-2022.html#cb420-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">2163</span>)</span>
<span id="cb420-3"><a href="tuesday-september-6-2022.html#cb420-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-4"><a href="tuesday-september-6-2022.html#cb420-4" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_length</span>(states) <span class="co"># returns zeroes because geometry is polygon</span></span></code></pre></div>
<pre><code>## Units: [m]
##  [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [39] 0 0 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="tuesday-september-6-2022.html#cb422-1" aria-hidden="true" tabindex="-1"></a>states <span class="sc">|&gt;</span></span>
<span id="cb422-2"><a href="tuesday-september-6-2022.html#cb422-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="at">to =</span> <span class="st">&quot;MULTILINESTRING&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb422-3"><a href="tuesday-september-6-2022.html#cb422-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_length</span>()</span></code></pre></div>
<pre><code>## Units: [m]
##  [1] 1710433.26 2298001.84 2102155.22  514571.45 2949041.87 1746686.74
##  [7] 2570625.84 1436260.52 1957704.71 2216035.60 1018647.33 2567370.61
## [13] 2112070.19 2826608.77 2338551.23  747093.89 2296339.40 1771057.91
## [19] 2334844.08 1497781.59 1275536.83 1998187.83 4959188.68  778627.31
## [25] 1592462.66 1680675.61 3810365.04  407944.22   60329.77 1859164.04
## [31] 1656525.21 1835778.08 1572793.19 1638356.40 3579150.33 1711366.62
## [37] 2051115.13  782857.63 2378176.63 2221531.40 1467821.30 2198130.04
## [43]  304698.28 1855108.54 1972765.77 2407304.31 2344371.69 1900586.84
## [49] 2029017.32</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="thursday-september-1-2022.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
