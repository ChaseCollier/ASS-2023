<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Thursday February 2, 2023 | GIS5122: Applied Spatial Statistics</title>
  <meta name="description" content="Thursday February 2, 2023 | GIS5122: Applied Spatial Statistics" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Thursday February 2, 2023 | GIS5122: Applied Spatial Statistics" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jelsner/ASS-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Thursday February 2, 2023 | GIS5122: Applied Spatial Statistics" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tuesday-january-31-2023.html"/>
<link rel="next" href="tuesday-february-7-2023.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Applied Spatial Statistics</a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html"><i class="fa fa-check"></i>Syllabus and set up</a>
<ul>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#course-description-and-expected-learning-outcomes"><i class="fa fa-check"></i>Course description and expected learning outcomes</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#grades-and-ethics"><i class="fa fa-check"></i>Grades and ethics</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#outline-of-topics-and-schedule"><i class="fa fa-check"></i>Outline of topics and schedule</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#reference-materials"><i class="fa fa-check"></i>Reference materials</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#reproducible-research"><i class="fa fa-check"></i>Reproducible research</a></li>
<li class="chapter" data-level="" data-path="syllabus-and-set-up.html"><a href="syllabus-and-set-up.html#getting-you-set-up"><i class="fa fa-check"></i>Getting you set up</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html"><i class="fa fa-check"></i>Thursday, January 12, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#important-points-from-the-syllabus"><i class="fa fa-check"></i>Important points from the syllabus</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#continue-with-setup"><i class="fa fa-check"></i>Continue with setup</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#about-rstudio"><i class="fa fa-check"></i>About RStudio</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#lab-assignments"><i class="fa fa-check"></i>Lab assignments</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#data-science-workflow-with-r-markdown"><i class="fa fa-check"></i>Data science workflow with R markdown</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#getting-started-with-r"><i class="fa fa-check"></i>Getting started with R</a></li>
<li class="chapter" data-level="" data-path="thursday-january-12-2023.html"><a href="thursday-january-12-2023.html#completely-new-to-r"><i class="fa fa-check"></i>Completely new to R?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html"><i class="fa fa-check"></i>Tuesday, January 17, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#class-notes"><i class="fa fa-check"></i>Class notes</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#using-r"><i class="fa fa-check"></i>Using R</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-17-2023.html"><a href="tuesday-january-17-2023.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html"><i class="fa fa-check"></i>Thursday January 19, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#getting-data-into-r"><i class="fa fa-check"></i>Getting data into R</a></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#working-with-data-frames-using-functions-from-dplyr"><i class="fa fa-check"></i>Working with data frames using functions from {dplyr}</a></li>
<li class="chapter" data-level="" data-path="thursday-january-19-2023.html"><a href="thursday-january-19-2023.html#making-graphs"><i class="fa fa-check"></i>Making graphs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html"><i class="fa fa-check"></i>Tuesday January 24, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#making-graphs-1"><i class="fa fa-check"></i>Making graphs</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#introduction-to-simple-features"><i class="fa fa-check"></i>Introduction to simple features</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-24-2023.html"><a href="tuesday-january-24-2023.html#geo-computation-on-simple-features"><i class="fa fa-check"></i>Geo-computation on simple features</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html"><i class="fa fa-check"></i>Tuesday January 31, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#filtering-selecting-and-conditioning-on-attributes"><i class="fa fa-check"></i>Filtering, selecting, and conditioning on attributes</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#filtering-on-geographic-boundaries"><i class="fa fa-check"></i>Filtering on geographic boundaries</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#joining-data-frames"><i class="fa fa-check"></i>Joining data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#interpolating-using-areal-weights"><i class="fa fa-check"></i>Interpolating using areal weights</a></li>
<li class="chapter" data-level="" data-path="tuesday-january-31-2023.html"><a href="tuesday-january-31-2023.html#s4-spatial-data-objects"><i class="fa fa-check"></i>S4 spatial data objects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html"><i class="fa fa-check"></i>Thursday February 2, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html#working-with-raster-data"><i class="fa fa-check"></i>Working with raster data</a></li>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html#working-with-space-time-data"><i class="fa fa-check"></i>Working with space-time data</a></li>
<li class="chapter" data-level="" data-path="thursday-february-2-2023.html"><a href="thursday-february-2-2023.html#mapping-using-functions-from-the-ggplot2-package"><i class="fa fa-check"></i>Mapping using functions from the {ggplot2} package</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html"><i class="fa fa-check"></i>Tuesday February 7, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#mapping-using-functions-from-the-tmap-package"><i class="fa fa-check"></i>Mapping using functions from the {tmap} package</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#creating-an-interactive-map"><i class="fa fa-check"></i>Creating an interactive map</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#isolines-and-isobands"><i class="fa fa-check"></i>Isolines and isobands</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#hillshape-and-colors-with-tidyterra"><i class="fa fa-check"></i>Hillshape and colors with tidyterra</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#visualizing-spatial-data"><i class="fa fa-check"></i>Visualizing spatial data</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#adding-an-inset-map"><i class="fa fa-check"></i>Adding an inset map</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-7-2023.html"><a href="tuesday-february-7-2023.html#making-maps-with-rdeck"><i class="fa fa-check"></i>Making maps with rdeck</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html"><i class="fa fa-check"></i>Tuesday February 14, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#defining-spatial-neighborhoods-and-spatial-weights"><i class="fa fa-check"></i>Defining spatial neighborhoods and spatial weights</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#computing-autocorrelation"><i class="fa fa-check"></i>Computing autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#spatial-lag-and-its-relation-to-autocorrelation"><i class="fa fa-check"></i>Spatial lag and its relation to autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-14-2023.html"><a href="tuesday-february-14-2023.html#other-neighbor-definitions"><i class="fa fa-check"></i>Other neighbor definitions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-16-2023.html"><a href="thursday-february-16-2023.html"><i class="fa fa-check"></i>Thursday February 16, 2023</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html"><i class="fa fa-check"></i>Tuesday February 21, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#assessing-the-statistical-significance-of-autocorrelation"><i class="fa fa-check"></i>Assessing the statistical significance of autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#bivariate-spatial-autocorrelation"><i class="fa fa-check"></i>Bivariate spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#local-indicators-of-spatial-autocorrelation"><i class="fa fa-check"></i>Local indicators of spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-21-2023.html"><a href="tuesday-february-21-2023.html#constraining-group-membership-based-on-spatial-autocorrelation"><i class="fa fa-check"></i>Constraining group membership based on spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html"><i class="fa fa-check"></i>Thursday February 23, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#estimating-spatial-autocorrelation-in-model-residuals"><i class="fa fa-check"></i>Estimating spatial autocorrelation in model residuals</a></li>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i>Choosing a spatial regression model</a></li>
<li class="chapter" data-level="" data-path="thursday-february-23-2023.html"><a href="thursday-february-23-2023.html#fitting-and-interpreting-spatial-regression-models"><i class="fa fa-check"></i>Fitting and interpreting spatial regression models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-february-28-2023.html"><a href="tuesday-february-28-2023.html"><i class="fa fa-check"></i>Tuesday February 28, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-february-28-2023.html"><a href="tuesday-february-28-2023.html#fitting-and-interpreting-geographic-regression"><i class="fa fa-check"></i>Fitting and interpreting geographic regression</a></li>
<li class="chapter" data-level="" data-path="tuesday-february-28-2023.html"><a href="tuesday-february-28-2023.html#mapping-incidence-and-risk-with-a-spatial-regression-model"><i class="fa fa-check"></i>Mapping incidence and risk with a spatial regression model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html"><i class="fa fa-check"></i>Tuesday March 7, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#spatial-data-as-point-patterns"><i class="fa fa-check"></i>Spatial data as point patterns</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#theoretical-framework-for-analyzingmodeling-point-pattern-data"><i class="fa fa-check"></i>Theoretical framework for analyzing/modeling point pattern data</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#working-with-point-pattern-data-using-functions-from-the-spatstat-package"><i class="fa fa-check"></i>Working with point pattern data using functions from the spatstat package</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-7-2023.html"><a href="tuesday-march-7-2023.html#quantifying-the-spatial-intensity-of-events"><i class="fa fa-check"></i>Quantifying the spatial intensity of events</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html"><i class="fa fa-check"></i>Tuesday March 21, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#creating-ppp-and-owin-objects-from-simple-feature-data-frames"><i class="fa fa-check"></i>Creating <code>ppp</code> and <code>owin</code> objects from simple feature data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#estimating-spatial-intensity-as-a-function-of-distance"><i class="fa fa-check"></i>Estimating spatial intensity as a function of distance</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-21-2023.html"><a href="tuesday-march-21-2023.html#covariate-trend-as-a-possible-confounding-factor"><i class="fa fa-check"></i>Covariate trend as a possible confounding factor</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html"><i class="fa fa-check"></i>Thursday March 23, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#estimating-the-relative-risk"><i class="fa fa-check"></i>Estimating the relative risk</a></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#estimating-second-moment-properties-of-events"><i class="fa fa-check"></i>Estimating second-moment properties of events</a></li>
<li class="chapter" data-level="" data-path="thursday-march-23-2023.html"><a href="thursday-march-23-2023.html#examples-of-clustered-events"><i class="fa fa-check"></i>Examples of clustered events</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html"><i class="fa fa-check"></i>Tuesday March 28, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#removing-duplicate-events-and-defining-the-domain"><i class="fa fa-check"></i>Removing duplicate events and defining the domain</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#determining-statistical-significance-of-clustering"><i class="fa fa-check"></i>Determining statistical significance of clustering</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#estimating-clustering-in-multi-type-event-locations"><i class="fa fa-check"></i>Estimating clustering in multi-type event locations</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#interpolating-output-from-a-distance-function"><i class="fa fa-check"></i>Interpolating output from a distance function</a></li>
<li class="chapter" data-level="" data-path="tuesday-march-28-2023.html"><a href="tuesday-march-28-2023.html#limitations-of-the-distance-functions"><i class="fa fa-check"></i>Limitations of the distance functions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html"><i class="fa fa-check"></i>Thursday March 30, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#limitations-on-interpreting-distance-functions"><i class="fa fa-check"></i>Limitations on interpreting distance functions</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#models-for-point-pattern-data"><i class="fa fa-check"></i>Models for point pattern data</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#fitting-and-interpreting-inhibition-models"><i class="fa fa-check"></i>Fitting and interpreting inhibition models</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#fitting-and-interpreting-cluster-models"><i class="fa fa-check"></i>Fitting and interpreting cluster models</a></li>
<li class="chapter" data-level="" data-path="thursday-march-30-2023.html"><a href="thursday-march-30-2023.html#assessing-how-well-the-model-fits"><i class="fa fa-check"></i>Assessing how well the model fits</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html"><i class="fa fa-check"></i>Tuesday April 4, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#fitting-a-log-gaussian-cox-model"><i class="fa fa-check"></i>Fitting a log-Gaussian Cox model</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#assessing-how-well-a-point-pattern-model-fits-the-data"><i class="fa fa-check"></i>Assessing how well a point pattern model fits the data</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-4-2023.html"><a href="tuesday-april-4-2023.html#an-example-of-a-point-process-model-in-the-wild"><i class="fa fa-check"></i>An example of a point process model in the wild</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html"><i class="fa fa-check"></i>Thursday April 6, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#spatial-logistic-regression"><i class="fa fa-check"></i>Spatial logistic regression</a></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#spatial-data-interpolation"><i class="fa fa-check"></i>Spatial data interpolation</a></li>
<li class="chapter" data-level="" data-path="thursday-april-6-2023.html"><a href="thursday-april-6-2023.html#computing-the-sample-variogram"><i class="fa fa-check"></i>Computing the sample variogram</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html"><i class="fa fa-check"></i>Thursday April 13, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html#fitting-a-variogram-model-to-the-sample-variogram"><i class="fa fa-check"></i>Fitting a variogram model to the sample variogram</a></li>
<li class="chapter" data-level="" data-path="thursday-april-13-2023.html"><a href="thursday-april-13-2023.html#creating-an-interpolated-surface-with-the-method-of-kriging"><i class="fa fa-check"></i>Creating an interpolated surface with the method of kriging</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html"><i class="fa fa-check"></i>Tuesday April 18, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#comparing-interpolation-methods"><i class="fa fa-check"></i>Comparing interpolation methods</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#evaluating-interpolation-accuracy"><i class="fa fa-check"></i>Evaluating interpolation accuracy</a></li>
<li class="chapter" data-level="" data-path="tuesday-april-18-2023.html"><a href="tuesday-april-18-2023.html#block-cross-validation"><i class="fa fa-check"></i>Block cross validation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html"><i class="fa fa-check"></i>Thursday April 20, 2023</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#interpolating-to-areal-units-block-kriging"><i class="fa fa-check"></i>Interpolating to areal units (block kriging)</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#simulating-spatial-fields"><i class="fa fa-check"></i>Simulating spatial fields</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#interpolating-multiple-variables"><i class="fa fa-check"></i>Interpolating multiple variables</a></li>
<li class="chapter" data-level="" data-path="thursday-april-20-2023.html"><a href="thursday-april-20-2023.html#machine-learning-for-spatial-interpolation"><i class="fa fa-check"></i>Machine learning for spatial interpolation</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GIS5122: Applied Spatial Statistics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="thursday-february-2-2023" class="section level1 unnumbered hasAnchor">
<h1>Thursday February 2, 2023<a href="thursday-february-2-2023.html#thursday-february-2-2023" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>“Hell isn’t other people’s code. Hell is your own code from 3 years ago.”</strong> – Jeff Atwood</p>
<table>
<thead>
<tr class="header">
<th>Lab</th>
<th>Date</th>
<th>Lessons covered</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Thursday January 26</td>
<td>1-4</td>
</tr>
<tr class="even">
<td>2</td>
<td>Thursday February 9</td>
<td>5-7</td>
</tr>
<tr class="odd">
<td>3</td>
<td>Tuesday February 28</td>
<td>8-11</td>
</tr>
<tr class="even">
<td>4</td>
<td>Thursday April 6</td>
<td>12-18</td>
</tr>
<tr class="odd">
<td>5</td>
<td>Thursday April 27</td>
<td>19-22</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th>Date</th>
<th>Lesson/Lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>January 10</td>
<td>Syllabus</td>
</tr>
<tr class="even">
<td>January 12</td>
<td>Lesson 1</td>
</tr>
<tr class="odd">
<td>January 17</td>
<td>Lesson 2</td>
</tr>
<tr class="even">
<td>January 19</td>
<td>Lesson 3</td>
</tr>
<tr class="odd">
<td>January 24</td>
<td>Lesson 4</td>
</tr>
<tr class="even">
<td>January 26</td>
<td>Lab 1</td>
</tr>
<tr class="odd">
<td>January 31</td>
<td>Lesson 5</td>
</tr>
<tr class="even">
<td>February 2</td>
<td>Lesson 6</td>
</tr>
<tr class="odd">
<td>February 7</td>
<td>Lesson 7</td>
</tr>
<tr class="even">
<td>February 9</td>
<td>Lab 2</td>
</tr>
<tr class="odd">
<td>February 14</td>
<td>Lesson 8</td>
</tr>
<tr class="even">
<td>February 16</td>
<td>Lesson 9</td>
</tr>
<tr class="odd">
<td>February 21</td>
<td>Lesson 10</td>
</tr>
<tr class="even">
<td>February 23</td>
<td>Lesson 11</td>
</tr>
<tr class="odd">
<td>February 28</td>
<td>Lab 3</td>
</tr>
<tr class="even">
<td>March 2</td>
<td>Lesson 12</td>
</tr>
<tr class="odd">
<td>March 7</td>
<td>Lesson 13</td>
</tr>
<tr class="even">
<td>March 9</td>
<td>Lesson 14</td>
</tr>
<tr class="odd">
<td>March 14</td>
<td>Spring Break</td>
</tr>
<tr class="even">
<td>March 16</td>
<td>Spring Break</td>
</tr>
<tr class="odd">
<td>March 21</td>
<td>Lesson 15</td>
</tr>
<tr class="even">
<td>March 23</td>
<td>FREE</td>
</tr>
<tr class="odd">
<td>March 28</td>
<td>Lesson 16</td>
</tr>
<tr class="even">
<td>March 30</td>
<td>Lesson 17</td>
</tr>
<tr class="odd">
<td>April 4</td>
<td>Lesson 18</td>
</tr>
<tr class="even">
<td>April 6</td>
<td>Lab 4</td>
</tr>
<tr class="odd">
<td>April 11</td>
<td>Lesson 19</td>
</tr>
<tr class="even">
<td>April 13</td>
<td>Lesson 20</td>
</tr>
<tr class="odd">
<td>April 18</td>
<td>Lesson 21</td>
</tr>
<tr class="even">
<td>April 20</td>
<td>FREE</td>
</tr>
<tr class="odd">
<td>April 25</td>
<td>Lesson 22</td>
</tr>
<tr class="even">
<td>April 27</td>
<td>Lab 5</td>
</tr>
</tbody>
</table>
<div id="working-with-raster-data" class="section level2 unnumbered hasAnchor">
<h2>Working with raster data<a href="thursday-february-2-2023.html#working-with-raster-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <em>raster data model</em> divides geographic space into a grid of cells (or pixels) of constant size (resolution). A cell may have an attribute value</p>
<p>The {raster} package has functions for working with raster data using S4 objects (reference class). The {terra} package has functions for creating, reading, manipulating, and writing raster data using S3 objects <code>SpatRaster</code> and <code>SpatVect</code></p>
<p>To see what methods (functions) for class <code>SpatRaster</code> are available use the <code>methods()</code> function</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="thursday-february-2-2023.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span></code></pre></div>
<pre><code>## terra 1.7.3</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="thursday-february-2-2023.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="st">&quot;SpatRaster&quot;</span>)</span></code></pre></div>
<pre><code>##   [1] !                     [                     [[                   
##   [4] [[&lt;-                  [&lt;-                   %in%                 
##   [7] $                     $&lt;-                   activeCat            
##  [10] activeCat&lt;-           add&lt;-                 adjacent             
##  [13] aggregate             align                 allNA                
##  [16] animate               anyNA                 app                  
##  [19] approximate           area                  Arith                
##  [22] as.array              as.bool               as.character         
##  [25] as.contour            as.data.frame         as.factor            
##  [28] as.int                as.integer            as.lines             
##  [31] as.list               as.logical            as.matrix            
##  [34] as.numeric            as.points             as.polygons          
##  [37] as.raster             atan_2                atan2                
##  [40] autocor               barplot               blocks               
##  [43] boundaries            boxplot               buffer               
##  [46] c                     catalyze              categories           
##  [49] cats                  cellFromRowCol        cellFromRowColCombine
##  [52] cellFromXY            cells                 cellSize             
##  [55] clamp_ts              clamp                 classify             
##  [58] click                 coerce                colFromCell          
##  [61] colFromX              colorize              coltab               
##  [64] coltab&lt;-              Compare               compareGeom          
##  [67] concats               contour               costDist             
##  [70] costDistance          cover                 crds                 
##  [73] crop                  crosstab              crs                  
##  [76] crs&lt;-                 datatype              deepcopy             
##  [79] density               depth                 depth&lt;-              
##  [82] diff                  dim                   dim&lt;-                
##  [85] direction             disagg                distance             
##  [88] droplevels            expanse               ext                  
##  [91] ext&lt;-                 extend                extract              
##  [94] fillTime              flip                  focal                
##  [97] focal3D               focalCor              focalCpp             
## [100] focalPairs            focalReg              focalValues          
## [103] freq                  global                gridDist             
## [106] gridDistance          has.colors            has.RGB              
## [109] hasMinMax             hasValues             head                 
## [112] hist                  ifel                  image                
## [115] init                  inMemory              inset                
## [118] interpIDW             interpNear            interpolate          
## [121] intersect             is.bool               is.factor            
## [124] is.finite             is.infinite           is.int               
## [127] is.lonlat             is.na                 is.nan               
## [130] is.related            isFALSE               isTRUE               
## [133] lapp                  layerCor              levels               
## [136] levels&lt;-              linearUnits           lines                
## [139] log                   Logic                 longnames            
## [142] longnames&lt;-           makeTiles             mask                 
## [145] match                 math                  Math                 
## [148] Math2                 mean                  median               
## [151] merge                 minmax                modal                
## [154] mosaic                NAflag                NAflag&lt;-             
## [157] names                 names&lt;-               ncell                
## [160] ncol                  ncol&lt;-                nlyr                 
## [163] nlyr&lt;-                noNA                  not.na               
## [166] nrow                  nrow&lt;-                nsrc                 
## [169] origin                origin&lt;-              pairs                
## [172] patches               persp                 plet                 
## [175] plot                  plotRGB               points               
## [178] polys                 predict               project              
## [181] quantile              rangeFill             rapp                 
## [184] rast                  rasterize             rasterizeGeom        
## [187] rasterizeWin          rcl                   readStart            
## [190] readStop              readValues            rectify              
## [193] relate                rep                   res                  
## [196] res&lt;-                 resample              rescale              
## [199] rev                   RGB                   RGB&lt;-                
## [202] roll                  rotate                rowColCombine        
## [205] rowColFromCell        rowFromCell           rowFromY             
## [208] sapp                  saveRDS               scale                
## [211] scoff                 scoff&lt;-               sds                  
## [214] segregate             sel                   selectHighest        
## [217] selectRange           serialize             set.cats             
## [220] set.crs               set.ext               set.names            
## [223] set.RGB               set.values            setMinMax            
## [226] setValues             shift                 show                 
## [229] sieve                 size                  sort                 
## [232] sources               spatSample            split                
## [235] sprc                  stdev                 str                  
## [238] stretch               subset                subst                
## [241] summary               Summary               t                    
## [244] tail                  tapp                  terrain              
## [247] text                  tighten               time                 
## [250] time&lt;-                timeInfo              trans                
## [253] trim                  unique                units                
## [256] units&lt;-               update                values               
## [259] values&lt;-              varnames              varnames&lt;-           
## [262] viewshed              weighted.mean         where.max            
## [265] where.min             which.lyr             which.max            
## [268] which.min             window                window&lt;-             
## [271] wrap                  writeCDF              writeRaster          
## [274] writeStart            writeStop             writeValues          
## [277] xFromCell             xFromCol              xmax                 
## [280] xmax&lt;-                xmin                  xmin&lt;-               
## [283] xres                  xyFromCell            yFromCell            
## [286] yFromRow              ymax                  ymax&lt;-               
## [289] ymin                  ymin&lt;-                yres                 
## [292] zonal                 zoom                 
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>The list includes {base} R and {sf} functions and methods</p>
<p>The <code>terra::rast()</code> function defaults to a raster with a geographic (longitude/latitude) CRS and a 1 by 1 degree grid of cells across the globe</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="thursday-february-2-2023.html#cb5-1" aria-hidden="true" tabindex="-1"></a>( r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>() )</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 180, 360, 1  (nrow, ncol, nlyr)
## resolution  : 1, 1  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84</code></pre>
<p>The object has class <code>SpatRaster</code> with geographic coordinates spanning the globe at one-degree resolution in the north-south and the east-west directions</p>
<p>Arguments including <code>xmin</code>, <code>nrows</code>, <code>ncols</code>, and <code>crs</code> are used to change the default settings</p>
<p>To create a raster with 36 longitudes -100 and 0 degrees East longitude and 18 latitudes between the equator and 50 degrees N latitude you specify the number of columns, the number of rows and the extent as follows</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="thursday-february-2-2023.html#cb7-1" aria-hidden="true" tabindex="-1"></a>( r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">ncols =</span> <span class="dv">36</span>, <span class="at">nrows =</span> <span class="dv">18</span>, </span>
<span id="cb7-2"><a href="thursday-february-2-2023.html#cb7-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xmin =</span> <span class="sc">-</span><span class="dv">100</span>, <span class="at">xmax =</span> <span class="dv">0</span>, </span>
<span id="cb7-3"><a href="thursday-february-2-2023.html#cb7-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">50</span>) )</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 18, 36, 1  (nrow, ncol, nlyr)
## resolution  : 2.777778, 2.777778  (x, y)
## extent      : -100, 0, 0, 50  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84</code></pre>
<p>This results in raster with cell resolution of 2.7 degrees of longitude and 2.7 degrees of latitude</p>
<p>Extract only the resolution</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="thursday-february-2-2023.html#cb9-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="thursday-february-2-2023.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">res</span>()</span></code></pre></div>
<pre><code>## [1] 2.777778 2.777778</code></pre>
<p>The structure of the raster can be changed after created. Here you change the resolution to 3 degrees. This induces changes to the number of rows and columns</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="thursday-february-2-2023.html#cb11-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(r) <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb11-2"><a href="thursday-february-2-2023.html#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="thursday-february-2-2023.html#cb11-3" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="thursday-february-2-2023.html#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ncol</span>()</span></code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="thursday-february-2-2023.html#cb13-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="thursday-february-2-2023.html#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 17</code></pre>
<p>The <code>SpatRaster</code> object <code>r</code> has no values assigned to the cells</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="thursday-february-2-2023.html#cb15-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">ncol =</span> <span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">10</span>)</span>
<span id="cb15-2"><a href="thursday-february-2-2023.html#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="thursday-february-2-2023.html#cb15-3" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="thursday-february-2-2023.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">ncell</span>()</span></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="thursday-february-2-2023.html#cb17-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="thursday-february-2-2023.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">hasValues</span>()</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Here there are 100 cells in a 10 by 10 arrangement with no values in any of the cells</p>
<p>The <code>terra::values()</code> function places values in the cells. The function is specified on the left-hand side of the assignment operator. Here you first assign to a vector of length <code>terra::ncell(r)</code> random numbers from a uniform distribution with the <code>runif()</code> function. The default is that the random numbers are between 0 and 1. Then you place those values in the grid cells</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="thursday-february-2-2023.html#cb19-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="thursday-february-2-2023.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">ncell</span>() <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="thursday-february-2-2023.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runif</span>()</span>
<span id="cb19-4"><a href="thursday-february-2-2023.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="thursday-february-2-2023.html#cb19-5" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r) <span class="ot">&lt;-</span> v</span>
<span id="cb19-6"><a href="thursday-february-2-2023.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="thursday-february-2-2023.html#cb19-7" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb19-8"><a href="thursday-february-2-2023.html#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##       lyr.1
## 1 0.8591144
## 2 0.4396852
## 3 0.3548743
## 4 0.3506411
## 5 0.6504018
## 6 0.7716672</code></pre>
<p>The cells are arranged in lexicographical order (upper left to lower right) and the cells receive values from the vector in this order</p>
<p>The <code>terra::plot()</code> function creates a choropleth map of the values in cells</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="thursday-february-2-2023.html#cb21-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="thursday-february-2-2023.html#cb21-2" aria-hidden="true" tabindex="-1"></a> terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The default CRS is geographic</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="thursday-february-2-2023.html#cb22-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="thursday-february-2-2023.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crs</span>()</span></code></pre></div>
<pre><code>## [1] &quot;GEOGCRS[\&quot;WGS 84\&quot;,\n    DATUM[\&quot;World Geodetic System 1984\&quot;,\n        ELLIPSOID[\&quot;WGS 84\&quot;,6378137,298.257223563,\n            LENGTHUNIT[\&quot;metre\&quot;,1]],\n        ID[\&quot;EPSG\&quot;,6326]],\n    PRIMEM[\&quot;Greenwich\&quot;,0,\n        ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433],\n        ID[\&quot;EPSG\&quot;,8901]],\n    CS[ellipsoidal,2],\n        AXIS[\&quot;longitude\&quot;,east,\n            ORDER[1],\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433,\n                ID[\&quot;EPSG\&quot;,9122]]],\n        AXIS[\&quot;latitude\&quot;,north,\n            ORDER[2],\n            ANGLEUNIT[\&quot;degree\&quot;,0.0174532925199433,\n                ID[\&quot;EPSG\&quot;,9122]]]]&quot;</code></pre>
<p>To re-project the raster use the function <code>terra::project()</code></p>
<p>Here you create another raster with cell numbers as values using the <code>terra::setValues()</code> function to place the numbers in the cells. This function receives the values on the right-hand side of the assignment operator allowing you to use the pipe operator</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="thursday-february-2-2023.html#cb24-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">110</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">90</span>, </span>
<span id="cb24-2"><a href="thursday-february-2-2023.html#cb24-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> <span class="dv">40</span>, <span class="at">ymax =</span> <span class="dv">60</span>, </span>
<span id="cb24-3"><a href="thursday-february-2-2023.html#cb24-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ncols =</span> <span class="dv">10</span>, <span class="at">nrows =</span> <span class="dv">10</span>)</span>
<span id="cb24-4"><a href="thursday-february-2-2023.html#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="thursday-february-2-2023.html#cb24-5" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb24-6"><a href="thursday-february-2-2023.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">setValues</span>(<span class="dv">1</span><span class="sc">:</span>terra<span class="sc">::</span><span class="fu">ncell</span>(r))</span>
<span id="cb24-7"><a href="thursday-february-2-2023.html#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="thursday-february-2-2023.html#cb24-8" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb24-9"><a href="thursday-february-2-2023.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The values increase starting from top left to bottom right as dictated by the sequence <code>1:terra::ncell(r)</code> and the lexicographic order in which the raster grids are filled</p>
<p>The <code>terra::rast()</code> function imports data with functions from the {rgdal} package. Supported formats include <code>GeoTIFF</code>, <code>ESRI</code>, <code>ENVI</code>, and <code>ERDAS</code>. Formats that can be imported as a raster can also be used to export a raster</p>
<p>Consider the <code>Meuse</code> dataset (from the {sp} package), using a file in the native ‘raster- file’ format</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="thursday-february-2-2023.html#cb25-1" aria-hidden="true" tabindex="-1"></a>( r <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;external/test.grd&quot;</span>, </span>
<span id="cb25-2"><a href="thursday-february-2-2023.html#cb25-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">package =</span> <span class="st">&quot;raster&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="thursday-february-2-2023.html#cb25-3" aria-hidden="true" tabindex="-1"></a> terra<span class="sc">::</span><span class="fu">rast</span>() )</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 115, 80, 1  (nrow, ncol, nlyr)
## resolution  : 40, 40  (x, y)
## extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +datum=WGS84 +units=m +no_defs 
## source      : test.grd 
## name        :      test 
## min value   :  138.7071 
## max value   : 1736.0579</code></pre>
<p>Do the cells contain values? Is the raster stored in memory? Create a plot</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="thursday-february-2-2023.html#cb27-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="thursday-february-2-2023.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">hasValues</span>()</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="thursday-february-2-2023.html#cb29-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="thursday-february-2-2023.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">inMemory</span>()</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="thursday-february-2-2023.html#cb31-1" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="thursday-february-2-2023.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(<span class="at">main =</span> <span class="st">&quot;Raster layer from file&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Cells are always in a rectangular arrangement. Cells that lie outside a non-rectangular boundary inside the rectangular extent are set to <code>NA</code> and are not plotted</p>
<p><code>SpatRaster</code> objects can have more than one attribute called layers</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="thursday-february-2-2023.html#cb32-1" aria-hidden="true" tabindex="-1"></a>r</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 115, 80, 1  (nrow, ncol, nlyr)
## resolution  : 40, 40  (x, y)
## extent      : 178400, 181600, 329400, 334000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=sterea +lat_0=52.1561605555556 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +datum=WGS84 +units=m +no_defs 
## source      : test.grd 
## name        :      test 
## min value   :  138.7071 
## max value   : 1736.0579</code></pre>
<p>The dimensions are <code>nrow</code> = 115 by <code>ncol</code> = 80 and <code>nlyr</code> = 1</p>
<p>Here you create three rasters and assign random values to the cells</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="thursday-february-2-2023.html#cb34-1" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb34-2"><a href="thursday-february-2-2023.html#cb34-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r1) <span class="ot">&lt;-</span> <span class="fu">runif</span>(terra<span class="sc">::</span><span class="fu">ncell</span>(r1))</span>
<span id="cb34-3"><a href="thursday-february-2-2023.html#cb34-3" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb34-4"><a href="thursday-february-2-2023.html#cb34-4" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r2) <span class="ot">&lt;-</span> <span class="fu">runif</span>(terra<span class="sc">::</span><span class="fu">ncell</span>(r2))</span>
<span id="cb34-5"><a href="thursday-february-2-2023.html#cb34-5" aria-hidden="true" tabindex="-1"></a>r3 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb34-6"><a href="thursday-february-2-2023.html#cb34-6" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r3) <span class="ot">&lt;-</span> <span class="fu">runif</span>(terra<span class="sc">::</span><span class="fu">ncell</span>(r3))</span></code></pre></div>
<p>You combine the rasters into a single <code>SpatRaster</code> raster with three layers using the concatenate function <code>c()</code></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="thursday-february-2-2023.html#cb35-1" aria-hidden="true" tabindex="-1"></a>( s <span class="ot">&lt;-</span> <span class="fu">c</span>(r1, r2, r3) )</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 10, 10, 3  (nrow, ncol, nlyr)
## resolution  : 36, 18  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 
## source(s)   : memory
## names       :      lyr.1,     lyr.1,      lyr.1 
## min values  : 0.02126347, 0.0442237, 0.00192274 
## max values  : 0.98867286, 0.9937324, 0.99644371</code></pre>
<p>Extract dimensions and then plot</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="thursday-february-2-2023.html#cb37-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="thursday-february-2-2023.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>()</span></code></pre></div>
<pre><code>## [1] 10 10  3</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="thursday-february-2-2023.html#cb39-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="thursday-february-2-2023.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">nlyr</span>()</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="thursday-february-2-2023.html#cb41-1" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="thursday-february-2-2023.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Here you import a raster with multiple layers from a file. The layers are values corresponding to the RBG color scheme</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="thursday-february-2-2023.html#cb42-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;external/rlogo.grd&quot;</span>, </span>
<span id="cb42-2"><a href="thursday-february-2-2023.html#cb42-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">package =</span> <span class="st">&quot;raster&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="thursday-february-2-2023.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rast</span>()</span>
<span id="cb42-4"><a href="thursday-february-2-2023.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="thursday-february-2-2023.html#cb42-5" aria-hidden="true" tabindex="-1"></a>b <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="thursday-february-2-2023.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Most {base} R functions (<code>+</code>, <code>*</code>, <code>round()</code>, <code>ceiling()</code>, <code>log()</code>, etc) work on raster objects. Operations are done on each cell</p>
<p>Here you place the numbers from 1 to 100 sequentially in the cells, then add 100 to these values and take the square root</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="thursday-february-2-2023.html#cb43-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">ncol =</span> <span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">10</span>)</span>
<span id="cb43-2"><a href="thursday-february-2-2023.html#cb43-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>terra<span class="sc">::</span><span class="fu">ncell</span>(r)</span>
<span id="cb43-3"><a href="thursday-february-2-2023.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="thursday-february-2-2023.html#cb43-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> r <span class="sc">+</span> <span class="dv">100</span></span>
<span id="cb43-5"><a href="thursday-february-2-2023.html#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="thursday-february-2-2023.html#cb43-6" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> s <span class="sc">|&gt;</span></span>
<span id="cb43-7"><a href="thursday-february-2-2023.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sqrt</span>()</span>
<span id="cb43-8"><a href="thursday-february-2-2023.html#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="thursday-february-2-2023.html#cb43-9" aria-hidden="true" tabindex="-1"></a>s <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="thursday-february-2-2023.html#cb43-10" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Here you replace the cell values with random uniform numbers between 0 and 1. Then round to the nearest integer and add one</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="thursday-february-2-2023.html#cb44-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">ncol =</span> <span class="dv">10</span>, <span class="at">nrow =</span> <span class="dv">10</span>)</span>
<span id="cb44-2"><a href="thursday-february-2-2023.html#cb44-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r) <span class="ot">&lt;-</span> <span class="fu">runif</span>(terra<span class="sc">::</span><span class="fu">ncell</span>(r))</span>
<span id="cb44-3"><a href="thursday-february-2-2023.html#cb44-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="thursday-february-2-2023.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>()</span>
<span id="cb44-5"><a href="thursday-february-2-2023.html#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="thursday-february-2-2023.html#cb44-6" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> r <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb44-7"><a href="thursday-february-2-2023.html#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="thursday-february-2-2023.html#cb44-8" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb44-9"><a href="thursday-february-2-2023.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Replace only certain values with the subset function <code>[]</code></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="thursday-february-2-2023.html#cb45-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">90</span>, <span class="at">xmax =</span> <span class="dv">90</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="dv">30</span>, <span class="at">ymax =</span> <span class="dv">30</span>)</span>
<span id="cb45-2"><a href="thursday-february-2-2023.html#cb45-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r) <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(terra<span class="sc">::</span><span class="fu">ncell</span>(r))</span>
<span id="cb45-3"><a href="thursday-february-2-2023.html#cb45-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(r)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="thursday-february-2-2023.html#cb46-1" aria-hidden="true" tabindex="-1"></a>r[r <span class="sc">&gt;</span> <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb46-2"><a href="thursday-february-2-2023.html#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="thursday-february-2-2023.html#cb46-3" aria-hidden="true" tabindex="-1"></a>r <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="thursday-february-2-2023.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<p>Functions for manipulating a raster</p>
<p>The <code>terra::crop()</code> function takes a geographic subset of a larger raster object. A raster is cropped by providing an extent object or other spatial object from which an extent can be extracted (objects from classes deriving from raster and from spatial in the {sp} package)</p>
<p>The <code>terra::trim()</code> function crops a raster layer by removing the outer rows and columns that only contain <code>NA</code> values. The <code>terra::extend()</code> function adds new rows and/or columns with <code>NA</code> values</p>
<p>The <code>terra::merge()</code> function combines two or more rasters into a single raster. The input objects must have the same resolution and origin (such that their cells fit into a single larger raster). If this is not the case, first adjust one of the objects with the functions <code>aggregate()</code> or <code>resample()</code></p>
<p>The <code>terra::aggregate()</code> and <code>terra::disagg()</code> functions change the resolution (cell size) of a raster object</p>
<p>As an example here you crop the raster into two pieces and then merge the two pieces into one. The <code>terra::merge()</code> function has the argument <code>filename =</code> that allows you to export to a file (here <code>test.grd</code> in the folder <code>outputs</code>)</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="thursday-february-2-2023.html#cb47-1" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="thursday-february-2-2023.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(terra<span class="sc">::</span><span class="fu">ext</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">30</span>)) </span>
<span id="cb47-3"><a href="thursday-february-2-2023.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="thursday-february-2-2023.html#cb47-4" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="thursday-february-2-2023.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crop</span>(terra<span class="sc">::</span><span class="fu">ext</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">180</span>, <span class="sc">-</span><span class="dv">20</span>, <span class="dv">10</span>))</span>
<span id="cb47-6"><a href="thursday-february-2-2023.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="thursday-february-2-2023.html#cb47-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> r1 <span class="sc">|&gt;</span></span>
<span id="cb47-8"><a href="thursday-february-2-2023.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">merge</span>(r2, </span>
<span id="cb47-9"><a href="thursday-february-2-2023.html#cb47-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">filename =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;test.grd&quot;</span>), </span>
<span id="cb47-10"><a href="thursday-february-2-2023.html#cb47-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb47-11"><a href="thursday-february-2-2023.html#cb47-11" aria-hidden="true" tabindex="-1"></a>m <span class="sc">|&gt;</span></span>
<span id="cb47-12"><a href="thursday-february-2-2023.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>The <code>terra::flip()</code> function flips the data (reverse order) in the horizontal or vertical direction. The <code>terra::rotate()</code> function rotates a raster that have longitudes from 0 to 360 degrees (often used by climatologists) to the standard -180 to 180 degrees system</p>
<p>You extract values from a raster for a set of locations with the <code>terra::extract()</code> function. The locations can be a vector object (points, lines, polygons), a matrix with (x, y) or (longitude, latitude – in that order) coordinates, or a vector with cell numbers</p>
<p>First create a raster layer with integer values from 1 to 25 and specify two locations within the raster extent first as a matrix array and the second as a <code>SpatVector</code> object</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="thursday-february-2-2023.html#cb48-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">ncols =</span> <span class="dv">5</span>, <span class="at">nrows =</span> <span class="dv">5</span>, </span>
<span id="cb48-2"><a href="thursday-february-2-2023.html#cb48-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">5</span>, </span>
<span id="cb48-3"><a href="thursday-february-2-2023.html#cb48-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> <span class="dv">5</span>)</span>
<span id="cb48-4"><a href="thursday-february-2-2023.html#cb48-4" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(r) <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span></span>
<span id="cb48-5"><a href="thursday-february-2-2023.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="thursday-february-2-2023.html#cb48-6" aria-hidden="true" tabindex="-1"></a>xy <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb48-7"><a href="thursday-february-2-2023.html#cb48-7" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> xy <span class="sc">|&gt;</span></span>
<span id="cb48-8"><a href="thursday-february-2-2023.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>(<span class="at">crs =</span> <span class="st">&#39;epsg:4326&#39;</span>)</span></code></pre></div>
<p>Next use the <code>terra::extract()</code> function with the first argument the raster layer and the second the locations from which you extract the values</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="thursday-february-2-2023.html#cb49-1" aria-hidden="true" tabindex="-1"></a>values1 <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="thursday-february-2-2023.html#cb49-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">extract</span>(xy)</span>
<span id="cb49-3"><a href="thursday-february-2-2023.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="thursday-february-2-2023.html#cb49-4" aria-hidden="true" tabindex="-1"></a>values2 <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb49-5"><a href="thursday-february-2-2023.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">extract</span>(p)</span></code></pre></div>
<p>In both cases the values are returned as a data frame. In the second case an <code>ID</code> variable is included</p>
<p>To convert the values of a raster layer to points or polygons you use <code>as.points()</code> and <code>as.polygons()</code></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="thursday-february-2-2023.html#cb50-1" aria-hidden="true" tabindex="-1"></a>valuesAll <span class="ot">&lt;-</span> r <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="thursday-february-2-2023.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.points</span>()</span></code></pre></div>
<p>These functions return a <code>SpatVector</code> object only for cells with values</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="thursday-february-2-2023.html#cb51-1" aria-hidden="true" tabindex="-1"></a>valuesAll <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a href="thursday-february-2-2023.html#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Converting vector data to rasters</p>
<p>Vector data is converted to a raster with the <code>terra::rasterize()</code> function. Polygon to raster conversion is often done to create a mask (i.e. to set to <code>NA</code> a set of cells of a raster object, or to summarize values on a raster by zone. For example a country polygon is converted to a raster that is used to set all the cells outside that country to <code>NA</code></p>
<p>Also polygons representing administrative regions such as states can be converted to a raster to summarize values by region. Point to raster conversion is often done to analyze location data (location of a specific species of tree in a forest)</p>
<p>Example: create a raster containing the number of tornadoes passing through each grid cell</p>
<p>Here you use a latitude/longitude grid (1/2 degree latitude by 1/2 degree longitude) with each cell in the grid containing the number of tornadoes that went through it since 2003</p>
<p>First import the tornado (initial track point) data as a simple feature data frame</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="thursday-february-2-2023.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;1950-2021-torn-initpoint&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))) {</span>
<span id="cb52-2"><a href="thursday-february-2-2023.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;http://www.spc.noaa.gov/gis/svrgis/zipped/1950-2021-torn-initpoint.zip&quot;</span>,</span>
<span id="cb52-3"><a href="thursday-february-2-2023.html#cb52-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;1950-2021-torn-initpoint.zip&quot;</span>))</span>
<span id="cb52-4"><a href="thursday-february-2-2023.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;1950-2021-torn-initpoint.zip&quot;</span>), </span>
<span id="cb52-5"><a href="thursday-february-2-2023.html#cb52-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb52-6"><a href="thursday-february-2-2023.html#cb52-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-7"><a href="thursday-february-2-2023.html#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="thursday-february-2-2023.html#cb52-8" aria-hidden="true" tabindex="-1"></a>Torn.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;1950-2021-torn-initpoint&quot;</span>), </span>
<span id="cb52-9"><a href="thursday-february-2-2023.html#cb52-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">&quot;1950-2021-torn-initpoint&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-10"><a href="thursday-february-2-2023.html#cb52-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(yr <span class="sc">&gt;=</span> <span class="dv">2003</span>)</span></code></pre></div>
<pre><code>## Reading layer `1950-2021-torn-initpoint&#39; from data source 
##   `/Users/jameselsner/Desktop/ClassNotes/ASS-2023/data/1950-2021-torn-initpoint&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 67558 features and 22 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -163.53 ymin: 17.7212 xmax: -64.7151 ymax: 61.02
## Geodetic CRS:  WGS 84</code></pre>
<p>Note the extent of the bounding box and check the CRS</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="thursday-february-2-2023.html#cb54-1" aria-hidden="true" tabindex="-1"></a>Torn.sf <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="thursday-february-2-2023.html#cb54-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_crs</span>()</span></code></pre></div>
<pre><code>## Coordinate Reference System:
##   User input: WGS 84 
##   wkt:
## GEOGCRS[&quot;WGS 84&quot;,
##     DATUM[&quot;World Geodetic System 1984&quot;,
##         ELLIPSOID[&quot;WGS 84&quot;,6378137,298.257223563,
##             LENGTHUNIT[&quot;metre&quot;,1]]],
##     PRIMEM[&quot;Greenwich&quot;,0,
##         ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     CS[ellipsoidal,2],
##         AXIS[&quot;latitude&quot;,north,
##             ORDER[1],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##         AXIS[&quot;longitude&quot;,east,
##             ORDER[2],
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],
##     ID[&quot;EPSG&quot;,4326]]</code></pre>
<p>Next create a raster (called <code>frame</code>) with a domain that covers the area of interest and assign a resolution of one degree in longitude and one degree in latitude. Check the extent of the raster with the <code>terra::ext()</code> function</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="thursday-february-2-2023.html#cb56-1" aria-hidden="true" tabindex="-1"></a>frame <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="dv">106</span>, <span class="at">xmax =</span> <span class="sc">-</span><span class="dv">67</span>, </span>
<span id="cb56-2"><a href="thursday-february-2-2023.html#cb56-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymin =</span> <span class="dv">24</span>, <span class="at">ymax =</span> <span class="dv">50</span>)</span>
<span id="cb56-3"><a href="thursday-february-2-2023.html#cb56-3" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(frame) <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb56-4"><a href="thursday-february-2-2023.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="thursday-february-2-2023.html#cb56-5" aria-hidden="true" tabindex="-1"></a>frame <span class="sc">|&gt;</span></span>
<span id="cb56-6"><a href="thursday-february-2-2023.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">ext</span>()</span></code></pre></div>
<pre><code>## SpatExtent : -106, -67, 24, 50 (xmin, xmax, ymin, ymax)</code></pre>
<p>Next use the <code>terra::rasterize()</code> function to count the number of times each raster cell contains a tornado. The first argument is the spatial data frame and the second is the raster without values. The argument <code>field =</code> specifies a column name in the spatial data frame (here just an identifier) and the argument <code>fun =</code> specifies what to do</p>
<p>Here you want a count of the unique instances of the field in each cell and this is done with setting <code>fun = "length"</code>. Raster cells without tornadoes are given a value of 0 based on the <code>background =</code> argument</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="thursday-february-2-2023.html#cb58-1" aria-hidden="true" tabindex="-1"></a>Torn.v <span class="ot">&lt;-</span> Torn.sf <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="thursday-february-2-2023.html#cb58-2" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb58-3"><a href="thursday-february-2-2023.html#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="thursday-february-2-2023.html#cb58-4" aria-hidden="true" tabindex="-1"></a>( Torn.r <span class="ot">&lt;-</span> Torn.v <span class="sc">|&gt;</span></span>
<span id="cb58-5"><a href="thursday-february-2-2023.html#cb58-5" aria-hidden="true" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">rasterize</span>(<span class="at">y =</span> frame, </span>
<span id="cb58-6"><a href="thursday-february-2-2023.html#cb58-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fun =</span> <span class="st">&quot;length&quot;</span>,</span>
<span id="cb58-7"><a href="thursday-february-2-2023.html#cb58-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">background =</span> <span class="dv">0</span>) )</span></code></pre></div>
<pre><code>## class       : SpatRaster 
## dimensions  : 52, 78, 1  (nrow, ncol, nlyr)
## resolution  : 0.5, 0.5  (x, y)
## extent      : -106, -67, 24, 50  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 
## source(s)   : memory
## name        : lyr.1 
## min value   :     0 
## max value   :    58</code></pre>
<p>The result is a raster layer. The number of tornadoes occurring in each cell are the values</p>
<p>Print the first 200 values (lexicographical order).</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="thursday-february-2-2023.html#cb60-1" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">values</span>(Torn.r)[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>]</span></code></pre></div>
<pre><code>##   [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##  [26]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##  [51]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
##  [76]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [101]  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [126]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0
## [151]  0  0  0  0  0  0  0  1  1  4  2  3  4  6  5  1  0  4  6 13  8  7 20 18 12
## [176]  5  6  5  4  0  1  0  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</code></pre>
<p>Use the <code>plot()</code> method to visualize the raster layer</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="thursday-february-2-2023.html#cb62-1" aria-hidden="true" tabindex="-1"></a>Torn.r <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="thursday-february-2-2023.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>You can recognize the broad shape of the eastern 2/3rds of the United States. Some cells across the Plains and the South have quite a few tornadoes and very few tornadoes in cells over the Appalachian Mountains</p>
<p>Indeed tornado activity appears in distinct clusters. A statistic that estimates the amount of clustering is called Moran’s I. It is a global measure of clustering with high values indicated by high values nearby to other high values and low values nearby to other low values</p>
<p>Values of Moran’s I range from -1 to +1 where positive values indicate clustering and negative values indicate regularity (e.g., chessboard). It is implemented on a raster with the <code>raster::Moran()</code> function</p>
<p>The function works only with S4 raster objects. So you need to first convert <code>Torn.r</code> from a <code>SpatRaster</code> to a <code>RasterLayer</code>. You do this with <code>raster()</code> function after loading the {raster} package</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="thursday-february-2-2023.html#cb63-1" aria-hidden="true" tabindex="-1"></a>Torn.r2 <span class="ot">&lt;-</span> Torn.r <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a href="thursday-february-2-2023.html#cb63-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">raster</span>()</span></code></pre></div>
<p>You check the structure of the object with the <code>str()</code> function</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="thursday-february-2-2023.html#cb64-1" aria-hidden="true" tabindex="-1"></a>Torn.r2 <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="thursday-february-2-2023.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## Formal class &#39;RasterLayer&#39; [package &quot;raster&quot;] with 13 slots
##   ..@ file    :Formal class &#39;.RasterFile&#39; [package &quot;raster&quot;] with 13 slots
##   .. .. ..@ name        : chr &quot;&quot;
##   .. .. ..@ datanotation: chr &quot;FLT4S&quot;
##   .. .. ..@ byteorder   : chr &quot;little&quot;
##   .. .. ..@ nodatavalue : num -Inf
##   .. .. ..@ NAchanged   : logi FALSE
##   .. .. ..@ nbands      : int 1
##   .. .. ..@ bandorder   : chr &quot;BIL&quot;
##   .. .. ..@ offset      : int 0
##   .. .. ..@ toptobottom : logi TRUE
##   .. .. ..@ blockrows   : int 0
##   .. .. ..@ blockcols   : int 0
##   .. .. ..@ driver      : chr &quot;&quot;
##   .. .. ..@ open        : logi FALSE
##   ..@ data    :Formal class &#39;.SingleLayerData&#39; [package &quot;raster&quot;] with 13 slots
##   .. .. ..@ values    : num [1:4056] 0 0 0 0 0 0 0 0 0 0 ...
##   .. .. ..@ offset    : num 0
##   .. .. ..@ gain      : num 1
##   .. .. ..@ inmemory  : logi TRUE
##   .. .. ..@ fromdisk  : logi FALSE
##   .. .. ..@ isfactor  : logi FALSE
##   .. .. ..@ attributes: list()
##   .. .. ..@ haveminmax: logi TRUE
##   .. .. ..@ min       : num 0
##   .. .. ..@ max       : num 58
##   .. .. ..@ band      : int 1
##   .. .. ..@ unit      : chr &quot;&quot;
##   .. .. ..@ names     : chr &quot;lyr.1&quot;
##   ..@ legend  :Formal class &#39;.RasterLegend&#39; [package &quot;raster&quot;] with 5 slots
##   .. .. ..@ type      : chr(0) 
##   .. .. ..@ values    : logi(0) 
##   .. .. ..@ color     : logi(0) 
##   .. .. ..@ names     : logi(0) 
##   .. .. ..@ colortable: logi(0) 
##   ..@ title   : chr(0) 
##   ..@ extent  :Formal class &#39;Extent&#39; [package &quot;raster&quot;] with 4 slots
##   .. .. ..@ xmin: num -106
##   .. .. ..@ xmax: num -67
##   .. .. ..@ ymin: num 24
##   .. .. ..@ ymax: num 50
##   ..@ rotated : logi FALSE
##   ..@ rotation:Formal class &#39;.Rotation&#39; [package &quot;raster&quot;] with 2 slots
##   .. .. ..@ geotrans: num(0) 
##   .. .. ..@ transfun:function ()  
##   ..@ ncols   : int 78
##   ..@ nrows   : int 52
##   ..@ crs     :Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
##   .. .. ..@ projargs: chr &quot;+proj=longlat +datum=WGS84 +no_defs&quot;
##   .. .. ..$ comment: chr &quot;GEOGCRS[\&quot;unknown\&quot;,\n    DATUM[\&quot;World Geodetic System 1984\&quot;,\n        ELLIPSOID[\&quot;WGS 84\&quot;,6378137,298.25722&quot;| __truncated__
##   ..@ srs     : chr &quot;GEOGCRS[\&quot;unknown\&quot;,\n    DATUM[\&quot;World Geodetic System 1984\&quot;,\n        ELLIPSOID[\&quot;WGS 84\&quot;,6378137,298.25722&quot;| __truncated__
##   ..@ history : list()
##   ..@ z       : list()</code></pre>
<p>The object <code>Torn.r2</code> is a <code>RasterLayer</code> as an S4 data class. Note the use of slots for storing the information</p>
<p>You can use the <code>raster::Moran()</code> function on the <code>RasterLayer</code> object</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="thursday-february-2-2023.html#cb66-1" aria-hidden="true" tabindex="-1"></a>Torn.r2 <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="thursday-february-2-2023.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">Moran</span>()</span></code></pre></div>
<pre><code>## [1] 0.7573041</code></pre>
<p>The value of .75 indicates high level of tornado clustering at the 1 degree lat/lon resolution</p>
<p>Under the null hypothesis of no spatial autocorrelation the expected value for Moran’s I is close to zero [-1/(n-1), where n is the number of cells]</p>
<p>Clusters at a local level can be found using a local indicator of spatial autocorrelation. One such indicator is local Moran’s I, which is computed at each cell (using the <code>MoranLocal()</code> function) so the result is a raster</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="thursday-february-2-2023.html#cb68-1" aria-hidden="true" tabindex="-1"></a>Torn_lmi.r <span class="ot">&lt;-</span> Torn.r2 <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="thursday-february-2-2023.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">MoranLocal</span>()</span>
<span id="cb68-3"><a href="thursday-february-2-2023.html#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="thursday-february-2-2023.html#cb68-4" aria-hidden="true" tabindex="-1"></a>Torn_lmi.r <span class="sc">|&gt;</span></span>
<span id="cb68-5"><a href="thursday-february-2-2023.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>This type of plot makes is easy to identify the “hot” spots of tornadoes over parts of the South and the Central Plains</p>
<p>To convert the local Moran raster to a S4 spatial data frame with polygon geometries use the <code>rasterToPolygons()</code> function.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="thursday-february-2-2023.html#cb69-1" aria-hidden="true" tabindex="-1"></a>( Torn_lmi.sp <span class="ot">&lt;-</span> Torn_lmi.r <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="thursday-february-2-2023.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">rasterToPolygons</span>() )</span></code></pre></div>
<pre><code>## class       : SpatialPolygonsDataFrame 
## features    : 4056 
## extent      : -106, -67, 24, 50  (xmin, xmax, ymin, ymax)
## crs         : +proj=longlat +datum=WGS84 +no_defs 
## variables   : 1
## names       :              layer 
## min values  : -0.588694478032414 
## max values  :    25.569003562998</code></pre>
<p>Then convert the <code>SpatialPolygonsDataFrame</code> to a simple features data frame and make a plot</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="thursday-february-2-2023.html#cb71-1" aria-hidden="true" tabindex="-1"></a>Torn_lmi.sf <span class="ot">&lt;-</span> Torn_lmi.sp <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="thursday-february-2-2023.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>()</span>
<span id="cb71-3"><a href="thursday-february-2-2023.html#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="thursday-february-2-2023.html#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-5"><a href="thursday-february-2-2023.html#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="thursday-february-2-2023.html#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Torn_lmi.sf) <span class="sc">+</span></span>
<span id="cb71-7"><a href="thursday-february-2-2023.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> layer, <span class="at">color =</span> layer))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Or using functions from the {tmap} package you map the raster layer directly.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="thursday-february-2-2023.html#cb72-1" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span></code></pre></div>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="thursday-february-2-2023.html#cb74-1" aria-hidden="true" tabindex="-1"></a>Torn_lmi.r <span class="sc">|&gt;</span></span>
<span id="cb74-2"><a href="thursday-february-2-2023.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_shape</span>() <span class="sc">+</span></span>
<span id="cb74-3"><a href="thursday-february-2-2023.html#cb74-3" aria-hidden="true" tabindex="-1"></a>    tmap<span class="sc">::</span><span class="fu">tm_raster</span>(<span class="at">alpha =</span> .<span class="dv">7</span>)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE</code></pre>
<pre><code>## Variable(s) &quot;NA&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9349f892f34a4b16b35a" style="width:672px;height:480px;"></div>
<script type="application/json" data-for="htmlwidget-9349f892f34a4b16b35a">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEUAAAA/CAYAAAC2NAWOAAAEAElEQVR4nO1aMa4aQQw16BcUSAT9JkIkKWhQ9IuUadIlV/hVDpF75AI5w9c/Ah1lWiJRhCgIhGgQikRBEYVURsZrz3h2Z4ddtE9CWnZnZzwe+9njWYAGDRo0aFAqWvvj0+naQlQJ/c5jq12kg952GUuWSkFVCp9wb7vM3Pvz8o3Ytu4oZCm3ClUpaAX0P79HcUvW4rQUOlHJfVzt6wxRKTg5yhloKdLEsZ3LkuqEhlMEiEqhFoJW4nONW7ESAIA77QEqg1/f0uQ1mKNPCDRSrgsRm6IPdR8ekSTQ8E3bWNywCmiIVoBTKdLK0nuaBXGgO1naVgFtX1JGCVbKX3g76X1O0ha+KlNxvr7bmv9b4Ev9qRCoVNreshjXwIX7cIEtpOqDxZpc74SOa9mO+OTIcArtVHs5RNCQFY+xEEUsH9FEHwEXSuGZq2Y1rnxjfVjA+rC4uBfCOxyhlsbfDd3pA7A0XyJBrgx8pgk77I68g0pCUyK2uq9U89GeuWTmaNNBaOfWyFIUtCRhXVkfZ0gLGTIXdUNIBZNWJPQdH7jwkgXR/l1yWJTlgpdo81iLLxeReMcKSUGapdPrkHm09senU2+7hB/dv2Y+8LV35SaoDHxXmmQMS8xjrQARzn1uFaWeEEqrtT4sRCtxrWzeVc+Ds6Vofk+v6a8IqMtJUUJC6qOVNg7KO6fCD7uj8//5fmNWTNlFpbIs6Mwplix1vt/Ax1cfggbIqxjrO2UovfXv99eTxv70mnKBDzzCaG1Csl8qH0VsS+l3Hlt3Vl8OnYClvaY8ra5r4aAYLuU8IbRifVjAZDU1WQgCeWrYHYkcxdN/lIsnYqURLRfGCjqZcX8gKsMitCsJ1Dakmrwx3Cl38jZZTc/XNDpxSKvqSwGkgnjK8qS4IbQIEBqFpH4xos12R/jy7lOGfF3F8DLRpPkCxBpt2cCVRqt4uO/AZDU1WYkGa1XNAm89hQ8MUKy8SLE+LGDcHwCATLbW8Bo7sz1biquMhwgZWGvL91Cu8G0dLzbHXKT5lgHp/9DN4WQ1heefv2C+3wAAqDnKtVGIaEOy3MlqCrPdEb5932b68Ckn9dmz6Ttan1AWocf9ATzcd+D96xcw2x0zCnUpJvURaoZopVQa71NYayEIVMLnt3AmV06QPstLVWzKKEWqnseKADzztfZrbRsLhZM3l9BFSJT2m+fspgicX0dK0PYvqAD63LXR833kE+NwPy9MlmL5jgQVoK0qVZbvHMa6iSwLJqX4Vi3km5C8LpDShYLSfAD5eLMsQVMebVAUJtqUQqdyoUqXDrRPLcpWTqWVIiGFZeZWSspoEELoMZBbKSm5JDXZ1sp9UoXl4JB8LaTcA9VGKSld6D8OEs+Pqe/qlgAAAABJRU5ErkJggg==",[[51.6570559553756,-106],[23.8021906009813,-66.5563908515316]],0.698039215686274,null,"tmap401","Torn_lmi.r"]},{"method":"addLegend","args":[{"colors":["#FEE08B","#EFF8AA","#D3EC87","#ABDB6D","#7FC865","#4FB15D","#17934D"],"labels":["-5 to 0","0 to 5","5 to 10","10 to 15","15 to 20","20 to 25","25 to 30"],"na_color":null,"na_label":"NA","opacity":0.698039215686274,"position":"topright","type":"unknown","title":"layer","extra":null,"layerId":"legend401","className":"info legend Torn_lmi.r","group":"Torn_lmi.r"}]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"Torn_lmi.r",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[23.8021906009813,51.6570559553756],"lng":[-106,-66.5563908515316]},"fitBounds":[24,-106,50,-67,[]]},"evals":[],"jsHooks":[]}</script>
<p>Focal (neighborhood) functions</p>
<p>The function <code>terra::focal()</code> computes statistics in a neighborhood of cells around a focal cell, putting the result in the focal cell of an output raster. The <code>terra::distance()</code> function computes the shortest distance to cells that are not NA. The <code>terra::direction()</code> function computes the direction towards (or from) the nearest cell that is not <code>NA</code>. The <code>terra::adjacent()</code> function determines which cells are adjacent to other cells</p>
<p>Consider a multi-band image taken from a Landsat 7 view of a small part of the Brazilian coast. It is included in the {stars} package and stored as a <em>GeoTIFF</em> file labeled <code>L7_ETMs.tif</code>. You import the image as a raster stack</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="thursday-february-2-2023.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(stars)) <span class="fu">install.packages</span>(<span class="st">&quot;stars&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: stars</code></pre>
<pre><code>## Loading required package: abind</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="thursday-february-2-2023.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb80-2"><a href="thursday-february-2-2023.html#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="thursday-february-2-2023.html#cb80-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>,</span>
<span id="cb80-4"><a href="thursday-february-2-2023.html#cb80-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">package =</span> <span class="st">&quot;stars&quot;</span>)</span>
<span id="cb80-5"><a href="thursday-february-2-2023.html#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="thursday-february-2-2023.html#cb80-6" aria-hidden="true" tabindex="-1"></a>( L7.rs <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(f) )</span></code></pre></div>
<pre><code>## class      : RasterStack 
## dimensions : 352, 349, 122848, 6  (nrow, ncol, ncell, nlayers)
## resolution : 28.5, 28.5  (x, y)
## extent     : 288776.3, 298722.8, 9110729, 9120761  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=25 +south +ellps=GRS80 +units=m +no_defs 
## names      : L7_ETMs_1, L7_ETMs_2, L7_ETMs_3, L7_ETMs_4, L7_ETMs_5, L7_ETMs_6</code></pre>
<p>The data <code>L7.rs</code> is a <code>RasterStack</code> object as a S4 reference class</p>
<p>You list the slot names and extract the extent and CRS using the <code>@</code> syntax.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="thursday-february-2-2023.html#cb82-1" aria-hidden="true" tabindex="-1"></a>L7.rs<span class="sc">@</span>extent</span></code></pre></div>
<pre><code>## class      : Extent 
## xmin       : 288776.3 
## xmax       : 298722.8 
## ymin       : 9110729 
## ymax       : 9120761</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="thursday-february-2-2023.html#cb84-1" aria-hidden="true" tabindex="-1"></a>L7.rs<span class="sc">@</span>crs</span></code></pre></div>
<pre><code>## Coordinate Reference System:
## Deprecated Proj.4 representation:
##  +proj=utm +zone=25 +south +ellps=GRS80 +units=m +no_defs 
## WKT2 2019 representation:
## PROJCRS[&quot;unknown&quot;,
##     BASEGEOGCRS[&quot;unknown&quot;,
##         DATUM[&quot;Unknown based on GRS80 ellipsoid using towgs84=0,0,0,0,0,0,0&quot;,
##             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,
##                 LENGTHUNIT[&quot;metre&quot;,1],
##                 ID[&quot;EPSG&quot;,7019]]],
##         PRIMEM[&quot;Greenwich&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8901]]],
##     CONVERSION[&quot;UTM zone 25S&quot;,
##         METHOD[&quot;Transverse Mercator&quot;,
##             ID[&quot;EPSG&quot;,9807]],
##         PARAMETER[&quot;Latitude of natural origin&quot;,0,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8801]],
##         PARAMETER[&quot;Longitude of natural origin&quot;,-33,
##             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],
##             ID[&quot;EPSG&quot;,8802]],
##         PARAMETER[&quot;Scale factor at natural origin&quot;,0.9996,
##             SCALEUNIT[&quot;unity&quot;,1],
##             ID[&quot;EPSG&quot;,8805]],
##         PARAMETER[&quot;False easting&quot;,500000,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8806]],
##         PARAMETER[&quot;False northing&quot;,10000000,
##             LENGTHUNIT[&quot;metre&quot;,1],
##             ID[&quot;EPSG&quot;,8807]],
##         ID[&quot;EPSG&quot;,17025]],
##     CS[Cartesian,2],
##         AXIS[&quot;(E)&quot;,east,
##             ORDER[1],
##             LENGTHUNIT[&quot;metre&quot;,1,
##                 ID[&quot;EPSG&quot;,9001]]],
##         AXIS[&quot;(N)&quot;,north,
##             ORDER[2],
##             LENGTHUNIT[&quot;metre&quot;,1,
##                 ID[&quot;EPSG&quot;,9001]]]]</code></pre>
<p>You extract a single band (layer) from the stack with the <code>layer =</code> argument in the <code>raster()</code> function. You then plot the raster values with the <code>plot()</code> method and compute the spatial autocorrelation with the <code>raster::Moran()</code> function</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="thursday-february-2-2023.html#cb86-1" aria-hidden="true" tabindex="-1"></a>L7.rB3 <span class="ot">&lt;-</span> L7.rs <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="thursday-february-2-2023.html#cb86-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">raster</span>(<span class="at">layer =</span> <span class="dv">3</span>)</span>
<span id="cb86-3"><a href="thursday-february-2-2023.html#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="thursday-february-2-2023.html#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="thursday-february-2-2023.html#cb86-5" aria-hidden="true" tabindex="-1"></a>L7.rB3 <span class="sc">|&gt;</span></span>
<span id="cb86-6"><a href="thursday-february-2-2023.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="thursday-february-2-2023.html#cb87-1" aria-hidden="true" tabindex="-1"></a>L7.rB3 <span class="sc">|&gt;</span></span>
<span id="cb87-2"><a href="thursday-february-2-2023.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">Moran</span>()</span></code></pre></div>
<pre><code>## [1] 0.8131887</code></pre>
<p>You convert the raster to an S3 reference class data frame with the <code>as.data.frame()</code> method. Here you do that and then compute the normalized difference vegetation index (NDVI) using columns <code>L7_ETMs.4</code> and <code>L7_ETMs.3</code> and the <code>mutate()</code> function from the {dplyr} package</p>
<p>NDVI indicates live green vegetation from satellite images. Higher values indicate more green vegetation, negative values indicate water.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="thursday-february-2-2023.html#cb89-1" aria-hidden="true" tabindex="-1"></a>L7.df <span class="ot">&lt;-</span> L7.rs <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="thursday-february-2-2023.html#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="thursday-february-2-2023.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NDVI =</span> (L7_ETMs_4 <span class="sc">-</span> L7_ETMs_3)<span class="sc">/</span>(L7_ETMs_4 <span class="sc">+</span> L7_ETMs_3))</span></code></pre></div>
<p>More examples and other functions for working with raster data using functions from the {terra} package are illustrated in <a href="https://geocompr.robinlovelace.net/raster-vector.html" class="uri">https://geocompr.robinlovelace.net/raster-vector.html</a>. Again, I encourage you to take a look at this valuable resource</p>
</div>
<div id="working-with-space-time-data" class="section level2 unnumbered hasAnchor">
<h2>Working with space-time data<a href="thursday-february-2-2023.html#working-with-space-time-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Space-time data arrive in the form of multi-dimensional arrays. Examples include:</p>
<ul>
<li>raster images</li>
<li>socio-economic or demographic data</li>
<li>environmental variables monitored at fixed stations</li>
<li>time series of satellite images with multiple spectral bands</li>
<li>spatial simulations</li>
<li>climate and weather model output</li>
</ul>
<p>The {stars} package provides functions and methods for working with space-time data as multi-dimensional S3 reference class arrays.</p>
<p>To see what methods (functions) for class <code>stars</code> are available use the <code>methods()</code> function.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="thursday-february-2-2023.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">methods</span>(<span class="at">class =</span> <span class="st">&quot;stars&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] [                 [[&lt;-              [&lt;-               %in%             
##  [5] $&lt;-               adrop             aggregate         aperm            
##  [9] as.data.frame     as.POSIXct        c                 coerce           
## [13] contour           cut               dim               dimnames         
## [17] dimnames&lt;-        droplevels        filter            hist             
## [21] image             initialize        is.na             Math             
## [25] merge             Ops               plot              predict          
## [29] print             rast              sds               show             
## [33] slotsFromS3       split             st_apply          st_area          
## [37] st_as_sf          st_as_sfc         st_as_stars       st_bbox          
## [41] st_coordinates    st_crop           st_crs            st_crs&lt;-         
## [45] st_dimensions     st_dimensions&lt;-   st_downsample     st_extract       
## [49] st_geometry       st_interpolate_aw st_intersects     st_join          
## [53] st_mosaic         st_normalize      st_redimension    st_sample        
## [57] st_set_bbox       st_transform_proj st_transform      time             
## [61] write_stars      
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>The list includes {base} R and {tidyverse} methods.</p>
<p>The typical data array is that where two dimensions represent spatial raster dimensions and the third dimensions is a band (or time). <a href="https://raw.githubusercontent.com/r-spatial/stars/master/images/cube1.png">Data array</a></p>
<p>But arrays can have more dimensions. For example, time, space, spectral band, and sensor type. <a href="https://raw.githubusercontent.com/r-spatial/stars/master/images/cube2.png">Data cube</a></p>
<p>You import a set of rasters (raster stack) as a {stars} object using the <code>stars::read_stars()</code> function. Consider the multi-band image taken from a Landsat 7 view of a small part of the Brazilian coast. It is included in the {stars} package and stored as a <em>GeoTIFF</em> file labeled <code>L7_ETMs.tif</code>.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="thursday-february-2-2023.html#cb92-1" aria-hidden="true" tabindex="-1"></a>( L7.stars <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>,</span>
<span id="cb92-2"><a href="thursday-february-2-2023.html#cb92-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">package =</span> <span class="st">&quot;stars&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb92-3"><a href="thursday-february-2-2023.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">read_stars</span>() )</span></code></pre></div>
<pre><code>## stars object with 3 dimensions and 1 attribute
## attribute(s):
##              Min. 1st Qu. Median     Mean 3rd Qu. Max.
## L7_ETMs.tif     1      54     69 68.91242      86  255
## dimension(s):
##      from  to  offset delta                     refsys point x/y
## x       1 349  288776  28.5 SIRGAS 2000 / UTM zone 25S FALSE [x]
## y       1 352 9120761 -28.5 SIRGAS 2000 / UTM zone 25S FALSE [y]
## band    1   6      NA    NA                         NA    NA</code></pre>
<p>There are three dimensions to this {stars} object, two spatial (<code>x</code> and <code>y</code>), and the third across six bands (<code>band</code>). Values across the six bands and space are summarized as a single attribute with name <code>L7_ETMs.tif</code></p>
<p>The data are stored in a four dimensional array. The first index is the attribute, the second and third indexes are the spatial coordinates, and the fourth index is the band</p>
<p>Here you plot bands 3 and 4 by sequencing on the fourth index and using the <code>plot()</code> method</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="thursday-february-2-2023.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L7.stars[,,,<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Since the data object is S3 you use functions from the <code>ggplot2()</code> package together with the <code>geom_stars()</code> layer from the {stars} package to plot all 6 bands with a common color scale bar</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="thursday-february-2-2023.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb95-2"><a href="thursday-february-2-2023.html#cb95-2" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> L7.stars) <span class="sc">+</span></span>
<span id="cb95-3"><a href="thursday-february-2-2023.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> band)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>You create a new {stars} object by applying a function to the band values. For example here you compute normalized difference vegetation index (NDVI) through a function applied across the <code>x</code> and <code>y</code> spatial dimensions using the <code>stars::st_apply()</code> method after creating the function <code>NDVI()</code></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="thursday-february-2-2023.html#cb96-1" aria-hidden="true" tabindex="-1"></a>NDVI <span class="ot">&lt;-</span> <span class="cf">function</span>(z) (z[<span class="dv">4</span>] <span class="sc">-</span> z[<span class="dv">3</span>]) <span class="sc">/</span> (z[<span class="dv">4</span>] <span class="sc">+</span> z[<span class="dv">3</span>])</span>
<span id="cb96-2"><a href="thursday-february-2-2023.html#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="thursday-february-2-2023.html#cb96-3" aria-hidden="true" tabindex="-1"></a>( NDVI.stars <span class="ot">&lt;-</span> L7.stars <span class="sc">|&gt;</span></span>
<span id="cb96-4"><a href="thursday-february-2-2023.html#cb96-4" aria-hidden="true" tabindex="-1"></a>    stars<span class="sc">::</span><span class="fu">st_apply</span>(<span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>), </span>
<span id="cb96-5"><a href="thursday-february-2-2023.html#cb96-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">FUN =</span> NDVI) )</span></code></pre></div>
<pre><code>## stars object with 2 dimensions and 1 attribute
## attribute(s):
##             Min.    1st Qu.      Median        Mean   3rd Qu.      Max.
## NDVI  -0.7534247 -0.2030075 -0.06870229 -0.06432464 0.1866667 0.5866667
## dimension(s):
##   from  to  offset delta                     refsys point x/y
## x    1 349  288776  28.5 SIRGAS 2000 / UTM zone 25S FALSE [x]
## y    1 352 9120761 -28.5 SIRGAS 2000 / UTM zone 25S FALSE [y]</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="thursday-february-2-2023.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb98-2"><a href="thursday-february-2-2023.html#cb98-2" aria-hidden="true" tabindex="-1"></a>  stars<span class="sc">::</span><span class="fu">geom_stars</span>(<span class="at">data =</span> NDVI.stars) </span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>The stars data frame can also be split, here on the band dimension, to yield a representation as six rasters in the list form</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="thursday-february-2-2023.html#cb99-1" aria-hidden="true" tabindex="-1"></a>( L7split.stars <span class="ot">&lt;-</span> <span class="fu">split</span>(L7.stars, </span>
<span id="cb99-2"><a href="thursday-february-2-2023.html#cb99-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">f =</span> <span class="st">&quot;band&quot;</span>) )</span></code></pre></div>
<pre><code>## stars object with 2 dimensions and 6 attributes
## attribute(s):
##     Min. 1st Qu. Median     Mean 3rd Qu. Max.
## X1    47      67     78 79.14772      89  255
## X2    32      55     66 67.57465      79  255
## X3    21      49     63 64.35886      77  255
## X4     9      52     63 59.23541      75  255
## X5     1      63     89 83.18266     112  255
## X6     1      32     60 59.97521      88  255
## dimension(s):
##   from  to  offset delta                     refsys point x/y
## x    1 349  288776  28.5 SIRGAS 2000 / UTM zone 25S FALSE [x]
## y    1 352 9120761 -28.5 SIRGAS 2000 / UTM zone 25S FALSE [y]</code></pre>
<p>Now the bands are given as columns in the data frame part of the {stars} object and there are only two dimensions (<code>x</code> and <code>y</code>)</p>
<p>Raster data do not need to be regular or aligned along the cardinal directions. Functions in the {stars} package supports rotated, sheared, rectilinear and curvi-linear grids
<a href="https://raw.githubusercontent.com/r-spatial/stars/master/man/figures/README-plot2-1.png">Grids</a></p>
<p>Functions in the {stars} package also support the vector data model. Vector data cubes arise when you have a single dimension that points to distinct spatial feature geometry, such as polygons (e.g. denoting administrative regions). <a href="https://raw.githubusercontent.com/r-spatial/stars/master/images/cube3.png">Vector data cube polygons</a></p>
<p>Or points (e.g., denoting sensor locations). <a href="https://raw.githubusercontent.com/r-spatial/stars/master/images/cube4.png">Vector data cube points</a></p>
<p>For more see: <a href="https://github.com/r-spatial/stars/tree/master/vignettes" class="uri">https://github.com/r-spatial/stars/tree/master/vignettes</a> and <a href="https://awesomeopensource.com/project/r-spatial/stars" class="uri">https://awesomeopensource.com/project/r-spatial/stars</a></p>
<p>Also you can check out some rough code that I’ve been working on to take advantage of the {stars} functionality including plotting daily temperatures across the U.S. and creating a vector data cube of COVID19 data in the <code>stars.Rmd</code> file on course GitHub site in the folder <code>Other_Rmds</code></p>
</div>
<div id="mapping-using-functions-from-the-ggplot2-package" class="section level2 unnumbered hasAnchor">
<h2>Mapping using functions from the {ggplot2} package<a href="thursday-february-2-2023.html#mapping-using-functions-from-the-ggplot2-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The {ggplot2} package has supports <code>sf</code> objects for making maps through the function <code>geom_sf()</code>. An initial <code>ggplot()</code> function is followed by one or more layers that are added with <code>+</code> symbol. The layers begin with <code>geom_</code> (or <code>stat_</code>)</p>
<p>For example, consider the objects <code>nz</code> and <code>nz_height</code> from the {spData} package, where <code>nz</code> is a simple feature data frame from the New Zealand census with information about the area, population, and income in the country’s 16 administrative regions</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="thursday-february-2-2023.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(spData<span class="sc">::</span>nz)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   16 obs. of  7 variables:
##  $ Name         : chr  &quot;Northland&quot; &quot;Auckland&quot; &quot;Waikato&quot; &quot;Bay of Plenty&quot; ...
##  $ Island       : chr  &quot;North&quot; &quot;North&quot; &quot;North&quot; &quot;North&quot; ...
##  $ Land_area    : num  12501 4942 23900 12071 8386 ...
##  $ Population   : num  175500 1657200 460100 299900 48500 ...
##  $ Median_income: int  23400 29600 27900 26200 24400 26100 29100 25000 32700 26900 ...
##  $ Sex_ratio    : num  0.942 0.944 0.952 0.928 0.935 ...
##  $ geom         :sfc_MULTIPOLYGON of length 16; first list element: List of 1
##   ..$ :List of 1
##   .. ..$ : num [1:68, 1:2] 1745493 1740539 1733165 1720197 1709110 ...
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;XY&quot; &quot;MULTIPOLYGON&quot; &quot;sfg&quot;
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geom&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:6] &quot;Name&quot; &quot;Island&quot; &quot;Land_area&quot; &quot;Population&quot; ...</code></pre>
<p>The simple feature column (<code>sfc</code>) is labeled <code>geom</code> and the geometry type is polygon.</p>
<p>And <code>spData::nz_height</code> is a simple feature data frame containing elevations of specific high points (peaks) in the country.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="thursday-february-2-2023.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(spData<span class="sc">::</span>nz_height)</span></code></pre></div>
<pre><code>## Classes &#39;sf&#39; and &#39;data.frame&#39;:   101 obs. of  3 variables:
##  $ t50_fid  : int  2353944 2354404 2354405 2369113 2362630 2362814 2362817 2363991 2363993 2363994 ...
##  $ elevation: int  2723 2820 2830 3033 2749 2822 2778 3004 3114 2882 ...
##  $ geometry :sfc_POINT of length 101; first list element:  &#39;XY&#39; num  1204143 5049971
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;t50_fid&quot; &quot;elevation&quot;</code></pre>
<p>The simple feature column is labeled <code>geometry</code> and the geometry type is point</p>
<p>You make a choropleth map of the median income (<code>Median_income</code>) in the regions and add a layer indicating the location of the elevation peaks</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="thursday-february-2-2023.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb105-2"><a href="thursday-february-2-2023.html#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="thursday-february-2-2023.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb105-4"><a href="thursday-february-2-2023.html#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> spData<span class="sc">::</span>nz, </span>
<span id="cb105-5"><a href="thursday-february-2-2023.html#cb105-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Median_income)) <span class="sc">+</span></span>
<span id="cb105-6"><a href="thursday-february-2-2023.html#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> spData<span class="sc">::</span>nz_height) <span class="sc">+</span></span>
<span id="cb105-7"><a href="thursday-february-2-2023.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">170</span>, <span class="dv">175</span>))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>The first use of <code>geom_sf()</code> takes the geometry column of the simple feature data frame <code>spData::nz</code> together with the <code>mapping =</code> argument and specifies filling the interior of the polygons with the values from the column labeled <code>Medium_income</code> in the simple feature data frame. The second use of <code>geom_sf()</code> takes the geometry column of <code>spData::nz_height</code> and maps the geometry type as points indicating the location of the highest peaks</p>
<p>The <code>geom_sf()</code> function automatically plots the graticule (grid of latitude and longitude) with labels. The default ranges for the graticule can be overridden using <code>scale_x_continuous()</code>, <code>scale_y_continuous()</code> or <code>coord_sf(datum = NA)</code></p>
<p>A big advantage of using functions from {ggplot2} for mapping include a large community of users and many add-on packages</p>
<p>Another example: the county land area by state in the U.S. The data is a simple feature data frame available in the {USAboundariesData} package at <code>ropensci.org</code> (not on CRAN)</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="thursday-february-2-2023.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;USAboundariesData&quot;</span>, </span>
<span id="cb106-2"><a href="thursday-february-2-2023.html#cb106-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">repos =</span> <span class="st">&quot;http://packages.ropensci.org&quot;</span>, </span>
<span id="cb106-3"><a href="thursday-february-2-2023.html#cb106-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">type =</span> <span class="st">&quot;source&quot;</span>)</span></code></pre></div>
<p>Here you extract the county borders in Florida then make a choropleth of the land area</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="thursday-february-2-2023.html#cb107-1" aria-hidden="true" tabindex="-1"></a>FLcounties.sf <span class="ot">&lt;-</span> USAboundaries<span class="sc">::</span><span class="fu">us_counties</span>(<span class="at">states =</span> <span class="st">&quot;FL&quot;</span>)</span>
<span id="cb107-2"><a href="thursday-february-2-2023.html#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="thursday-february-2-2023.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-4"><a href="thursday-february-2-2023.html#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> FLcounties.sf,</span>
<span id="cb107-5"><a href="thursday-february-2-2023.html#cb107-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> aland))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>Leaving off the <code>mapping =</code> argument will result in a map of the geometry</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="thursday-february-2-2023.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb108-2"><a href="thursday-february-2-2023.html#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> FLcounties.sf)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>Example: Wildfires in the Apalachicola National Forest (ANF). Import the Florida wildfire data as a simple feature data frame called <code>FL_Fires.sf</code> and transform the native CRS to a Florida GDL Albers (EPSG 3086)</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="thursday-february-2-2023.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;FL_Fires&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))){</span>
<span id="cb109-2"><a href="thursday-february-2-2023.html#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/FL_Fires.zip&quot;</span>,</span>
<span id="cb109-3"><a href="thursday-february-2-2023.html#cb109-3" aria-hidden="true" tabindex="-1"></a>                here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;FL_Fires.zip&quot;</span>))</span>
<span id="cb109-4"><a href="thursday-february-2-2023.html#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FL_Fires.zip&quot;</span>),</span>
<span id="cb109-5"><a href="thursday-february-2-2023.html#cb109-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb109-6"><a href="thursday-february-2-2023.html#cb109-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-7"><a href="thursday-february-2-2023.html#cb109-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-8"><a href="thursday-february-2-2023.html#cb109-8" aria-hidden="true" tabindex="-1"></a>FL_Fires.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FL_Fires&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb109-9"><a href="thursday-february-2-2023.html#cb109-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">3086</span>)</span></code></pre></div>
<pre><code>## Reading layer `FL_Fires&#39; from data source 
##   `/Users/jameselsner/Desktop/ClassNotes/ASS-2023/data/FL_Fires&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 90261 features and 37 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -9750382 ymin: 2824449 xmax: -8908899 ymax: 3632749
## Projected CRS: Mercator_2SP</code></pre>
<p>The data are start locations for 90,261 Florida wildfires over the period 1992-2015. Among other attributes each row (feature) gives the cause (<code>STAT_CAU_1</code>), discovery date (<code>CONT_DA</code>), and fire size class (A:G, small to large)</p>
<p>Start with a bar chart showing the fire causes in order of frequency</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="thursday-february-2-2023.html#cb111-1" aria-hidden="true" tabindex="-1"></a>FL_Fires.sf <span class="sc">|&gt;</span></span>
<span id="cb111-2"><a href="thursday-february-2-2023.html#cb111-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(STAT_CAU_1) <span class="sc">|&gt;</span></span>
<span id="cb111-3"><a href="thursday-february-2-2023.html#cb111-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">nF =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb111-4"><a href="thursday-february-2-2023.html#cb111-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Cause =</span> <span class="fu">reorder</span>(STAT_CAU_1, nF)) <span class="sc">|&gt;</span></span>
<span id="cb111-5"><a href="thursday-february-2-2023.html#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb111-6"><a href="thursday-february-2-2023.html#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> nF, <span class="at">y =</span> Cause))</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>Continue with a table showing the frequency of fires by size class</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="thursday-february-2-2023.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(FL_Fires.sf<span class="sc">$</span>FIRE_SIZE_)</span></code></pre></div>
<pre><code>## 
##     A     B     C     D     E     F     G 
## 20262 50981 15394  2057  1035   406   126</code></pre>
<p>Next, use the <code>USAboundaries::us_counties()</code> function to get county boundaries in Florida as a simple feature data frame. Transform the CRS to match the CRS of the wildfire simple feature. Then select on the <code>name</code> column and filter with <code>name = "Liberty"</code> to keep only the boundaries of Liberty County assign the result to the simple feature data frame named <code>Liberty.sf</code></p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="thursday-february-2-2023.html#cb114-1" aria-hidden="true" tabindex="-1"></a>FL.sf <span class="ot">&lt;-</span> USAboundaries<span class="sc">::</span><span class="fu">us_counties</span>(<span class="at">states =</span> <span class="st">&quot;FL&quot;</span>,</span>
<span id="cb114-2"><a href="thursday-february-2-2023.html#cb114-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">resolution =</span> <span class="st">&quot;high&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb114-3"><a href="thursday-february-2-2023.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(FL_Fires.sf))</span>
<span id="cb114-4"><a href="thursday-february-2-2023.html#cb114-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-5"><a href="thursday-february-2-2023.html#cb114-5" aria-hidden="true" tabindex="-1"></a>Liberty.sf <span class="ot">&lt;-</span> FL.sf <span class="sc">|&gt;</span></span>
<span id="cb114-6"><a href="thursday-february-2-2023.html#cb114-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name) <span class="sc">|&gt;</span></span>
<span id="cb114-7"><a href="thursday-february-2-2023.html#cb114-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;Liberty&quot;</span>) </span></code></pre></div>
<p>Make a map showing the boundaries of Florida and the boundaries of Liberty County</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="thursday-february-2-2023.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb115-2"><a href="thursday-february-2-2023.html#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> FL.sf) <span class="sc">+</span></span>
<span id="cb115-3"><a href="thursday-february-2-2023.html#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> Liberty.sf, <span class="at">fill =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Next use the function <code>sf::st_intersection()</code> to create a new simple feature data frame called <code>LibertyFires.sf</code> from the <code>FL_Fires.sf</code> simple feature data frame that contains only the lightning caused wildfires inside the Liberty County polygon</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="thursday-february-2-2023.html#cb116-1" aria-hidden="true" tabindex="-1"></a>LibertyFires.sf <span class="ot">&lt;-</span> FL_Fires.sf <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="thursday-february-2-2023.html#cb116-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(Liberty.sf) <span class="sc">|&gt;</span></span>
<span id="cb116-3"><a href="thursday-february-2-2023.html#cb116-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(STAT_CAU_1 <span class="sc">==</span> <span class="st">&quot;Lightning&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout
## all geometries</code></pre>
<p>Finally, make a map showing the locations of the fires in Liberty County</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="thursday-february-2-2023.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Liberty.sf) <span class="sc">+</span></span>
<span id="cb118-2"><a href="thursday-february-2-2023.html#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb118-3"><a href="thursday-february-2-2023.html#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> LibertyFires.sf,</span>
<span id="cb118-4"><a href="thursday-february-2-2023.html#cb118-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> <span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="ASS-2022_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tuesday-january-31-2023.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tuesday-february-7-2023.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
